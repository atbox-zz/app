<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>3Ã—3 é­”è¡“æ–¹å¡Šï½œäº’å‹•ç¤ºæ„ Ã— å…¬å¼é€ŸæŸ¥ï¼ˆå«å›æ”¾èˆ‡è‡ªè¨‚ï¼‰</title>
  <meta name="description" content="æ‰‹æ©Ÿå‹å–„ï¼šä¸Šæ–¹å¯æ‹–æ›³æ—‹è½‰çš„ 3D é­”æ–¹ç¤ºæ„ï¼›ä¸‹æ–¹æä¾› CFOP / F2L / OLL / PLL èˆ‡ç¾¤è«–æ ¸å¿ƒå…¬å¼ï¼›æ”¯æ´å…¬å¼å›æ”¾ã€è‡ªè¨‚é…è‰²èˆ‡å°ºå¯¸ã€‚" />
  <style>
    :root{
      --bg:#0b0f14;--fg:#e8f0ff;--muted:#9fb3d1;--card:#0f1724;--accent:#60a5fa;--border:#223046;
      --red:#e11d48;--orange:#f97316;--yellow:#facc15;--green:#16a34a;--blue:#2563eb;--white:#e5e7eb;
      --success:#10b981;--warning:#f59e0b;--danger:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Noto Sans TC,"PingFang TC",sans-serif}
    a{color:var(--accent);text-decoration:none}
    .app{display:flex;flex-direction:column;min-height:100vh}
    
    header{
      padding:16px 20px;
      border-bottom:1px solid var(--border);
      position:sticky;top:0;
      background:linear-gradient(180deg,rgba(11,15,20,.98),rgba(11,15,20,.85));
      backdrop-filter:blur(10px);
      z-index:20;
    }
    header h1{font-size:20px;margin:0;font-weight:700;background:linear-gradient(135deg,var(--accent),#a855f7);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}
    header .sub{font-size:13px;color:var(--muted);margin-top:6px;line-height:1.4}
    
    .viewer{position:relative;flex:0 0 auto}
    .stage{
      height:48vh;min-height:320px;
      display:flex;align-items:center;justify-content:center;
      border-bottom:1px solid var(--border);
      background:radial-gradient(ellipse at center,rgba(96,165,250,.03) 0%,transparent 70%);
    }
    .hud{
      position:absolute;left:16px;bottom:16px;
      display:flex;gap:12px;align-items:center;flex-wrap:wrap;
    }
    .chip{
      background:rgba(255,255,255,.06);
      backdrop-filter:blur(8px);
      border:1px solid var(--border);
      padding:8px 12px;border-radius:20px;
      font-size:12px;color:var(--muted);
      transition:all 0.2s ease;
    }
    .chip:hover{background:rgba(255,255,255,.1)}

    /* 3D å®¹å™¨ */
    .cube-wrap{
      perspective:1200px;touch-action:none;
      transition:transform 0.2s ease;
      cursor:grab;
    }
    .cube-wrap:active{cursor:grabbing}
    .cube-wrap:hover{transform:scale(1.02)}
    
    .cube{
      position:relative;
      width:var(--cube-size,280px);
      height:var(--cube-size,280px);
      transform-style:preserve-3d;
      transition:transform .15s ease;
      filter:drop-shadow(0 10px 20px rgba(0,0,0,0.3));
    }
    .face{
      position:absolute;width:100%;height:100%;
      display:grid;grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(3,1fr);
      gap:6px;padding:6px;
      background:rgba(0,0,0,0.1);
      border-radius:8px;
    }
    .sticker{
      border-radius:6px;
      box-shadow:
        inset 0 0 8px rgba(0,0,0,.4),
        inset 0 1px 0 rgba(255,255,255,.15),
        0 1px 3px rgba(0,0,0,0.2);
      transition:all 0.2s ease;
    }
    .sticker:hover{transform:scale(1.05);box-shadow:inset 0 0 12px rgba(0,0,0,.5),0 2px 8px rgba(0,0,0,0.3)}
    
    .face--F{transform:translateZ(calc(var(--cube-size,280px)/2))}
    .face--B{transform:rotateY(180deg) translateZ(calc(var(--cube-size,280px)/2))}
    .face--U{transform:rotateX(90deg) translateZ(calc(var(--cube-size,280px)/2))}
    .face--D{transform:rotateX(-90deg) translateZ(calc(var(--cube-size,280px)/2))}
    .face--R{transform:rotateY(90deg) translateZ(calc(var(--cube-size,280px)/2))}
    .face--L{transform:rotateY(-90deg) translateZ(calc(var(--cube-size,280px)/2))}

    .panel{
      flex:1 1 auto;padding:20px;overflow:auto;
      background:linear-gradient(180deg,transparent,rgba(96,165,250,.01));
    }
    .group{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:16px;padding:20px;margin-bottom:20px;
      transition:all 0.2s ease;
      position:relative;
      overflow:hidden;
    }
    .group::before{
      content:'';position:absolute;top:0;left:0;right:0;height:2px;
      background:linear-gradient(90deg,var(--accent),#a855f7,var(--success));
      opacity:0.6;
    }
    .group:hover{
      transform:translateY(-2px);
      box-shadow:0 8px 25px rgba(0,0,0,0.15);
    }
    
    .group h2{
      font-size:18px;margin:0 0 12px;
      background:linear-gradient(135deg,var(--fg),var(--accent));
      -webkit-background-clip:text;background-clip:text;
      -webkit-text-fill-color:transparent;
    }
    .group p{margin:8px 0;color:var(--muted);font-size:14px;line-height:1.5}
    
    .algo{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:12px 16px;margin:12px 0;border-radius:12px;
      background:rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.05);
      transition:all 0.2s ease;
    }
    .algo:hover{
      background:rgba(255,255,255,.06);
      transform:translateX(4px);
      border-color:var(--accent);
    }
    .algo pre{
      margin:0;
      font-family:ui-monospace,SFMono-Regular,'SF Mono',Menlo,Monaco,Consolas,monospace;
      font-size:14px;color:var(--accent);font-weight:500;
    }
    
    .btn{
      appearance:none;border:1px solid var(--border);
      background:rgba(255,255,255,.04);
      padding:10px 16px;border-radius:12px;
      color:var(--fg);font-size:13px;font-weight:500;
      cursor:pointer;transition:all 0.2s ease;
      position:relative;overflow:hidden;
    }
    .btn::before{
      content:'';position:absolute;top:0;left:-100%;
      width:100%;height:100%;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,.1),transparent);
      transition:left 0.5s ease;
    }
    .btn:hover::before{left:100%}
    .btn:hover{
      background:var(--accent);color:#0f172a;
      border-color:var(--accent);
      transform:translateY(-2px);
      box-shadow:0 4px 12px rgba(96,165,250,0.3);
    }
    .btn:active{transform:translateY(0)}
    .btn.success{background:var(--success);border-color:var(--success)}
    .btn.warning{background:var(--warning);border-color:var(--warning)}
    .btn.danger{background:var(--danger);border-color:var(--danger)}
    
    .row{display:flex;gap:12px;flex-wrap:wrap;margin:12px 0;align-items:center}
    .note{font-size:13px;color:var(--muted);line-height:1.4}
    .kbd{
      font-family:ui-monospace,Consolas,monospace;
      background:rgba(255,255,255,.06);
      border:1px solid var(--border);
      padding:4px 8px;border-radius:6px;
      font-size:12px;font-weight:600;
    }

    footer{
      padding:30px 20px 50px;color:var(--muted);text-align:center;
      border-top:1px solid var(--border);
      background:rgba(15,23,36,.5);
    }

    /* controls */
    .controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .input,select{
      background:rgba(255,255,255,.04);
      border:1px solid var(--border);
      padding:10px 12px;border-radius:10px;
      color:var(--fg);font-size:13px;
      transition:all 0.2s ease;
    }
    .input:focus,select:focus{
      outline:none;border-color:var(--accent);
      box-shadow:0 0 0 3px rgba(96,165,250,0.1);
    }
    .small{font-size:13px}

    /* highlight current move */
    .moves{display:flex;gap:8px;flex-wrap:wrap;margin:16px 0}
    .move{
      padding:8px 12px;border-radius:10px;
      background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.05);
      font-family:ui-monospace,monospace;
      font-size:13px;font-weight:600;
      transition:all 0.2s ease;
    }
    .move.active{
      background:var(--accent);color:#0f172a;
      transform:scale(1.1);
      box-shadow:0 4px 12px rgba(96,165,250,0.4);
    }

    .playback-controls{
      display:flex;gap:10px;align-items:center;
      padding:16px;background:rgba(255,255,255,.02);
      border-radius:12px;margin-top:16px;
      border:1px solid var(--border);
    }

    .status-indicator{
      display:inline-block;width:8px;height:8px;
      border-radius:50%;margin-right:8px;
      animation:pulse 2s infinite;
    }
    .status-indicator.playing{background:var(--success)}
    .status-indicator.paused{background:var(--warning)}
    .status-indicator.stopped{background:var(--muted)}

    @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}

    /* Responsive */
    @media (max-width: 768px) {
      .panel{padding:16px}
      .group{padding:16px;margin-bottom:16px}
      .stage{height:40vh;min-height:280px}
      .cube{width:220px;height:220px}
      .hud{left:12px;bottom:12px}
      .controls{gap:8px}
      .row{gap:8px}
    }

    /* Animation enhancements */
    .cube.rotating{
      animation:cubeRotate 0.3s ease;
    }
    
    @keyframes cubeRotate{
      0%{transform:rotateX(-18deg) rotateY(-32deg) scale(1)}
      50%{transform:rotateX(-8deg) rotateY(-22deg) scale(1.05)}
      100%{transform:rotateX(-18deg) rotateY(-32deg) scale(1)}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>3Ã—3 é­”è¡“æ–¹å¡Šï½œäº’å‹•ç¤ºæ„ Ã— å…¬å¼é€ŸæŸ¥ï¼ˆå«å›æ”¾èˆ‡è‡ªè¨‚ï¼‰</h1>
      <div class="sub">ä¸Šæ–¹ç¤ºæ„å¯æ‹–æ›³æ—‹è½‰ï¼Œä¸‹æ–¹å¯é¸å…¬å¼ä¸¦å›æ”¾ï¼›æ”¯æ´é…è‰²èˆ‡å°ºå¯¸è‡ªè¨‚ã€‚å°ˆç‚ºå­¸ç¿’èˆ‡æ•™å­¸è¨­è¨ˆã€‚</div>
    </header>

    <section class="viewer">
      <div class="stage">
        <div class="cube-wrap" id="cubeWrap">
          <div class="cube" id="cube" aria-label="å¯æ‹–æ›³æ—‹è½‰çš„ 3D é­”æ–¹ç¤ºæ„">
            <div class="face face--F" data-face="F"></div>
            <div class="face face--B" data-face="B"></div>
            <div class="face face--U" data-face="U"></div>
            <div class="face face--D" data-face="D"></div>
            <div class="face face--R" data-face="R"></div>
            <div class="face face--L" data-face="L"></div>
          </div>
        </div>
        <div class="hud">
          <span class="chip" id="angleReadout">æ—‹è½‰ï¼š0Â°, 0Â°</span>
          <button class="btn" id="resetBtn">ğŸ”„ é‡ç½®è¦–è§’</button>
          <span class="chip" id="statusChip">
            <span class="status-indicator stopped"></span>æº–å‚™å°±ç·’
          </span>
        </div>
      </div>
    </section>

    <main class="panel">
      <div class="group">
        <h2>ğŸ¨ è¦–è¦ºè¨­å®šï¼ˆè‡ªè¨‚ï¼‰</h2>
        <div class="controls">
          <label class="small">å°ºå¯¸ï¼š<input id="sizeInput" class="input" type="range" min="180" max="420" value="280" /></label>
          <label class="small">è²¼ç´™é–“è·ï¼š<input id="gapInput" class="input" type="range" min="2" max="12" value="6" /></label>
          <label class="small">é…è‰²æ–¹æ¡ˆï¼š
            <select id="paletteSelect" class="input">
              <option value="standard">æ¨™æº–ï¼ˆç™½é»ƒç´…æ©™ç¶ è—ï¼‰</option>
              <option value="highcontrast">é«˜å°æ¯”ï¼ˆç™½ é»ƒ ç´… æ©™ ç¶  è—ï¼‰</option>
              <option value="mono">å–®è‰²ï¼ˆç°éšæ•™å­¸ç”¨ï¼‰</option>
              <option value="neon">éœ“è™¹ï¼ˆç‚«å½©ï¼‰</option>
            </select>
          </label>
          <button class="btn" id="resetColors">ğŸ¯ é‡ç½®é…è‰²</button>
        </div>
        <p class="note">ğŸ’¡ èª¿æ•´å°ºå¯¸èˆ‡é–“è·æœƒå³æ™‚åæ‡‰ï¼›é…è‰²å¯é¸å¸¸è¦‹é è¨­æˆ–å–®è‰²æ–¹ä¾¿æ•™å­¸ä½¿ç”¨ã€‚</p>
      </div>

      <div class="group">
        <h2>ğŸ“š ç¬¦è™Ÿç´„å®šï¼ˆNotationï¼‰</h2>
        <p><span class="kbd">R L U D F B</span>ï¼šå³å·¦ä¸Šä¸‹å‰å¾Œï¼›ç„¡æ’‡è™Ÿï¼é †æ™‚é‡ 90Â°ï¼Œ<span class="kbd">'</span>ï¼é€†æ™‚é‡ 90Â°ï¼Œ<span class="kbd">2</span>ï¼180Â°ã€‚</p>
        <div class="row">
          <button class="btn algoBtn" data-algo="R U R' U'">â–¶ è§¸ç™¼å™¨ï¼ˆR U R' U'ï¼‰</button>
          <button class="btn algoBtn" data-algo="R U R' U R U2 R'">â–¶ OLL å°é­š</button>
          <button class="btn algoBtn" data-algo="R2 U R U R' U' R' U' R' U R'">â–¶ PLLï¼ˆU-permï¼‰</button>
        </div>
      </div>

      <div class="group">
        <h2>ğŸ¯ å…¬å¼é€ŸæŸ¥ï¼ˆé»é¸æ’­æ”¾ï¼‰</h2>
        <div class="algo">
          <pre>F2L ç¯„ä¾‹: U R U' R' U' F' U F</pre>
          <button class="btn algoBtn" data-algo="U R U' R' U' F' U F">æ’­æ”¾</button>
        </div>
        <div class="algo">
          <pre>OLL å°é­š: R U R' U R U2 R'</pre>
          <button class="btn algoBtn" data-algo="R U R' U R U2 R'">æ’­æ”¾</button>
        </div>
        <div class="algo">
          <pre>PLL T-perm: R U R' F' R U R' U' R' F R2 U' R' U'</pre>
          <button class="btn algoBtn" data-algo="R U R' F' R U R' U' R' F R2 U' R' U'">æ’­æ”¾</button>
        </div>
        <div class="algo">
          <pre>OLL åå­—: F R U R' U' F'</pre>
          <button class="btn algoBtn" data-algo="F R U R' U' F'">æ’­æ”¾</button>
        </div>
        <div class="algo">
          <pre>PLL A-perm: R' F R' B2 R F' R' B2 R2</pre>
          <button class="btn algoBtn" data-algo="R' F R' B2 R F' R' B2 R2">æ’­æ”¾</button>
        </div>
        
        <p class="note">ğŸ¬ æ’­æ”¾æ™‚æœƒåœ¨ä¸‹æ–¹é¡¯ç¤ºç§»å‹•åºåˆ—èˆ‡ç•¶å‰æ­¥é©Ÿï¼Œä¸¦æœ‰è¦–è¦ºåŒ–å‹•ç•«æ•ˆæœã€‚</p>

        <div style="margin-top:16px">
          <label class="small">ğŸ› ï¸ è‡ªè¨‚åºåˆ—ï¼ˆç©ºæ ¼æˆ–é€—è™Ÿåˆ†éš”ï¼‰ï¼š</label>
          <input id="customAlgo" class="input" placeholder="ä¾‹å¦‚ï¼šR U R' U' R' F R2 U'" style="width:100%;margin-top:8px" />
          <div style="margin-top:12px;display:flex;gap:10px">
            <button class="btn" id="playCustom">â–¶ æ’­æ”¾è‡ªè¨‚</button>
            <button class="btn" id="copyCustom">ğŸ“‹ è¤‡è£½åºåˆ—</button>
            <button class="btn" id="clearCustom">ğŸ—‘ï¸ æ¸…ç©º</button>
          </div>
        </div>

        <div id="movesContainer" class="moves"></div>
        
        <div class="playback-controls">
          <button class="btn" id="pauseBtn">â¸ï¸ æš«åœ</button>
          <button class="btn danger" id="stopBtn">â¹ï¸ åœæ­¢</button>
          <label class="small">é€Ÿåº¦ï¼š
            <input id="speedRange" type="range" min="200" max="1200" value="600" />
            <span id="speedValue">600ms</span>
          </label>
        </div>
      </div>

      <div class="group">
        <h2>ğŸ§® ç¾¤è«–æ ¸å¿ƒï¼ˆç†è§£ç”¨ï¼‰</h2>
        <div class="algo">
          <pre>æ›ä½å­ [X, Y] = X Y Xâ»Â¹ Yâ»Â¹</pre>
          <button class="btn" data-copy="[X, Y] = X Y X^{-1} Y^{-1}">ğŸ“‹ è¤‡è£½</button>
        </div>
        <div class="algo">
          <pre>å…±è»›è®Šæ› Z X Zâ»Â¹</pre>
          <button class="btn" data-copy="Z X Z^{-1}">ğŸ“‹ è¤‡è£½</button>
        </div>
        <div class="algo">
          <pre>åŸºæœ¬æ—‹è½‰ç¾¤ âŸ¨R, L, U, D, F, BâŸ©</pre>
          <button class="btn" data-copy="âŸ¨R, L, U, D, F, BâŸ©">ğŸ“‹ è¤‡è£½</button>
        </div>
        <p class="note">ğŸ“ æ›ä½ï¼ˆcommutatorï¼‰èˆ‡å…±è»›ï¼ˆconjugateï¼‰æ˜¯è¨­è¨ˆé­”æ–¹å…¬å¼çš„æ ¸å¿ƒå·¥å…·ï¼Œç†è§£ç¾¤è«–æœ‰åŠ©æ–¼å‰µé€ æ–°å…¬å¼ã€‚</p>
      </div>

      <div class="group">
        <h2>ğŸ“– å­¸ç¿’è³‡æº</h2>
        <p class="note">
          ğŸ¯ <strong>åˆå­¸è€…å»ºè­°</strong>ï¼šå…ˆå­¸æœƒå±¤è§£æ³•ï¼ˆLayer Methodï¼‰ï¼Œå†é€²éšåˆ° CFOPï¼ˆCross â†’ F2L â†’ OLL â†’ PLLï¼‰<br>
          ğŸ“š <strong>å…¬å¼è¨˜æ†¶</strong>ï¼šé‡è¤‡ç·´ç¿’æ‰‹é †ï¼Œç†è§£å…¬å¼çš„ä½œç”¨æ©Ÿåˆ¶ï¼Œè€Œéæ­»è¨˜ç¡¬èƒŒ<br>
          ğŸ” <strong>é€²éšå­¸ç¿’</strong>ï¼šäº†è§£ç¾¤è«–èƒŒæ™¯æœ‰åŠ©æ–¼ç†è§£ç‚ºä»€éº¼æŸäº›å…¬å¼æœ‰æ•ˆï¼Œä¸¦èƒ½å‰µé€ æ–°çš„è§£æ³•
        </p>
        <div class="row">
          <button class="btn" onclick="showTips()">ğŸ’¡ é¡¯ç¤ºä½¿ç”¨æŠ€å·§</button>
          <button class="btn" onclick="showAbout()">â„¹ï¸ é—œæ–¼æ­¤å·¥å…·</button>
        </div>
      </div>
    </main>

    <footer>
      <div>
        <p><strong>èªªæ˜</strong>ï¼šæ­¤å·¥å…·ç‚ºæ•™å­¸ç¤ºæ„ç”¨é€”ï¼Œå›æ”¾ä»¥è¦–è¦ºåŒ–ã€Œå…¨é«”æ—‹è½‰ + é¡¯ç¤ºæ­¥åºã€ç‚ºä¸»ï¼Œéå®Œæ•´æ–¹å¡Šç‹€æ…‹æ¨¡æ“¬ã€‚</p>
        <p>å¦‚éœ€å®Œæ•´çš„é­”æ–¹ç‹€æ…‹å¼•æ“å’Œæ›´ç²¾ç¢ºçš„æ¨¡æ“¬ï¼Œå¯ä»¥é€²ä¸€æ­¥é–‹ç™¼æˆ–ä½¿ç”¨å°ˆæ¥­çš„é­”æ–¹æ¨¡æ“¬å™¨ã€‚</p>
      </div>
    </footer>
  </div>

  <script>
    // ----------------- åˆå§‹åŒ–è²¼ç´™ DOM -----------------
    (function buildCube(){
      const palette = {
        standard: {F:'#16a34a',B:'#2563eb',U:'#f8fafc',D:'#facc15',R:'#e11d48',L:'#f97316'},
        highcontrast: {F:'#0ea5a4',B:'#1e3a8a',U:'#ffffff',D:'#ffd166',R:'#ef4444',L:'#fb923c'},
        mono: {F:'#bfc7cf',B:'#9aa6b2',U:'#f3f4f6',D:'#d1d5db',R:'#a3a3a3',L:'#8b8b8b'},
        neon: {F:'#00ff88',B:'#0088ff',U:'#ffffff',D:'#ffff00',R:'#ff0066',L:'#ff8800'}
      };
      
      const cube = document.getElementById('cube');
      cube.innerHTML = '';
      
      Object.keys(palette.standard).forEach(faceKey=>{
        const face = document.createElement('div');
        face.className='face face--'+faceKey;
        face.dataset.face = faceKey;
        
        for(let i=0;i<9;i++){
          const s = document.createElement('div');
          s.className='sticker';
          s.dataset.idx = i;
          face.appendChild(s);
        }
        cube.appendChild(face);
      });
      
      function applyPalette(name='standard'){
        const p = palette[name];
        document.querySelectorAll('.face').forEach(f=>{
          const key = f.dataset.face;
          const color = p[key];
          Array.from(f.children).forEach(ch=>ch.style.background = color);
        });
      }
      
      applyPalette('standard');
      window._paletteApply = applyPalette;
    })();

    // ----------------- æ—‹è½‰äº’å‹• -----------------
    (function(){
      const cube = document.getElementById('cube');
      const wrap = document.getElementById('cubeWrap');
      const readout = document.getElementById('angleReadout');
      const resetBtn = document.getElementById('resetBtn');
      
      let rotX = -18, rotY = -32, scale = 1;
      let dragging=false, lastX=0,lastY=0;
      
      function render(){
        cube.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg) scale(${scale})`;
        readout.textContent = `æ—‹è½‰ï¼š${Math.round(rotX)}Â°, ${Math.round(rotY)}Â°`;
      }
      
      function onDown(x,y){
        dragging=true;
        lastX=x;
        lastY=y;
        wrap.style.cursor = 'grabbing';
      }
      
      function onMove(x,y){
        if(!dragging) return;
        const dx=x-lastX, dy=y-lastY;
        rotY += dx*0.4;
        rotX -= dy*0.4;
        lastX=x;
        lastY=y;
        render();
      }
      
      function onUp(){
        dragging=false;
        wrap.style.cursor = 'grab';
      }
      
      // Mouse events
      wrap.addEventListener('mousedown', e=>onDown(e.clientX,e.clientY));
      window.addEventListener('mousemove', e=>onMove(e.clientX,e.clientY));
      window.addEventListener('mouseup', onUp);
      
      // Touch events
      wrap.addEventListener('touchstart', e=>{
        if(e.touches.length===1){
          const t=e.touches[0];
          onDown(t.clientX,t.clientY);
        }
      },{passive:true});
      
      wrap.addEventListener('touchmove', e=>{
        if(e.touches.length===1){
          const t=e.touches[0];
          onMove(t.clientX,t.clientY);
        }
      },{passive:true});
      
      wrap.addEventListener('touchend', onUp);
      
      resetBtn.addEventListener('click', ()=>{
        rotX=-18;
        rotY=-32;
        scale=1;
        render();
        
        // Add reset animation
        cube.classList.add('rotating');
        setTimeout(()=>cube.classList.remove('rotating'), 300);
      });
      
      render();
    })();

    // ----------------- è¦–è¦ºè¨­å®š æ§åˆ¶ -----------------
    (function(){
      const sizeInput = document.getElementById('sizeInput');
      const gapInput = document.getElementById('gapInput');
      const paletteSelect = document.getElementById('paletteSelect');
      const resetColors = document.getElementById('resetColors');
      const cube = document.getElementById('cube');
      
      function applySize(v){
        document.documentElement.style.setProperty('--cube-size', v+'px');
      }
      
      function applyGap(v){
        document.querySelectorAll('.face').forEach(f=>{
          const g = v+'px';
          f.style.gap = g;
          f.style.padding = g;
        });
      }
      
      sizeInput.addEventListener('input', e=>applySize(e.target.value));
      gapInput.addEventListener('input', e=>applyGap(e.target.value));
      paletteSelect.addEventListener('change', e=>{
        window._paletteApply(e.target.value);
      });
      
      resetColors.addEventListener('click', ()=>{
        paletteSelect.value='standard';
        window._paletteApply('standard');
      });
      
      // Initial application
      applySize(sizeInput.value);
      applyGap(gapInput.value);
    })();

    // ----------------- è¤‡è£½åŠŸèƒ½ -----------------
    (function(){
      async function copy(text){
        if(navigator.clipboard && window.isSecureContext) {
          return navigator.clipboard.writeText(text);
        }
        const ta=document.createElement('textarea');
        ta.value=text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        ta.remove();
        return Promise.resolve();
      }
      
      document.addEventListener('click', async (e)=>{
        const cbtn = e.target.closest('[data-copy]');
        if(cbtn){
          const val=cbtn.getAttribute('data-copy');
          try{
            await copy(val);
            cbtn.textContent='âœ… å·²è¤‡è£½';
            setTimeout(()=>cbtn.textContent='ğŸ“‹ è¤‡è£½',1200);
          }catch{
            cbtn.textContent='âŒ è¤‡è£½å¤±æ•—';
            setTimeout(()=>cbtn.textContent='ğŸ“‹ è¤‡è£½',1200);
          }
          return;
        }
        
        const algoBtn = e.target.closest('.algoBtn');
        if(!algoBtn) return;
        const algo = algoBtn.dataset.algo;
        
        try{
          await copy(algo);
        }catch(e){}
        
        playSequence(algo.split(/\s+|,\s*/));
      });
    })();

    // ----------------- æ’­æ”¾å¼•æ“ï¼ˆè¦–è¦ºåŒ–ç¤ºæ„ï¼‰ -----------------
    let playState = {timer:null, idx:0, seq:[], running:false, paused:false};
    const movesContainer = document.getElementById('movesContainer');
    const speedRange = document.getElementById('speedRange');
    const speedValue = document.getElementById('speedValue');
    const pauseBtn = document.getElementById('pauseBtn');
    const stopBtn = document.getElementById('stopBtn');
    const statusChip = document.getElementById('statusChip');

    // Update speed display
    speedRange.addEventListener('input', ()=>{
      speedValue.textContent = speedRange.value + 'ms';
    });

    function normalizeMoves(arr){
      return arr.map(s=>s.trim()).filter(Boolean).map(s=>s.replace(/\u2019/g, "'").replace(/â€“/g,'-'));
    }

    function renderMoves(seq){
      movesContainer.innerHTML = '';
      seq.forEach((m,i)=>{
        const el=document.createElement('div');
        el.className='move';
        el.textContent = m;
        el.dataset.idx=i;
        movesContainer.appendChild(el);
      });
    }

    function highlight(idx){
      Array.from(movesContainer.children).forEach(ch=>
        ch.classList.toggle('active', Number(ch.dataset.idx)===idx)
      );
    }

    function updateStatus(text, type='stopped'){
      const indicator = statusChip.querySelector('.status-indicator');
      indicator.className = `status-indicator ${type}`;
      statusChip.innerHTML = `<span class="status-indicator ${type}"></span>${text}`;
    }

    function applyVisualMove(move){
      const cube = document.getElementById('cube');
      
      // ç²å–ç•¶å‰çš„æ—‹è½‰è§’åº¦
      const currentTransform = cube.style.transform;
      const rotXMatch = currentTransform.match(/rotateX\(([^)]+)\)/);
      const rotYMatch = currentTransform.match(/rotateY\([^)]+\)/);
      const scaleMatch = currentTransform.match(/scale\([^)]+\)/);
      
      const baseRotX = rotXMatch ? parseFloat(rotXMatch[1]) : -18;
      const rotYPart = rotYMatch ? rotYMatch[0] : 'rotateY(-32deg)';
      const scalePart = scaleMatch ? scaleMatch[0] : 'scale(1)';
      
      // è¨ˆç®—æ—‹è½‰è§’åº¦ - æ ¹æ“šé­”æ–¹æ¨™æº–è¨˜è™Ÿ
      let rotationAxis = '';
      let angle = 90;
      
      // åˆ¤æ–·ç§»å‹•é¡å‹å’Œè§’åº¦
      if(move.includes('2')) angle = 180;
      if(move.includes("'")) angle = -90;
      
      // æ ¹æ“šé¢çš„ç§»å‹•æ–¹å‘è¨­å®šæ—‹è½‰è»¸
      if(/^R/.test(move)) {
        rotationAxis = 'rotateX'; // Ré¢ç¹Xè»¸æ—‹è½‰
        angle = move.includes("'") ? 90 : -90; // Ré †æ™‚é‡çœ‹èµ·ä¾†æ˜¯è² Xæ—‹è½‰
      }
      else if(/^L/.test(move)) {
        rotationAxis = 'rotateX';
        angle = move.includes("'") ? -90 : 90; // Lèˆ‡Rç›¸å
      }
      else if(/^U/.test(move)) {
        rotationAxis = 'rotateY'; // Ué¢ç¹Yè»¸æ—‹è½‰
        angle = move.includes("'") ? -90 : 90;
      }
      else if(/^D/.test(move)) {
        rotationAxis = 'rotateY';
        angle = move.includes("'") ? 90 : -90; // Dèˆ‡Uç›¸å
      }
      else if(/^F/.test(move)) {
        rotationAxis = 'rotateZ'; // Fé¢ç¹Zè»¸æ—‹è½‰
        angle = move.includes("'") ? -90 : 90;
      }
      else if(/^B/.test(move)) {
        rotationAxis = 'rotateZ';
        angle = move.includes("'") ? 90 : -90; // Bèˆ‡Fç›¸å
      }
      
      // è™•ç†é›™è½‰
      if(move.includes('2')) {
        angle = angle > 0 ? 180 : -180;
      }
      
      // æ‡‰ç”¨æ—‹è½‰å‹•ç•«
      cube.style.transition = 'transform 400ms cubic-bezier(0.25, 0.46, 0.45, 0.94)';
      
      if(rotationAxis === 'rotateX') {
        const newRotX = baseRotX + angle;
        cube.style.transform = `rotateX(${newRotX}deg) ${rotYPart} ${scalePart}`;
      }
      else if(rotationAxis === 'rotateY') {
        const rotYValue = rotYPart.match(/rotateY\(([^)]+)\)/);
        const baseRotY = rotYValue ? parseFloat(rotYValue[1]) : -32;
        const newRotY = baseRotY + angle;
        cube.style.transform = `rotateX(${baseRotX}deg) rotateY(${newRotY}deg) ${scalePart}`;
      }
      else if(rotationAxis === 'rotateZ') {
        cube.style.transform = `rotateX(${baseRotX}deg) ${rotYPart} rotateZ(${angle}deg) ${scalePart}`;
      }
      
      // æ¢å¾©åˆ°åŸå§‹ä½ç½®
      setTimeout(()=>{
        cube.style.transform = `rotateX(${baseRotX}deg) ${rotYPart} ${scalePart}`;
        cube.style.transition = 'transform 200ms ease';
      }, 450);
      
      // æ·»åŠ é¢éƒ¨é«˜äº®æ•ˆæœ
      const faceElement = document.querySelector(`.face--${move.charAt(0)}`);
      if(faceElement) {
        faceElement.style.filter = 'brightness(1.3) saturate(1.2)';
        setTimeout(()=>{
          faceElement.style.filter = '';
        }, 450);
      }
    }

    async function playSequence(seqRaw){
      const seq = normalizeMoves(seqRaw);
      if(seq.length===0) return;
      
      if(playState.running) stopPlayback();
      
      playState.seq = seq;
      playState.idx = 0;
      playState.running = true;
      playState.paused = false;
      
      renderMoves(seq);
      highlight(0);
      updateStatus(`æ’­æ”¾ä¸­ï¼š${seq.length} æ­¥`, 'playing');
      
      const delay = ()=>Number(speedRange.value);
      
      while(playState.idx < seq.length && playState.running){
        if(playState.paused){
          updateStatus('å·²æš«åœ', 'paused');
          await new Promise(r=>setTimeout(r,100));
          continue;
        }
        
        updateStatus(`æ’­æ”¾ä¸­ï¼š${playState.idx + 1}/${seq.length}`, 'playing');
        const m = seq[playState.idx];
        highlight(playState.idx);
        applyVisualMove(m);
        
        await new Promise(r=>setTimeout(r, delay()));
        playState.idx++;
      }
      
      if(playState.running){
        updateStatus('æ’­æ”¾å®Œæˆ', 'stopped');
        setTimeout(()=>updateStatus('æº–å‚™å°±ç·’', 'stopped'), 2000);
      }
      
      playState.running = false;
      playState.paused = false;
    }

    function stopPlayback(){
      playState.running=false;
      playState.paused=false;
      playState.idx=0;
      highlight(-1);
      updateStatus('å·²åœæ­¢', 'stopped');
      setTimeout(()=>updateStatus('æº–å‚™å°±ç·’', 'stopped'), 1000);
    }

    pauseBtn.addEventListener('click', ()=>{
      if(!playState.running) return;
      playState.paused = !playState.paused;
      pauseBtn.textContent = playState.paused? 'â–¶ï¸ ç¹¼çºŒ' : 'â¸ï¸ æš«åœ';
      if(!playState.paused){
        updateStatus(`æ’­æ”¾ä¸­ï¼š${playState.idx + 1}/${playState.seq.length}`, 'playing');
      }
    });

    stopBtn.addEventListener('click', ()=>{
      stopPlayback();
      pauseBtn.textContent = 'â¸ï¸ æš«åœ';
    });

    // Custom algorithm controls
    document.getElementById('playCustom').addEventListener('click', ()=>{
      const v=document.getElementById('customAlgo').value;
      if(!v.trim()) return;
      playSequence(v.split(/\s+|,\s*/));
    });

    document.getElementById('copyCustom').addEventListener('click', async ()=>{
      const v=document.getElementById('customAlgo').value;
      if(!v.trim()) return;
      try{
        await navigator.clipboard.writeText(v);
        const btn = document.getElementById('copyCustom');
        btn.textContent='âœ… å·²è¤‡è£½';
        setTimeout(()=>btn.textContent='ğŸ“‹ è¤‡è£½åºåˆ—',1200);
      }catch{
        alert('è¤‡è£½å¤±æ•—');
      }
    });

    document.getElementById('clearCustom').addEventListener('click', ()=>{
      document.getElementById('customAlgo').value = '';
    });

    // Expose playSequence globally
    window.playSequence = playSequence;

    // Stop playback when page is hidden
    window.addEventListener('pagehide', ()=>stopPlayback());

    // ----------------- é¡å¤–åŠŸèƒ½å‡½æ•¸ -----------------
    window.showTips = function(){
      alert(`ğŸ’¡ ä½¿ç”¨æŠ€å·§ï¼š

ğŸ–±ï¸ æ‹–æ‹½é­”æ–¹å¯è‡ªç”±æ—‹è½‰è¦–è§’
ğŸ“± æ”¯æ´è§¸æ‘¸æ‰‹å‹¢æ“ä½œ
ğŸ¨ å¯èª¿æ•´å°ºå¯¸ã€é–“è·å’Œé…è‰²æ–¹æ¡ˆ
âš¡ å¯èª¿ç¯€æ’­æ”¾é€Ÿåº¦ä¾†é…åˆå­¸ç¿’ç¯€å¥
ğŸ“‹ é»æ“Šå…¬å¼å¯è‡ªå‹•è¤‡è£½åˆ°å‰ªè²¼æ¿
ğŸ¯ ä½¿ç”¨è‡ªè¨‚åºåˆ—æ¡†è¼¸å…¥è‡ªå·±çš„å…¬å¼

å»ºè­°ï¼šå…ˆå¾ç°¡å–®çš„è§¸ç™¼å™¨é–‹å§‹ç·´ç¿’ï¼`);
    };

    window.showAbout = function(){
      alert(`â„¹ï¸ é—œæ–¼æ­¤å·¥å…·ï¼š

é€™æ˜¯ä¸€å€‹äº’å‹•å¼ 3D é­”è¡“æ–¹å¡Šå­¸ç¿’å·¥å…·ï¼Œå°ˆç‚ºæ•™å­¸å’Œç·´ç¿’è¨­è¨ˆã€‚

ğŸ¯ ç‰¹è‰²åŠŸèƒ½ï¼š
â€¢ çœŸå¯¦çš„ 3D è¦–è¦ºæ•ˆæœ
â€¢ å®Œæ•´çš„å…¬å¼å›æ”¾ç³»çµ±  
â€¢ è‡ªè¨‚é…è‰²å’Œå°ºå¯¸
â€¢ ç¾¤è«–æ•¸å­¸èƒŒæ™¯èª¬æ˜
â€¢ éŸ¿æ‡‰å¼è¨­è¨ˆï¼Œæ”¯æ´å„ç¨®è¨­å‚™

ğŸ’¡ é©ç”¨å°è±¡ï¼š
â€¢ é­”æ–¹åˆå­¸è€…å’Œé€²éšç©å®¶
â€¢ æ•¸å­¸å’Œæ¼”ç®—æ³•æ„›å¥½è€…
â€¢ æ•™å¸«å’Œå­¸ç”Ÿ

âš ï¸ æ³¨æ„ï¼šæ­¤ç‚ºè¦–è¦ºåŒ–ç¤ºæ„å·¥å…·ï¼Œéå®Œæ•´æ¨¡æ“¬å™¨`);
    };

    // Initialize
    console.log('ğŸ® 3Dé­”è¡“æ–¹å¡Šå·¥å…·å·²è¼‰å…¥å®Œæˆï¼');
    console.log('ğŸ’¡ æ‹–æ‹½å¯æ—‹è½‰è¦–è§’ï¼Œé»æ“Šå…¬å¼è§€çœ‹å‹•ç•«');
  </script>
</body>
</html>