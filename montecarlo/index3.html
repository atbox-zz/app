<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 è’™ç‰¹å¡æ´› 3.0 - é¸æˆ°äº‹ä»¶å£“åŠ›æ¸¬è©¦</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #2c3e50; --accent: #e67e22; --danger: #c0392b; --success: #27ae60; --bg: #f0f2f5; }
        body { font-family: 'PingFang TC', sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .main-container { max-width: 1200px; margin: auto; display: grid; grid-template-columns: 350px 1fr; gap: 20px; }
        .panel { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        
        /* äº‹ä»¶è§¸ç™¼å™¨æ¨£å¼ */
        .event-box { background: #fff3cd; border: 2px dashed #ffeeba; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center; }
        .event-title { font-weight: bold; color: #856404; font-size: 1.1rem; margin-bottom: 5px; }
        .event-desc { font-size: 0.85rem; color: #665214; line-height: 1.4; }
        
        .btn-event { background: var(--primary); color: white; border: none; padding: 10px; width: 100%; border-radius: 5px; cursor: pointer; margin-bottom: 10px; font-weight: bold; }
        .btn-event:hover { background: #34495e; }
        .btn-run { background: var(--accent); color: white; border: none; padding: 15px; width: 100%; border-radius: 5px; cursor: pointer; font-size: 1.2rem; font-weight: bold; box-shadow: 0 4px 0 #d35400; }
        .btn-run:active { transform: translateY(2px); box-shadow: none; }

        .input-card { border-left: 5px solid #ccc; padding: 10px; margin-bottom: 10px; background: #fafafa; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .prob-badge { background: var(--danger); color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="main-container">
    <div class="panel">
        <h2>ğŸ”¥ 2026 é¸æˆ°æŒ‡æ®æ‰€</h2>
        
        <div class="event-box" id="eventDisplay">
            <div class="event-title">ğŸš© ç›®å‰ç„¡ç‰¹æ®Šäº‹ä»¶</div>
            <div class="event-desc">é»æ“Šä¸‹æ–¹æŒ‰éˆ•è§¸ç™¼éš¨æ©Ÿé¸æˆ°äº‹ä»¶</div>
        </div>

        <button class="btn-event" onclick="triggerRandomEvent()">ğŸ² è§¸ç™¼éš¨æ©Ÿäº‹ä»¶ (Random Event)</button>
        
        <div id="candidateInputs"></div>

        <button class="btn-run" onclick="runSimulation()">ğŸš€ å•Ÿå‹•è¬æ¬¡æ¨¡æ“¬é æ¸¬</button>
        <p style="font-size: 0.75rem; color: #7f8c8d; margin-top: 10px;">* æ¨¡æ“¬åŒ…å« Box-Muller åˆ†ä½ˆèˆ‡å³æ™‚äº‹ä»¶ä¿®æ­£ä¿‚æ•¸ã€‚</p>
    </div>

    <div class="panel">
        <div class="stats-grid">
            <div><canvas id="radarChart"></canvas></div>
            <div><canvas id="winChart"></canvas></div>
        </div>
        
        <div style="margin-top: 20px;">
            <h3>ğŸ æ¨¡æ“¬çµæœåˆ†æ</h3>
            <table style="width:100%; border-collapse: collapse;" id="resultTable">
                <thead style="background:#eee;">
                    <tr><th style="padding:10px;">å€™é¸äºº</th><th>ä¿®æ­£å¾Œå¹³å‡</th><th>å‹å ´</th><th>å‹é¸æ©Ÿç‡</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<script>
// 1. åˆå§‹åŒ–å€™é¸äººæ•¸æ“š (ä»¥ 2026 æ–°åŒ—å¸‚ç‚ºé è¨­èƒŒæ™¯)
let candidates = [
    { id: 0, name: "æå››å· (è—)", mean: 41, sd: 3, air: 75, org: 92, img: 80, color: "rgba(0, 0, 149, 0.7)", eventMod: 0 },
    { id: 1, name: "è˜‡å·§æ…§ (ç¶ )", mean: 34, sd: 3, air: 82, org: 85, img: 85, color: "rgba(27, 148, 49, 0.7)", eventMod: 0 },
    { id: 2, name: "é»ƒåœ‹æ˜Œ (ç™½)", mean: 15, sd: 5, air: 95, org: 30, img: 75, color: "rgba(40, 200, 200, 0.7)", eventMod: 0 }
];

// 2. å®šç¾©éš¨æ©Ÿäº‹ä»¶åº«
const electionEvents = [
    { title: "ğŸ“¢ é‡å¤§é†œèçˆ†æ–™", desc: "é ˜å…ˆè€…è¢«çˆ†å‡ºè«–æ–‡æˆ–åœŸåœ°çˆ­è­°ã€‚æ•ˆæœï¼šè—ç‡Ÿæ”¯æŒåº¦ -5%ï¼Œèª¤å·®æ³¢å‹•åº¦å¢åŠ ã€‚", action: () => { candidates[0].eventMod = -5; candidates[0].sd += 2; } },
    { title: "â›ˆï¸ æŠ•ç¥¨æ—¥å¼·é™é›¨", desc: "æ¥µç«¯å¤©æ°£å½±éŸ¿å‡ºé–€æ„é¡˜ã€‚æ•ˆæœï¼šå¹´è¼•é¸æ°‘å±…å¤šçš„ç™½ç‡Ÿæ”¯æŒåº¦ -3%ï¼Œæ•´é«”æŠ•ç¥¨ç‡ä¸‹é™ã€‚", action: () => { candidates[2].eventMod = -3; } },
    { title: "ğŸŒŸ å¤©ç‹ç´šå¤§å’–ç«™å°", desc: "é»¨å…§é‡é‡ç´šäººç‰©ç¾èº«åŠ›æŒºã€‚æ•ˆæœï¼šç¶ ç‡Ÿçµ„ç¹”ç¥¨å‡èšï¼Œæ”¯æŒåº¦ +4%ã€‚", action: () => { candidates[1].eventMod = 4; candidates[1].org += 5; } },
    { title: "ğŸ•Šï¸ å…©å²¸å±€å‹¢å‡æº«", desc: "å¤–éƒ¨å±€å‹¢å¼•ç™¼æ”¯æŒè€…æ­¸éšŠã€‚æ•ˆæœï¼šè—ç¶ å…©é»¨æ”¯æŒåº¦å„ +2%ï¼Œç™½ç‡Ÿè¢«é‚Šç·£åŒ– -2%ã€‚", action: () => { candidates[0].eventMod = 2; candidates[1].eventMod = 2; candidates[2].eventMod = -2; } },
    { title: "ğŸ¤ æˆåŠŸæ•´åˆåœ¨é‡", desc: "è—ç™½é”æˆåˆæ­¥åˆä½œå…±è­˜ã€‚æ•ˆæœï¼šè—ç‡Ÿæ”¯æŒåº¦ +6%ï¼Œç™½ç‡Ÿæ”¯æŒåº¦è½‰åŒ–ç‚ºè—ç‡Ÿå‹ç‡ã€‚", action: () => { candidates[0].eventMod = 6; candidates[2].eventMod = -4; } }
];

let radarChart, winChart;

function renderInputs() {
    const container = document.getElementById('candidateInputs');
    container.innerHTML = candidates.map((c, i) => `
        <div class="input-card" style="border-left-color: ${c.color}">
            <strong>${c.name}</strong> <br>
            <small>åŸºæº–: ${c.mean}% | ä¿®æ­£: <span id="mod-${i}">${c.eventMod > 0 ? '+' : ''}${c.eventMod}</span>%</small>
        </div>
    `).join('');
    updateRadar();
}

function triggerRandomEvent() {
    const event = electionEvents[Math.floor(Math.random() * electionEvents.length)];
    // é‡ç½®æ‰€æœ‰ä¿®æ­£
    candidates.forEach(c => { c.eventMod = 0; });
    // åŸ·è¡Œäº‹ä»¶æ•ˆæœ
    event.action();
    
    document.getElementById('eventDisplay').innerHTML = `
        <div class="event-title">ğŸ”´ äº‹ä»¶ï¼š${event.title}</div>
        <div class="event-desc">${event.desc}</div>
    `;
    renderInputs();
}

function randn_bm() {
    let u = 0, v = 0;
    while(u === 0) u = Math.random();
    while(v === 0) v = Math.random();
    return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
}

function runSimulation() {
    const iterations = 10000;
    const stats = candidates.map(c => ({ ...c, wins: 0, totalScore: 0 }));

    for (let i = 0; i < iterations; i++) {
        let scores = stats.map(c => {
            // å…¬å¼ï¼šå¾—ç¥¨ = (åŸºæº–+ä¿®æ­£) + (å¸¸æ…‹éš¨æ©Ÿæ•¸ * æ¨™æº–å·®)
            let score = (c.mean + c.eventMod) + (randn_bm() * c.sd);
            return { id: c.id, score: score };
        });

        let winner = scores.reduce((prev, curr) => (curr.score > prev.score) ? curr : prev);
        stats[winner.id].wins++;
        stats.forEach((c, idx) => c.totalScore += scores[idx].score);
    }
    updateCharts(stats, iterations);
}

function updateRadar() {
    const ctx = document.getElementById('radarChart');
    if (radarChart) radarChart.destroy();
    radarChart = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: ['ç©ºæˆ°', 'çµ„ç¹”', 'å½¢è±¡'],
            datasets: candidates.map(c => ({
                label: c.name,
                data: [c.air, c.org, c.img],
                backgroundColor: c.color,
                borderColor: c.color.replace('0.7', '1')
            }))
        },
        options: { scales: { r: { min: 0, max: 100 } } }
    });
}

function updateCharts(stats, total) {
    // æ›´æ–°è¡¨æ ¼
    const tbody = document.querySelector('#resultTable tbody');
    tbody.innerHTML = stats.sort((a,b) => b.wins - a.wins).map(c => `
        <tr>
            <td style="padding:10px; border-bottom:1px solid #eee;">${c.name}</td>
            <td style="text-align:center;">${(c.totalScore/total).toFixed(2)}%</td>
            <td style="text-align:center;">${c.wins}</td>
            <td style="text-align:center;"><span class="prob-badge">${((c.wins/total)*100).toFixed(1)}%</span></td>
        </tr>
    `).join('');

    // æ›´æ–°å‹ç‡åœ–
    const ctx = document.getElementById('winChart');
    if (winChart) winChart.destroy();
    winChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: stats.map(c => c.name),
            datasets: [{
                data: stats.map(c => c.wins),
                backgroundColor: stats.map(c => c.color)
            }]
        }
    });
}

// åˆå§‹åŒ–æ¸²æŸ“
renderInputs();
</script>

</body>
</html>