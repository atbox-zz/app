<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰ªäÊó•ÂÖ´Â≠óË®àÁÆóÂô®</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lunar-javascript/1.7.3/lunar.min.js"></script>
    <style>
        body {
            font-family: 'Microsoft YaHei', 'Noto Sans CJK TC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            background: rgba(140, 129, 6, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            max-width: 600px;
            width: 100%;
        }
        
        .title {
            text-align: center;
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .date-info {
            background: linear-gradient(45deg, #b7b917);
            color: rgb(14, 1, 1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: left;
            font-size: 1.2em;
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3);
        }
        
        .bazi-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin: 30px 0;
        }
        
        .pillar {
            background: linear-gradient(145deg,#e4e7ea);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            border: 3px solid transparent;
            background-clip: padding-box;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 180px;
        }
        
        .pillar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 15px;
            padding: 3px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: exclude;
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
        }
        
        .pillar-title {
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .gan-zhi-vertical {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .gan-zhi-vertical .gan,
        .gan-zhi-vertical .zhi {
            font-size: 2em;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            color: #e74c3c;
        }
        
        .shishen {
            font-size: 0.65em;
            color: #0e0279;
            font-weight: bold;
            min-height: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            line-height: 1.1;
            text-align: center;
        }
        
        .gan {
            color: #e74c3c;
        }
        
        .zhi {
            color: #3498db;
        }
        
        .info-section {
            background: linear-gradient(145deg, #74b9ff, #0984e3);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
            box-shadow: 0 10px 20px rgba(116, 185, 255, 0.3);
        }
        
        .info-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .info-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 12px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }
        
        .input-section {
            background: linear-gradient(145deg, #3476b9);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .datetime-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        .input-group label {
            font-size: 0.9em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .input-group input,
        .input-group select {
            padding: 10px;
            border: 2px solid #f2ecec;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }
        
        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .calculate-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1em;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
            display: block;
            margin: 0 auto;
        }
        
        .calculate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 24px rgba(102, 126, 234, 0.4);
        }
        
        .refresh-btn {
            background: linear-gradient(45deg, #11998e, #38ef7d);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 25px;
            cursor: pointer;
            display: block;
            margin: 30px auto 0;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 8px 16px rgba(17, 153, 142, 0.3);
        }
        
        .refresh-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 24px rgba(17, 153, 142, 0.4);
        }
        
        @media (max-width: 768px) {
            .input-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .datetime-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .bazi-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .title {
                font-size: 2em;
            }
            
            .gan-zhi-vertical .gan,
            .gan-zhi-vertical .zhi {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="calculate-btn" onclick="calculateBazi()">ÂÖ´Â≠óÊéíÁõ§</button>
        <!-- Ëº∏ÂÖ•ÂçÄÂüü -->
        <div class="input-section">
            <div class="input-grid">
                <div class="input-group">
                    <label for="nameInput">ÂßìÂêç</label>
                    <input type="text" id="nameInput" placeholder="Ë´ãËº∏ÂÖ•ÂßìÂêç">
                </div>
                <div class="input-group">
                    <label for="genderSelect">ÊÄßÂà•</label>
                    <select id="genderSelect">
                        <option value="Áî∑">Áî∑</option>
                        <option value="Â•≥">Â•≥</option>
                    </select>
                </div>
            </div>
            <div class="datetime-grid">
                <div class="input-group">
                    <label for="yearInput">Âπ¥</label>
                    <input type="number" id="yearInput" min="1900" max="2100" placeholder="1990">
                </div>
                <div class="input-group">
                    <label for="monthInput">Êúà</label>
                    <input type="number" id="monthInput" min="1" max="12" placeholder="1">
                </div>
                <div class="input-group">
                    <label for="dayInput">Êó•</label>
                    <input type="number" id="dayInput" min="1" max="31" placeholder="1">
                </div>
                <div class="input-group">
                    <label for="hourInput">ÊôÇ</label>
                    <input type="number" id="hourInput" min="0" max="23" placeholder="12">
                </div>
            </div>
                    </div>
        
        <div class="date-info" id="dateInfo">
            ËºâÂÖ•‰∏≠...
        </div>
        
        <div class="bazi-container" id="baziContainer">
            <!-- ÂÖ´Â≠óÂ∞áÂú®ÈÄôË£°È°ØÁ§∫ -->
        </div>
        
        <div class="info-section">
            <div class="info-title">üìÖ Ë©≥Á¥∞Ë≥áË®ä</div>
            <div class="info-grid" id="detailInfo">
                <!-- Ë©≥Á¥∞Ë≥áË®äÂ∞áÂú®ÈÄôË£°È°ØÁ§∫ -->
            </div>
        </div>
        
        <button class="refresh-btn" onclick="setToday()">üìÖ ‰ΩøÁî®‰ªäÊó•ÊôÇÈñì</button>
    </div>

    <script>
        function calculateBazi() {
            try {
                // Áç≤ÂèñËº∏ÂÖ•ÂÄº
                const name = document.getElementById('nameInput').value || 'Êú™Ë®≠ÂÆö';
                const gender = document.getElementById('genderSelect').value;
                const year = parseInt(document.getElementById('yearInput').value) || new Date().getFullYear();
                const month = parseInt(document.getElementById('monthInput').value) || new Date().getMonth() + 1;
                const day = parseInt(document.getElementById('dayInput').value) || new Date().getDate();
                const hour = parseInt(document.getElementById('hourInput').value) || new Date().getHours();
                
                // ÂâµÂª∫Êó•ÊúüÂ∞çË±°
                const inputDate = new Date(year, month - 1, day, hour, 0, 0);
                
                // ‰ΩøÁî® lunar-javascript ÂâµÂª∫Ëæ≤ÊõÜÂ∞çË±°
                const lunar = Lunar.fromDate(inputDate);
                const solar = lunar.getSolar();
                
                // Áç≤ÂèñÂÖ´Â≠ó
                const baZi = lunar.getEightChar();
                
                // È°ØÁ§∫Êó•ÊúüË≥áË®ä
                const dateInfo = document.getElementById('dateInfo');
                dateInfo.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <div><strong>ÂßìÂêçÔºö</strong>${name}</div>
                        <div><strong>ÊÄßÂà•Ôºö</strong>${gender}</div>
                    </div>
                    <div><strong>ÂÖ¨ÊõÜÔºö</strong>${solar.getYear()}Âπ¥${solar.getMonth()}Êúà${solar.getDay()}Êó• ${hour}ÊôÇ</div>
                    <div><strong>Ëæ≤ÊõÜÔºö</strong>${lunar.getYearInChinese()}Âπ¥${lunar.getMonthInChinese()}Êúà${lunar.getDayInChinese()}</div>
                    <div><strong>ÊòüÊúüÔºö</strong>${solar.getWeekInChinese()}</div>
                `;
                
                // È°ØÁ§∫ÂÖ´Â≠ó
                const baziContainer = document.getElementById('baziContainer');
                const pillars = [
                    { title: 'ÊôÇÊü±', gan: baZi.getTimeGan(), zhi: baZi.getTimeZhi() },
                    { title: 'Êó•Êü±', gan: baZi.getDayGan(), zhi: baZi.getDayZhi() },
                    { title: 'ÊúàÊü±', gan: baZi.getMonthGan(), zhi: baZi.getMonthZhi() },
                    { title: 'Âπ¥Êü±', gan: baZi.getYearGan(), zhi: baZi.getYearZhi() }
                ];
                
                // Áç≤ÂèñÂçÅÁ•ûÈóú‰øÇ (‰ª•Êó•Âπ≤ÁÇ∫‰∏ª)
                const dayGan = baZi.getDayGan();
                
                const ganWuXing = {
                    'Áî≤': 'Êú®', '‰πô': 'Êú®', '‰∏ô': 'ÁÅ´', '‰∏Å': 'ÁÅ´', 
                    'Êàä': 'Âúü', 'Â∑±': 'Âúü', 'Â∫ö': 'Èáë', 'Ëæõ': 'Èáë', 
                    'Â£¨': 'Ê∞¥', 'Áô∏': 'Ê∞¥'
                };
                
                const zhiWuXing = {
                    'Â≠ê': 'Ê∞¥', '‰∏ë': 'Âúü', 'ÂØÖ': 'Êú®', 'ÂçØ': 'Êú®',
                    'Ëæ∞': 'Âúü', 'Â∑≥': 'ÁÅ´', 'Âçà': 'ÁÅ´', 'Êú™': 'Âúü',
                    'Áî≥': 'Èáë', 'ÈÖâ': 'Èáë', 'Êàå': 'Âúü', '‰∫•': 'Ê∞¥'
                };
                
                const ganYinYang = {
                    'Áî≤': 'ÈôΩ', '‰πô': 'Èô∞', '‰∏ô': 'ÈôΩ', '‰∏Å': 'Èô∞', 
                    'Êàä': 'ÈôΩ', 'Â∑±': 'Èô∞', 'Â∫ö': 'ÈôΩ', 'Ëæõ': 'Èô∞', 
                    'Â£¨': 'ÈôΩ', 'Áô∏': 'Èô∞'
                };
                
                const zhiYinYang = {
                    'Â≠ê': 'ÈôΩ', '‰∏ë': 'Èô∞', 'ÂØÖ': 'ÈôΩ', 'ÂçØ': 'Èô∞',
                    'Ëæ∞': 'ÈôΩ', 'Â∑≥': 'Èô∞', 'Âçà': 'ÈôΩ', 'Êú™': 'Èô∞',
                    'Áî≥': 'ÈôΩ', 'ÈÖâ': 'Èô∞', 'Êàå': 'ÈôΩ', '‰∫•': 'Èô∞'
                };
                
                const wuIndex = { 'Êú®':0,'ÁÅ´':1,'Âúü':2,'Èáë':3,'Ê∞¥':4 };
                const wuNames = ['Êú®','ÁÅ´','Âúü','Èáë','Ê∞¥'];
                const wuColors = ['#22c55e','#ef4444','#64748b','#f59e0b','#3b82f6'];
                
                function getShiShenColor(shiShen) {
                    if (!shiShen) return '#8e44ad';
                    
                    // Ê†πÊìöÂçÅÁ•ûÂ∞çÊáâÁöÑ‰∫îË°åÂ±¨ÊÄß‰æÜÂàÜÈÖçÈ°èËâ≤
                    if (shiShen.includes('ÊØîËÇ©') || shiShen.includes('Âä´Ë≤°')) {
                        return '#8e44ad'; // Á¥´Ëâ≤ - ÊØîÂä´Êòü
                    }
                    if (shiShen.includes('È£üÁ•û') || shiShen.includes('ÂÇ∑ÂÆò')) {
                        return '#22c55e'; // Á∂†Ëâ≤ - È£üÂÇ∑Êòü
                    }
                    if (shiShen.includes('Ê≠£Ë≤°') || shiShen.includes('ÂÅèË≤°')) {
                        return '#f59e0b'; // ÈªÉËâ≤ - Ë≤°Êòü
                    }
                    if (shiShen.includes('Ê≠£ÂÆò') || shiShen.includes('‰∏ÉÊÆ∫')) {
                        return '#ef4444'; // Á¥ÖËâ≤ - ÂÆòÊÆ∫Êòü
                    }
                    if (shiShen.includes('Ê≠£Âç∞') || shiShen.includes('ÂÅèÂç∞')) {
                        return '#3b82f6'; // ËóçËâ≤ - Âç∞Êòü
                    }
                    
                    return '#8e44ad'; // È†êË®≠Á¥´Ëâ≤
                }
                
                function getShiShen(target, dayGan, isZhi = false) {
                    if (!target) return '';
                    
                    if (!isZhi && target === dayGan) return 'ÊØîËÇ©';
                    
                    const dayWuXing = ganWuXing[dayGan];
                    const dayYinYang = ganYinYang[dayGan];
                    const targetWuXing = ganWuXing[target];
                    const targetYinYang = ganYinYang[target];
                    
                    const sameYinYang = dayYinYang === targetYinYang;
                    
                    if (dayWuXing === targetWuXing) {
                        return sameYinYang ? 'ÊØîËÇ©' : 'Âä´Ë≤°';
                    }
                    
                    const wuXingRelation = {
                        'Êú®': { 'ÁÅ´': 'È£üÂÇ∑', 'Âúü': 'Ë≤°Êòü', 'Èáë': 'ÂÆòÊÆ∫', 'Ê∞¥': 'Âç∞Êòü' },
                        'ÁÅ´': { 'Âúü': 'È£üÂÇ∑', 'Èáë': 'Ë≤°Êòü', 'Ê∞¥': 'ÂÆòÊÆ∫', 'Êú®': 'Âç∞Êòü' },
                        'Âúü': { 'Èáë': 'È£üÂÇ∑', 'Ê∞¥': 'Ë≤°Êòü', 'Êú®': 'ÂÆòÊÆ∫', 'ÁÅ´': 'Âç∞Êòü' },
                        'Èáë': { 'Ê∞¥': 'È£üÂÇ∑', 'Êú®': 'Ë≤°Êòü', 'ÁÅ´': 'ÂÆòÊÆ∫', 'Âúü': 'Âç∞Êòü' },
                        'Ê∞¥': { 'Êú®': 'È£üÂÇ∑', 'ÁÅ´': 'Ë≤°Êòü', 'Âúü': 'ÂÆòÊÆ∫', 'Èáë': 'Âç∞Êòü' }
                    };
                    
                    const relation = wuXingRelation[dayWuXing][targetWuXing];
                    
                    if (relation === 'È£üÂÇ∑') return sameYinYang ? 'È£üÁ•û' : 'ÂÇ∑ÂÆò';
                    if (relation === 'Ë≤°Êòü') return sameYinYang ? 'ÂÅèË≤°' : 'Ê≠£Ë≤°';
                    if (relation === 'ÂÆòÊÆ∫') return sameYinYang ? '‰∏ÉÊÆ∫' : 'Ê≠£ÂÆò';
                    if (relation === 'Âç∞Êòü') return sameYinYang ? 'ÂÅèÂç∞' : 'Ê≠£Âç∞';
                    
                    return '';
                }
                
                // Áç≤ÂèñÂú∞ÊîØËóèÂπ≤ÂíåÁõ∏ÈóúÂçÅÁ•û
                const zhiCangGan = {
                    'Â≠ê': ['Áô∏'],
                    '‰∏ë': ['Â∑±', 'Áô∏', 'Ëæõ'],
                    'ÂØÖ': ['Áî≤', '‰∏ô', 'Êàä'],
                    'ÂçØ': ['‰πô'],
                    'Ëæ∞': ['Êàä', '‰πô', 'Áô∏'],
                    'Â∑≥': ['‰∏ô', 'Â∫ö', 'Êàä'],
                    'Âçà': ['‰∏Å', 'Â∑±'],
                    'Êú™': ['Â∑±', '‰∏Å', '‰πô'],
                    'Áî≥': ['Â∫ö', 'Â£¨', 'Êàä'],
                    'ÈÖâ': ['Ëæõ'],
                    'Êàå': ['Êàä', 'Ëæõ', '‰∏Å'],
                    '‰∫•': ['Â£¨', 'Áî≤']
                };
                
                function formatShiShen(shiShen) {
                    if (!shiShen) return '';
                    if (shiShen.length === 2) {
                        // ÂÖ©ÂÄãÂ≠óÁöÑÂçÅÁ•ûÂàÜÊàê‰∏ä‰∏ãÂÖ©Ë°å
                        return shiShen.substring(0, 1) + '<br>' + shiShen.substring(1);
                    }
                    return shiShen;
                }
                
                function getZhiShiShen(zhi, dayGan) {
                    const cangGan = zhiCangGan[zhi];
                    if (!cangGan || cangGan.length === 0) return '';
                    
                    // ÂèñÊâÄÊúâËóèÂπ≤‰∏¶Ë®àÁÆóÂçÅÁ•û
                    const shiShenList = cangGan.map(gan => getShiShen(gan, dayGan, false)).filter(s => s);
                    
                    if (shiShenList.length === 0) return '';
                    
                    // Â¶ÇÊûúÂè™Êúâ‰∏ÄÂÄãÂçÅÁ•ûÔºå‰ΩøÁî®Ê†ºÂºèÂåñÂáΩÊï∏
                    if (shiShenList.length === 1) {
                        return formatShiShen(shiShenList[0]);
                    }
                    
                    // ÂàÜÈõ¢ÂçÅÁ•ûÁöÑÂâçÁ∂¥ÂíåÂæåÁ∂¥
                    const prefixes = shiShenList.map(s => s.substring(0, 1)); // Á¨¨‰∏ÄÂÄãÂ≠ó
                    const suffixes = shiShenList.map(s => s.substring(1));    // ÂæåÈù¢ÁöÑÂ≠ó
                    
                    // Â§öÂÄãÂçÅÁ•ûÊôÇÔºåÁ¨¨‰∏ÄË°åÈ°ØÁ§∫ÂâçÁ∂¥ÔºåÁ¨¨‰∫åË°åÈ°ØÁ§∫ÂæåÁ∂¥
                    return prefixes.join('') + '<br>' + suffixes.join('');
                }
                
                baziContainer.innerHTML = pillars.map(pillar => {
                    const ganShiShen = formatShiShen(getShiShen(pillar.gan, dayGan, false));
                    const zhiShiShen = getZhiShiShen(pillar.zhi, dayGan);
                    return `
                    <div class="pillar">
                        <div class="pillar-title">${pillar.title}</div>
                        <div class="shishen">${ganShiShen}</div>
                        <div class="gan-zhi-vertical">
                            <div class="gan">${pillar.gan}</div>
                            <div class="zhi">${pillar.zhi}</div>
                        </div>
                        <div class="shishen">${zhiShiShen}</div>
                    </div>
                `;}).join('');
                
                // Áç≤ÂèñÁØÄÊ∞£Ë≥áË®ä
                const jieQi = lunar.getJieQi();
                const currentJieQi = jieQi ? jieQi : 'ÁÑ°ÁâπÊÆäÁØÄÊ∞£';
                
                // Áç≤ÂèñÁ¥çÈü≥
                function getNaYin(gan, zhi) {
                    const naYinMap = {
                        'Áî≤Â≠ê': 'Êµ∑‰∏≠Èáë', '‰πô‰∏ë': 'Êµ∑‰∏≠Èáë', '‰∏ôÂØÖ': 'Áàê‰∏≠ÁÅ´', '‰∏ÅÂçØ': 'Áàê‰∏≠ÁÅ´', 
                        'ÊàäËæ∞': 'Â§ßÊûóÊú®', 'Â∑±Â∑≥': 'Â§ßÊûóÊú®', 'Â∫öÂçà': 'Ë∑ØÊóÅÂúü', 'ËæõÊú™': 'Ë∑ØÊóÅÂúü', 
                        'Â£¨Áî≥': 'ÂäçÈãíÈáë', 'Áô∏ÈÖâ': 'ÂäçÈãíÈáë', 'Áî≤Êàå': 'Â±±È†≠ÁÅ´', '‰πô‰∫•': 'Â±±È†≠ÁÅ´',
                        '‰∏ôÂ≠ê': 'Êæó‰∏ãÊ∞¥', '‰∏Å‰∏ë': 'Êæó‰∏ãÊ∞¥', 'ÊàäÂØÖ': 'ÂüéÈ†≠Âúü', 'Â∑±ÂçØ': 'ÂüéÈ†≠Âúü', 
                        'Â∫öËæ∞': 'ÁôΩË†üÈáë', 'ËæõÂ∑≥': 'ÁôΩË†üÈáë', 'Â£¨Âçà': 'Ê•äÊü≥Êú®', 'Áô∏Êú™': 'Ê•äÊü≥Êú®', 
                        'Áî≤Áî≥': 'Ê≥â‰∏≠Ê∞¥', '‰πôÈÖâ': 'Ê≥â‰∏≠Ê∞¥', '‰∏ôÊàå': 'Â±ã‰∏äÂúü', '‰∏Å‰∫•': 'Â±ã‰∏äÂúü',
                        'ÊàäÂ≠ê': 'ÈúπÈùÇÁÅ´', 'Â∑±‰∏ë': 'ÈúπÈùÇÁÅ´', 'Â∫öÂØÖ': 'ÊùæÊüèÊú®', 'ËæõÂçØ': 'ÊùæÊüèÊú®', 
                        'Â£¨Ëæ∞': 'Èï∑ÊµÅÊ∞¥', 'Áô∏Â∑≥': 'Èï∑ÊµÅÊ∞¥', 'Áî≤Âçà': 'Á†Ç‰∏≠Èáë', '‰πôÊú™': 'Á†Ç‰∏≠Èáë', 
                        '‰∏ôÁî≥': 'Â±±‰∏ãÁÅ´', '‰∏ÅÈÖâ': 'Â±±‰∏ãÁÅ´', 'ÊàäÊàå': 'Âπ≥Âú∞Êú®', 'Â∑±‰∫•': 'Âπ≥Âú∞Êú®',
                        'Â∫öÂ≠ê': 'Â£Å‰∏äÂúü', 'Ëæõ‰∏ë': 'Â£Å‰∏äÂúü', 'Â£¨ÂØÖ': 'ÈáëÁÆîÈáë', 'Áô∏ÂçØ': 'ÈáëÁÆîÈáë', 
                        'Áî≤Ëæ∞': '‰ΩõÁáàÁÅ´', '‰πôÂ∑≥': '‰ΩõÁáàÁÅ´', '‰∏ôÂçà': 'Â§©Ê≤≥Ê∞¥', '‰∏ÅÊú™': 'Â§©Ê≤≥Ê∞¥', 
                        'ÊàäÁî≥': 'Â§ßÈ©õÂúü', 'Â∑±ÈÖâ': 'Â§ßÈ©õÂúü', 'Â∫öÊàå': 'ÈáµÈáßÈáë', 'Ëæõ‰∫•': 'ÈáµÈáßÈáë',
                        'Â£¨Â≠ê': 'Ê°ëÊüòÊú®', 'Áô∏‰∏ë': 'Ê°ëÊüòÊú®', 'Áî≤ÂØÖ': 'Â§ßÊ∫™Ê∞¥', '‰πôÂçØ': 'Â§ßÊ∫™Ê∞¥', 
                        '‰∏ôËæ∞': 'Ê≤ô‰∏≠Âúü', '‰∏ÅÂ∑≥': 'Ê≤ô‰∏≠Âúü', 'ÊàäÂçà': 'Â§©‰∏äÁÅ´', 'Â∑±Êú™': 'Â§©‰∏äÁÅ´', 
                        'Â∫öÁî≥': 'Áü≥Ê¶¥Êú®', 'ËæõÈÖâ': 'Áü≥Ê¶¥Êú®', 'Â£¨Êàå': 'Â§ßÊµ∑Ê∞¥', 'Áô∏‰∫•': 'Â§ßÊµ∑Ê∞¥'
                    };
                    return naYinMap[gan + zhi] || 'Êú™Áü•';
                }
                
                // Áç≤ÂèñÁ•ûÁÖû
                function getShenSha(yearZhi, dayGan, dayZhi) {
                    let shenSha = [];
                    
                    // Â§©‰πôË≤¥‰∫∫
                    const tianYi = {
                        'Áî≤': ['‰∏ë', 'Êú™'], '‰πô': ['Â≠ê', 'Áî≥'], '‰∏ô': ['‰∫•', 'ÈÖâ'], '‰∏Å': ['‰∫•', 'ÈÖâ'],
                        'Êàä': ['‰∏ë', 'Êú™'], 'Â∑±': ['Â≠ê', 'Áî≥'], 'Â∫ö': ['‰∏ë', 'Êú™'], 'Ëæõ': ['Âçà', 'ÂØÖ'],
                        'Â£¨': ['ÂçØ', 'Â∑≥'], 'Áô∏': ['ÂçØ', 'Â∑≥']
                    };
                    
                    if (tianYi[dayGan]) {
                        tianYi[dayGan].forEach(zhi => {
                            if ([baZi.getYearZhi(), baZi.getMonthZhi(), baZi.getDayZhi(), baZi.getTimeZhi()].includes(zhi)) {
                                shenSha.push('Â§©‰πôË≤¥‰∫∫');
                            }
                        });
                    }
                    
                    // Ê°ÉËä±Êòü
                    const taoHua = {
                        'ÂØÖÂçàÊàå': 'ÂçØ', 'Áî≥Â≠êËæ∞': 'ÈÖâ', 'Â∑≥ÈÖâ‰∏ë': 'Âçà', '‰∫•ÂçØÊú™': 'Â≠ê'
                    };
                    
                    const yearZhiGroup = ['ÂØÖ', 'Âçà', 'Êàå'].includes(yearZhi) ? 'ÂØÖÂçàÊàå' :
                                       ['Áî≥', 'Â≠ê', 'Ëæ∞'].includes(yearZhi) ? 'Áî≥Â≠êËæ∞' :
                                       ['Â∑≥', 'ÈÖâ', '‰∏ë'].includes(yearZhi) ? 'Â∑≥ÈÖâ‰∏ë' :
                                       ['‰∫•', 'ÂçØ', 'Êú™'].includes(yearZhi) ? '‰∫•ÂçØÊú™' : '';
                    
                    if (yearZhiGroup && [baZi.getYearZhi(), baZi.getMonthZhi(), baZi.getDayZhi(), baZi.getTimeZhi()].includes(taoHua[yearZhiGroup])) {
                        shenSha.push('Ê°ÉËä±Êòü');
                    }
                    
                    // ÊñáÊòåÊòü
                    const wenChang = {
                        'Áî≤': 'Â∑≥', '‰πô': 'Âçà', '‰∏ô': 'Áî≥', '‰∏Å': 'ÈÖâ', 'Êàä': 'Áî≥',
                        'Â∑±': 'ÈÖâ', 'Â∫ö': '‰∫•', 'Ëæõ': 'Â≠ê', 'Â£¨': 'ÂØÖ', 'Áô∏': 'ÂçØ'
                    };
                    
                    if (wenChang[dayGan] && [baZi.getYearZhi(), baZi.getMonthZhi(), baZi.getDayZhi(), baZi.getTimeZhi()].includes(wenChang[dayGan])) {
                        shenSha.push('ÊñáÊòåÊòü');
                    }
                    
                    return shenSha.length > 0 ? shenSha.join('„ÄÅ') : 'ÁÑ°ÁâπÊÆäÁ•ûÁÖû';
                }
                
                // Áç≤ÂèñÊú¨ÂëΩÂÖÉÁ•û
                function getBenMing(dayGan) {
                    const benMingMap = {
                        'Áî≤': 'Áî≤Êú®ÂèÉÂ§©', '‰πô': '‰πôÊú®Ëä±Ëçâ', '‰∏ô': '‰∏ôÁÅ´Â§™ÈôΩ', '‰∏Å': '‰∏ÅÁÅ´ÁáàÁá≠',
                        'Êàä': 'ÊàäÂúüÂüéÁâÜ', 'Â∑±': 'Â∑±ÂúüÁî∞Âúí', 'Â∫ö': 'Â∫öÈáëÂäçÊàü', 'Ëæõ': 'ËæõÈáëÁè†Áéâ',
                        'Â£¨': 'Â£¨Ê∞¥Ê±üÊ≤≥', 'Áô∏': 'Áô∏Ê∞¥Èõ®Èú≤'
                    };
                    return benMingMap[dayGan] || 'Êú™Áü•';
                }
                
                // Áç≤ÂèñÊòüÈÅãÊ†ºÂ±Ä
                function getXingYun(baZi) {
                    const dayGan = baZi.getDayGan();
                    const monthZhi = baZi.getMonthZhi();
                    
                    // Á∞°ÂåñÁöÑÊ†ºÂ±ÄÂà§Êñ∑
                    const geJuMap = {
                        'Áî≤': {
                            'ÂØÖ': 'Âª∫Á•øÊ†º', 'ÂçØ': 'ÁæäÂàÉÊ†º', 'Â∑≥': 'ÂÅèË≤°Ê†º', 'Âçà': 'Ê≠£Ë≤°Ê†º',
                            'Áî≥': '‰∏ÉÊÆ∫Ê†º', 'ÈÖâ': 'Ê≠£ÂÆòÊ†º', '‰∫•': 'Ê≠£Âç∞Ê†º', 'Â≠ê': 'ÂÅèÂç∞Ê†º'
                        },
                        '‰πô': {
                            'ÂçØ': 'Âª∫Á•øÊ†º', 'ÂØÖ': 'ÁæäÂàÉÊ†º', 'Âçà': 'ÂÅèË≤°Ê†º', 'Êú™': 'Ê≠£Ë≤°Ê†º',
                            'ÈÖâ': '‰∏ÉÊÆ∫Ê†º', 'Áî≥': 'Ê≠£ÂÆòÊ†º', 'Â≠ê': 'Ê≠£Âç∞Ê†º', '‰∫•': 'ÂÅèÂç∞Ê†º'
                        },
                        '‰∏ô': {
                            'Âçà': 'Âª∫Á•øÊ†º', 'Â∑≥': 'ÁæäÂàÉÊ†º', 'Áî≥': 'ÂÅèË≤°Ê†º', 'ÈÖâ': 'Ê≠£Ë≤°Ê†º',
                            'Â≠ê': '‰∏ÉÊÆ∫Ê†º', '‰∫•': 'Ê≠£ÂÆòÊ†º', 'ÂØÖ': 'Ê≠£Âç∞Ê†º', 'ÂçØ': 'ÂÅèÂç∞Ê†º'
                        },
                        '‰∏Å': {
                            'Â∑≥': 'Âª∫Á•øÊ†º', 'Âçà': 'ÁæäÂàÉÊ†º', 'ÈÖâ': 'ÂÅèË≤°Ê†º', 'Êàå': 'Ê≠£Ë≤°Ê†º',
                            '‰∫•': '‰∏ÉÊÆ∫Ê†º', 'Â≠ê': 'Ê≠£ÂÆòÊ†º', 'ÂçØ': 'Ê≠£Âç∞Ê†º', 'ÂØÖ': 'ÂÅèÂç∞Ê†º'
                        },
                        'Êàä': {
                            'Â∑≥': 'Âª∫Á•øÊ†º', 'Âçà': 'ÁæäÂàÉÊ†º', 'Â≠ê': 'ÂÅèË≤°Ê†º', '‰∫•': 'Ê≠£Ë≤°Ê†º',
                            'ÂØÖ': '‰∏ÉÊÆ∫Ê†º', 'ÂçØ': 'Ê≠£ÂÆòÊ†º', 'Âçà': 'Ê≠£Âç∞Ê†º', 'Â∑≥': 'ÂÅèÂç∞Ê†º'
                        },
                        'Â∑±': {
                            'Âçà': 'Âª∫Á•øÊ†º', 'Â∑≥': 'ÁæäÂàÉÊ†º', '‰∫•': 'ÂÅèË≤°Ê†º', 'Â≠ê': 'Ê≠£Ë≤°Ê†º',
                            'ÂçØ': '‰∏ÉÊÆ∫Ê†º', 'ÂØÖ': 'Ê≠£ÂÆòÊ†º', 'Â∑≥': 'Ê≠£Âç∞Ê†º', 'Âçà': 'ÂÅèÂç∞Ê†º'
                        },
                        'Â∫ö': {
                            'Áî≥': 'Âª∫Á•øÊ†º', 'ÈÖâ': 'ÁæäÂàÉÊ†º', 'ÂØÖ': 'ÂÅèË≤°Ê†º', 'ÂçØ': 'Ê≠£Ë≤°Ê†º',
                            'Âçà': '‰∏ÉÊÆ∫Ê†º', 'Â∑≥': 'Ê≠£ÂÆòÊ†º', 'Êàå': 'Ê≠£Âç∞Ê†º', '‰∏ë': 'ÂÅèÂç∞Ê†º'
                        },
                        'Ëæõ': {
                            'ÈÖâ': 'Âª∫Á•øÊ†º', 'Áî≥': 'ÁæäÂàÉÊ†º', 'ÂçØ': 'ÂÅèË≤°Ê†º', 'ÂØÖ': 'Ê≠£Ë≤°Ê†º',
                            'Â∑≥': '‰∏ÉÊÆ∫Ê†º', 'Âçà': 'Ê≠£ÂÆòÊ†º', '‰∏ë': 'Ê≠£Âç∞Ê†º', 'Êàå': 'ÂÅèÂç∞Ê†º'
                        },
                        'Â£¨': {
                            'Â≠ê': 'Âª∫Á•øÊ†º', '‰∫•': 'ÁæäÂàÉÊ†º', 'Ëæ∞': 'ÂÅèË≤°Ê†º', 'Êàå': 'Ê≠£Ë≤°Ê†º',
                            'Âçà': '‰∏ÉÊÆ∫Ê†º', 'Â∑≥': 'Ê≠£ÂÆòÊ†º', 'Áî≥': 'Ê≠£Âç∞Ê†º', 'ÈÖâ': 'ÂÅèÂç∞Ê†º'
                        },
                        'Áô∏': {
                            '‰∫•': 'Âª∫Á•øÊ†º', 'Â≠ê': 'ÁæäÂàÉÊ†º', 'Êàå': 'ÂÅèË≤°Ê†º', 'Ëæ∞': 'Ê≠£Ë≤°Ê†º',
                            'Â∑≥': '‰∏ÉÊÆ∫Ê†º', 'Âçà': 'Ê≠£ÂÆòÊ†º', 'ÈÖâ': 'Ê≠£Âç∞Ê†º', 'Áî≥': 'ÂÅèÂç∞Ê†º'
                        }
                    };
                    
                    const geJu = geJuMap[dayGan]?.[monthZhi] || 'ÊôÆÈÄöÊ†ºÂ±Ä';
                    return geJu;
                }
                
                // È°ØÁ§∫Ë©≥Á¥∞Ë≥áË®ä
                const detailInfo = document.getElementById('detailInfo');
                const yearAnimal = lunar.getYearShengXiao();
                const naYinYear = getNaYin(baZi.getYearGan(), baZi.getYearZhi());
                const naYinDay = getNaYin(baZi.getDayGan(), baZi.getDayZhi());
                const shenSha = getShenSha(baZi.getYearZhi(), baZi.getDayGan(), baZi.getDayZhi());
                const benMing = getBenMing(baZi.getDayGan());
                const xingYun = getXingYun(baZi);
                
                detailInfo.innerHTML = `
                    <div class="info-item">
                        <strong>ÁîüËÇñÔºö</strong>${yearAnimal}Âπ¥
                    </div>
                    <div class="info-item">
                        <strong>ÁØÄÊ∞£Ôºö</strong>${currentJieQi}
                    </div>
                    <div class="info-item">
                        <strong>ÊòüÂ∫ßÔºö</strong>${solar.getXingZuo()}
                    </div>
                    <div class="info-item">
                        <strong>Âπ¥Êü±Á¥çÈü≥Ôºö</strong>${naYinYear}
                    </div>
                    <div class="info-item">
                        <strong>Êó•Êü±Á¥çÈü≥Ôºö</strong>${naYinDay}
                    </div>
                    <div class="info-item">
                        <strong>Êú¨ÂëΩÂÖÉÁ•ûÔºö</strong>${benMing}
                    </div>
                    <div class="info-item">
                        <strong>ÂëΩÊ†ºÔºö</strong>${xingYun}
                    </div>
                    <div class="info-item">
                        <strong>Á•ûÁÖûÔºö</strong>${shenSha}
                    </div>
                    <div class="info-item">
                        <strong>Ëæ≤ÊõÜÊúàÁõ∏Ôºö</strong>${lunar.getYueXiang()}
                    </div>
                    <div class="info-item">
                        <strong>ÊôÇËæ∞Ôºö</strong>${lunar.getTimeZhi()}ÊôÇ
                    </div>
                `;
                
            } catch (error) {
                console.error('Ë®àÁÆóÂÖ´Â≠óÊôÇÁôºÁîüÈåØË™§:', error);
                document.getElementById('baziContainer').innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; color: #e74c3c; padding: 20px;">
                        <h3>Ë®àÁÆóÂ§±Êïó</h3>
                        <p>ÁÑ°Ê≥ïËºâÂÖ• lunar-javascript Â∫´ÔºåË´ãÊ™¢Êü•Á∂≤Ë∑ØÈÄ£Êé•„ÄÇ</p>
                        <p>ÈåØË™§Ë©≥ÊÉÖÔºö${error.message}</p>
                    </div>
                `;
            }
        }
        
        function setToday() {
            const now = new Date();
            document.getElementById('yearInput').value = now.getFullYear();
            document.getElementById('monthInput').value = now.getMonth() + 1;
            document.getElementById('dayInput').value = now.getDate();
            document.getElementById('hourInput').value = now.getHours();
            calculateBazi();
        }
        
        // È†ÅÈù¢ËºâÂÖ•ÊôÇËá™ÂãïË®≠ÂÆö‰ªäÊó•ÊôÇÈñì‰∏¶Ë®àÁÆó
        window.addEventListener('load', function() {
            // Á®çÂæÆÂª∂ÈÅ≤‰ª•Á¢∫‰øùÂ∫´Â∑≤ËºâÂÖ•
            setTimeout(() => {
                setToday();
            }, 500);
        });
    </script>
</body>
</html>        