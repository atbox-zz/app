<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>ğŸ’˜ æˆ€æ„› AI æ•™ç·´</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{width:100%;overflow-x:hidden}
body{font-family:'Segoe UI',sans-serif;background:linear-gradient(160deg,#f8a5c2 0%,#e056a0 60%,#764ba2 100%);min-height:100vh;padding:12px}

h1{color:#fff;text-align:center;font-size:clamp(1.3rem,6vw,2rem);text-shadow:0 2px 8px rgba(0,0,0,0.25);margin-bottom:3px}
.subtitle{color:rgba(255,255,255,0.88);text-align:center;font-size:clamp(0.78rem,3.5vw,1rem);margin-bottom:14px}

.card{background:#fff;border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,0.13);padding:14px;margin-bottom:12px}
h2{color:#e056a0;font-size:clamp(0.95rem,4.5vw,1.25rem);margin-bottom:10px;display:flex;align-items:center;gap:6px}
h3{color:#764ba2;font-size:clamp(0.85rem,3.5vw,1rem);margin-bottom:6px}

/* å ´æ™¯æŒ‰éˆ• - 2åˆ—æ‰‹æ©Ÿå‹å–„ */
.scenes{display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
@media(min-width:480px){.scenes{grid-template-columns:repeat(6,1fr)}}
.sbtn{padding:10px 4px;border:2px solid #eee;border-radius:12px;background:#fafafa;cursor:pointer;text-align:center;transition:all .2s;font-size:clamp(0.65rem,2.8vw,0.82rem);color:#555;line-height:1.4;width:100%}
.sbtn .emo{font-size:clamp(1.3rem,5vw,1.7rem);display:block;margin-bottom:3px}
.sbtn:active{transform:scale(.94)}
.sbtn.active{border-color:#e056a0;background:linear-gradient(135deg,#fce4f3,#f9d0ea);color:#e056a0;font-weight:700}

/* è¨“ç·´è³‡æ–™ */
.train-list{background:#fdf0f8;border-radius:10px;padding:10px}
.train-row{padding:7px 0;border-bottom:1px dashed #f0c0d8;font-size:clamp(0.7rem,2.8vw,0.88rem);line-height:1.5}
.train-row:last-child{border-bottom:none}
.train-row .top{display:flex;align-items:center;gap:5px;flex-wrap:wrap;margin-bottom:3px}
.io{background:#e056a0;color:#fff;border-radius:5px;padding:2px 7px;font-size:clamp(0.62rem,2.5vw,0.78rem);white-space:nowrap;flex-shrink:0}
.io.out{background:#764ba2}
.arrow{color:#ccc}
.train-row .lbl{color:#888;font-size:clamp(0.65rem,2.5vw,0.82rem)}

/* ìº”ë²„ìŠ¤ */
#nn-canvas{width:100%;display:block;border-radius:12px;background:#1a1a2e}

/* è¨“ç·´æ§åˆ¶ */
.btn-row{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px}
.btn{padding:13px 6px;border:none;border-radius:10px;cursor:pointer;font-weight:700;font-size:clamp(0.82rem,3.5vw,1rem);transition:all .2s;color:#fff;touch-action:manipulation}
.btn:active{transform:scale(.96)}
.btn-train{background:linear-gradient(135deg,#f093fb,#f5576c)}
.btn-auto{background:linear-gradient(135deg,#4facfe,#00f2fe)}
.btn-reset{background:linear-gradient(135deg,#a18cd1,#fbc2eb);grid-column:1/-1}
.stats{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.stat-box{background:linear-gradient(135deg,#fce4f3,#f9d0ea);border-radius:10px;padding:10px;text-align:center}
.stat-lbl{font-size:clamp(0.7rem,2.8vw,0.85rem);color:#aaa;margin-bottom:3px}
.stat-val{font-size:clamp(1.3rem,6vw,1.8rem);font-weight:900;color:#e056a0}

/* æ»‘æ¡¿ */
.slider-wrap{margin-bottom:14px}
.sl-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px}
.sl-top span:first-child{font-weight:600;color:#555;font-size:clamp(0.82rem,3.5vw,1rem)}
.sl-pct{font-size:clamp(0.9rem,4vw,1.1rem);font-weight:700;color:#e056a0;min-width:42px;text-align:right}
input[type=range]{width:100%;-webkit-appearance:none;appearance:none;height:7px;border-radius:4px;background:#f0c0d8;outline:none;cursor:pointer}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:26px;height:26px;border-radius:50%;background:linear-gradient(135deg,#f093fb,#e056a0);cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.18)}
input[type=range]::-moz-range-thumb{width:26px;height:26px;border-radius:50%;background:linear-gradient(135deg,#f093fb,#e056a0);cursor:pointer;border:none;box-shadow:0 2px 8px rgba(0,0,0,0.18)}

.predict-btn{width:100%;padding:16px;border:none;border-radius:12px;background:linear-gradient(135deg,#fa709a,#fee140);color:#fff;font-weight:700;font-size:clamp(1rem,4.5vw,1.2rem);cursor:pointer;margin-top:6px;box-shadow:0 4px 15px rgba(250,112,154,0.4);touch-action:manipulation;transition:all .2s}
.predict-btn:active{transform:scale(.97)}

/* çµæœ */
.result-box{border-radius:12px;padding:16px;text-align:center;margin-top:12px;display:none;border:2px solid transparent;animation:pop .3s ease}
.result-box.show{display:block}
.r-emo{font-size:clamp(2rem,10vw,3rem);margin-bottom:6px}
.r-text{font-size:clamp(1.2rem,5.5vw,1.7rem);font-weight:700;margin-bottom:5px}
.r-pct{font-size:clamp(1.4rem,7vw,2rem);font-weight:900;margin-bottom:8px}
.r-advice{font-size:clamp(0.8rem,3.2vw,0.95rem);line-height:1.7;background:rgba(255,255,255,0.75);border-radius:8px;padding:10px;color:#555}

/* èªªæ˜ */
.steps{display:grid;gap:10px}
.step{display:flex;gap:10px;align-items:flex-start}
.step-ico{font-size:clamp(1.5rem,6vw,1.9rem);flex-shrink:0;line-height:1}
.step-text h4{color:#555;font-weight:700;margin-bottom:2px;font-size:clamp(0.85rem,3.5vw,1rem)}
.step-text p{color:#999;font-size:clamp(0.75rem,3vw,0.88rem);line-height:1.5}
.tip-box{background:linear-gradient(135deg,#ffecd2,#fcb69f);border-radius:10px;padding:13px;margin-top:10px}
.tip-box p{font-size:clamp(0.75rem,3vw,0.9rem);color:#7d4e2e;line-height:1.9}
.disclaimer{background:#fff9e6;border:1px solid #ffd700;border-radius:10px;padding:10px;text-align:center;font-size:clamp(0.72rem,3vw,0.85rem);color:#8a6d00;margin-top:6px}

@keyframes pop{from{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
.pulsing{animation:pulse 1s infinite}
</style>
</head>
<body>

<h1>ğŸ’˜ æˆ€æ„› AI æ•™ç·´</h1>
<p class="subtitle">ç”¨ç¥ç¶“ç¶²è·¯åˆ†æè¿½å¥³ç”Ÿçš„æœ€ä½³æ™‚æ©Ÿï¼</p>

<!-- å ´æ™¯ -->
<div class="card">
  <h2>ğŸ’‘ é¸æ“‡å ´æ™¯</h2>
  <div class="scenes" id="scenes"></div>
</div>

<!-- ç¥ç¶“ç¶²è·¯ç•«å¸ƒ -->
<div class="card">
  <h2>ğŸ§  ç¥ç¶“ç¶²è·¯çµæ§‹</h2>
  <canvas id="nn-canvas"></canvas>
</div>

<!-- è¨“ç·´è³‡æ–™ -->
<div class="card">
  <h2 id="scene-title">ğŸ“š å­¸ç¿’æ¡ˆä¾‹</h2>
  <p id="scene-desc" style="color:#aaa;font-size:clamp(0.78rem,3vw,0.92rem);margin-bottom:10px;line-height:1.5"></p>
  <div class="train-list" id="train-list"></div>
</div>

<!-- è¨“ç·´ -->
<div class="card">
  <h2>ğŸ® è¨“ç·´ AI</h2>
  <div class="btn-row">
    <button class="btn btn-train" onclick="trainOnce()">ğŸ’ª å­¸ç¿’ä¸€æ¬¡</button>
    <button class="btn btn-auto" id="auto-btn" onclick="toggleAuto()">ğŸš€ å¿«é€Ÿè¨“ç·´</button>
    <button class="btn btn-reset" onclick="resetNN()">ğŸ”„ é‡æ–°é–‹å§‹</button>
  </div>
  <div class="stats">
    <div class="stat-box"><div class="stat-lbl">å­¸ç¿’æ¬¡æ•¸</div><div class="stat-val" id="epoch-val">0</div></div>
    <div class="stat-box"><div class="stat-lbl">æˆ€æ„›æ™ºæ…§</div><div class="stat-val" id="acc-val">0%</div></div>
  </div>
</div>

<!-- æ¸¬è©¦ -->
<div class="card">
  <h2>ğŸ”® æ¸¬è©¦ä½ çš„æƒ…æ³</h2>
  <div class="slider-wrap">
    <div class="sl-top"><span id="lbl-a">æ¢ä»¶A</span><span class="sl-pct" id="pct-a">50%</span></div>
    <input type="range" id="sl-a" min="0" max="100" value="50">
  </div>
  <div class="slider-wrap">
    <div class="sl-top"><span id="lbl-b">æ¢ä»¶B</span><span class="sl-pct" id="pct-b">50%</span></div>
    <input type="range" id="sl-b" min="0" max="100" value="50">
  </div>
  <button class="predict-btn" onclick="predict()">ğŸ’˜ AI æˆ€æ„›é¡§å•çš„å»ºè­°ï¼Ÿ</button>
  <div class="result-box" id="result-box">
    <div class="r-emo" id="r-emo"></div>
    <div class="r-text" id="r-text"></div>
    <div class="r-pct" id="r-pct"></div>
    <div class="r-advice" id="r-advice"></div>
  </div>
</div>

<!-- åŸç† -->
<div class="card">
  <h2>ğŸ¤– AI æ€éº¼å­¸æœƒè¿½å¥³ç”Ÿçš„ï¼Ÿ</h2>
  <div class="steps">
    <div class="step"><span class="step-ico">ğŸ’”</span><div class="step-text"><h4>æ–°æ‰‹ä»€éº¼éƒ½ä¸æ‡‚</h4><p>åƒæ²’è«‡éæˆ€æ„›çš„å®…ç”·ï¼Œäº‚çŒœç­”æ¡ˆ</p></div></div>
    <div class="step"><span class="step-ico">ğŸ“–</span><div class="step-text"><h4>è§€å¯ŸæˆåŠŸ / å¤±æ•—æ¡ˆä¾‹</h4><p>çœ‹å­¸é•·å­¸å§çš„æˆåŠŸç¶“é©—å’Œæ…˜ç—›æ•™è¨“</p></div></div>
    <div class="step"><span class="step-ico">ğŸ¯</span><div class="step-text"><h4>æ‰¾å‡ºè¿½æ±‚çš„é»ƒé‡‘æ³•å‰‡</h4><p>æ­¸ç´å‡ºã€Œä»€éº¼æƒ…æ³è©²åšä»€éº¼ã€çš„è¦å¾‹</p></div></div>
    <div class="step"><span class="step-ico">ğŸ’¯</span><div class="step-text"><h4>è®Šæˆæˆ€æ„›å°ˆå®¶</h4><p>é¢å°æ–°æƒ…æ³ä¹Ÿèƒ½çµ¦å‡ºæ­£ç¢ºå»ºè­°</p></div></div>
  </div>
  <div class="tip-box">
    <p>ğŸ’¡ <strong>å°±åƒäººé¡å­¸æˆ€æ„›ï¼š</strong><br>
    â€¢ å°ç™½ï¼šçœ‹åˆ°å–œæ­¡çš„å°±å‘Šç™½ â†’ è¢«ç™¼å¡<br>
    â€¢ å­¸ç¿’ï¼šè½æœ‹å‹åˆ†äº«ã€çœ‹PTTæ–‡ç« <br>
    â€¢ é€²æ­¥ï¼šçŸ¥é“è¦å…ˆåŸ¹é¤Šæ„Ÿæƒ…ã€çœ‹æ™‚æ©Ÿ<br>
    â€¢ é«˜æ‰‹ï¼šèƒ½æº–ç¢ºåˆ¤æ–·å°æ–¹å¿ƒæ„ ğŸ“</p>
  </div>
  <div class="disclaimer">âš ï¸ æ•™å­¸ç”¨é€”ï¼Œå¯¦éš›è¿½æ±‚è«‹å°Šé‡å°æ–¹æ„é¡˜ï¼ŒçœŸå¿ƒèª æ„æœ€é‡è¦ ğŸ’–</div>
</div>

<script>
// ============ ç¥ç¶“ç¶²è·¯ ============
class NN {
  constructor(lr=0.5){
    this.lr=lr;
    this.w1=this.rm(2,4); this.w2=this.rm(4,1);
    this.b1=this.ra(4);   this.b2=this.ra(1);
    this.H=[0,0,0,0]; this.O=[0];
  }
  rm(r,c){return Array(r).fill(0).map(()=>Array(c).fill(0).map(()=>Math.random()*2-1))}
  ra(n){return Array(n).fill(0).map(()=>Math.random()*2-1)}
  sig(x){return 1/(1+Math.exp(-x))}
  sd(x){return x*(1-x)}
  forward(inp){
    this.H=this.b1.map((b,i)=>this.sig(inp.reduce((s,v,j)=>s+v*this.w1[j][i],b)));
    this.O=this.b2.map((b,i)=>this.sig(this.H.reduce((s,v,j)=>s+v*this.w2[j][i],b)));
    return this.O;
  }
  train(inp,tgt){
    const o=this.forward(inp);
    const oe=o.map((v,i)=>tgt[i]-v);
    const od=o.map((v,i)=>oe[i]*this.sd(v));
    const he=this.H.map((_,i)=>od.reduce((s,d,j)=>s+d*this.w2[i][j],0));
    const hd=this.H.map((h,i)=>he[i]*this.sd(h));
    this.w2.forEach((r,i)=>r.forEach((_,j)=>{this.w2[i][j]+=this.lr*od[j]*this.H[i]}));
    this.w1.forEach((r,i)=>r.forEach((_,j)=>{this.w1[i][j]+=this.lr*hd[j]*inp[i]}));
    this.b2=this.b2.map((b,i)=>b+this.lr*od[i]);
    this.b1=this.b1.map((b,i)=>b+this.lr*hd[i]);
    return Math.abs(oe[0]);
  }
  predict(inp){return this.forward(inp)[0]}
}

// ============ å ´æ™¯ ============
const SCENES=[
  {id:'confess',emoji:'ğŸ’Œ',name:'å‘Šç™½æ™‚æ©Ÿ',
   desc:'æ ¹æ“šã€Œå¥¹å°ä½ æœ‰å¥½æ„Ÿã€å’Œã€Œèªè­˜å¤ ä¹…ã€æ±ºå®šè¦ä¸è¦å‘Šç™½',
   lblA:'ğŸ’• å¥¹æœ‰å¥½æ„Ÿ',lblB:'â° èªè­˜å¤ ä¹…',out:'ğŸ’ ç¾åœ¨å‘Šç™½',
   data:[{a:0,b:0,y:0,lbl:'ğŸ˜¢ ç„¡æ„Ÿ+æ‰èªè­˜ â†’ æœƒè¢«ç™¼å¥½äººå¡'},
         {a:0,b:1,y:0.1,lbl:'ğŸ˜” ç„¡æ„Ÿ+èªè­˜ä¹… â†’ å‹é”ä»¥ä¸Šå¾ˆå±éšª'},
         {a:1,b:0,y:0.3,lbl:'ğŸ¤” æœ‰æ„Ÿ+æ‰èªè­˜ â†’ å¤ªæ€¥äº†ï¼Œå†ç­‰ç­‰'},
         {a:1,b:1,y:1,  lbl:'ğŸ‰ æœ‰æ„Ÿ+èªè­˜ä¹… â†’ å°±æ˜¯ç¾åœ¨ï¼è¡ï¼'}]},
  {id:'date',emoji:'ğŸ¬',name:'ç´„çœ‹é›»å½±',
   desc:'æ ¹æ“šã€Œå¥¹å¿ƒæƒ…å¥½ã€å’Œã€Œä½ å€‘èŠå¾—é–‹å¿ƒã€æ±ºå®šè¦ä¸è¦ç´„',
   lblA:'ğŸ˜Š å¥¹å¿ƒæƒ…å¥½',lblB:'ğŸ’¬ èŠå¾—é–‹å¿ƒ',out:'ğŸ« ç´„çœ‹é›»å½±',
   data:[{a:0,b:0,y:0,  lbl:'ğŸ˜° å¿ƒæƒ…å·®+æ²’è©±èŠ â†’ çµ•å°åˆ¥ç´„'},
         {a:0,b:1,y:0.2,lbl:'ğŸ˜• å¿ƒæƒ…å·®+èŠå¾—ä¾† â†’ å®‰æ…°å°±å¥½'},
         {a:1,b:0,y:0.3,lbl:'ğŸ¤¨ å¿ƒæƒ…å¥½+æ²’è©±é¡Œ â†’ å¯èƒ½è¢«æ‹’çµ•'},
         {a:1,b:1,y:1,  lbl:'âœ¨ å¿ƒæƒ…å¥½+æœ‰è©±èŠ â†’ æœ€ä½³æ™‚æ©Ÿï¼'}]},
  {id:'text',emoji:'ğŸ“±',name:'è¨Šæ¯äº’å‹•',
   desc:'æ ¹æ“šã€Œå¥¹ç§’å›ã€å’Œã€Œå¥¹ä¸»å‹•æ‰¾ä½ ã€æ±ºå®šç©ä¸ç©æ¥µ',
   lblA:'âš¡ å¥¹ç§’å›',lblB:'ğŸ‘‹ å¥¹ä¸»å‹•æ‰¾',out:'ğŸ”¥ ç©æ¥µäº’å‹•',
   data:[{a:0,b:0,y:0,  lbl:'ğŸ’” ä¸ç§’å›+ä¸ä¸»å‹• â†’ åˆ¥ç…©å¥¹äº†'},
         {a:0,b:1,y:0.4,lbl:'ğŸ¤· ä¸ç§’å›+ä¸»å‹•æ‰¾ â†’ å¥¹å¯èƒ½å¾ˆå¿™'},
         {a:1,b:0,y:0.6,lbl:'ğŸ˜Š ç§’å›+ä¸ä¸»å‹• â†’ å¥¹å®³ç¾ï¼Œæ…¢æ…¢ä¾†'},
         {a:1,b:1,y:1,  lbl:'ğŸ’¯ ç§’å›+ä¸»å‹•æ‰¾ â†’ ç©©äº†ï¼ç¹¼çºŒèŠ'}]},
  {id:'gift',emoji:'ğŸ',name:'é€ç¦®æ±ºç­–',
   desc:'æ ¹æ“šã€Œå¥¹æéæƒ³è¦ã€å’Œã€Œç‰¹æ®Šç¯€æ—¥ã€æ±ºå®šé€ä¸é€',
   lblA:'ğŸ—£ï¸ å¥¹èªªæƒ³è¦',lblB:'ğŸ‚ ç‰¹æ®Šç¯€æ—¥',out:'ğŸ’ é€è²´é‡ç¦®',
   data:[{a:0,b:0,y:0,  lbl:'ğŸš« æ²’æ+å¹³å¸¸æ—¥ â†’ é€äº†åè€Œå¥‡æ€ª'},
         {a:0,b:1,y:0.4,lbl:'ğŸˆ æ²’æ+ç¯€æ—¥ â†’ å°ç¦®ç‰©æ„æ€åˆ°'},
         {a:1,b:0,y:0.5,lbl:'ğŸ’­ æé+å¹³å¸¸æ—¥ â†’ å¯ä»¥ä½†åˆ¥å¤ªè²´'},
         {a:1,b:1,y:1,  lbl:'ğŸ’ æé+ç¯€æ—¥ â†’ é€ï¼åŠ åˆ†è¶…å¤šï¼'}]},
  {id:'jealous',emoji:'ğŸ˜¤',name:'åƒé†‹è¨Šè™Ÿ',
   desc:'æ ¹æ“šã€Œå¥¹åƒé†‹ã€å’Œã€Œç¢ºå®šé—œä¿‚äº†ã€åˆ¤æ–·æ˜¯ä¸æ˜¯å¥½è¨Šè™Ÿ',
   lblA:'ğŸ˜¤ å¥¹åƒé†‹',lblB:'ğŸ’‘ ç¢ºå®šé—œä¿‚',out:'ğŸ’– é€™æ˜¯å¥½äº‹',
   data:[{a:0,b:0,y:0.1,lbl:'ğŸ˜ ä¸åƒé†‹+æ²’ç¢ºå®š â†’ å¥¹ä¸åœ¨ä¹ä½ '},
         {a:0,b:1,y:0.2,lbl:'ğŸ˜Œ ä¸åƒé†‹+æœ‰é—œä¿‚ â†’ æ„Ÿæƒ…å¯èƒ½æ·¡äº†'},
         {a:1,b:0,y:0.8,lbl:'ğŸ˜ åƒé†‹+æ²’ç¢ºå®š â†’ å¿«å»å‘Šç™½ï¼'},
         {a:1,b:1,y:1,  lbl:'ğŸ¥° åƒé†‹+æœ‰é—œä¿‚ â†’ å¥¹å¾ˆæ„›ä½ ï¼Œç”œèœœ'}]},
  {id:'reply',emoji:'ğŸ’¬',name:'å·²è®€åˆ¤æ–·',
   desc:'æ ¹æ“šã€Œä¹‹å‰èŠå¾—å¥½ã€å’Œã€Œæœ€è¿‘æœ‰æŒ‰è®šã€åˆ¤æ–·å·²è®€æ˜¯å¦æ­£å¸¸',
   lblA:'ğŸ¤ ä¹‹å‰èŠå¾—å¥½',lblB:'â¤ï¸ æœ€è¿‘æœ‰æŒ‰è®š',out:'âœ… é‚„æœ‰å¸Œæœ›',
   data:[{a:0,b:0,y:0,  lbl:'ğŸ’€ æ²’èŠå¥½+æ²’æŒ‰è®š â†’ æ”¾æ£„å§'},
         {a:0,b:1,y:0.5,lbl:'ğŸ¤” æ²’èŠå¥½+æœ‰æŒ‰è®š â†’ ç¹¼çºŒè§€å¯Ÿ'},
         {a:1,b:0,y:0.4,lbl:'ğŸ“µ èŠå¾—å¥½+æ²’æŒ‰è®š â†’ å¥¹å¾ˆå¿™'},
         {a:1,b:1,y:0.9,lbl:'ğŸ˜… èŠå¾—å¥½+æœ‰æŒ‰è®š â†’ å†å‚³ä¸€æ¬¡ï¼'}]}
];

// ============ ç‹€æ…‹ ============
let nn=new NN(), sceneIdx=0, epoch=0, autoTimer=null, isAuto=false;
const cvs=document.getElementById('nn-canvas');
const cx=cvs.getContext('2d');

// ============ ç•«å¸ƒè‡ªé©æ‡‰ ============
function resizeCanvas(){
  const W=cvs.parentElement.clientWidth-28; // æ‰£é™¤ card padding
  cvs.width=W;
  cvs.height=Math.max(260, Math.round(W*0.52));
  redraw();
}

function redraw(){
  const a=+document.getElementById('sl-a').value/100;
  const b=+document.getElementById('sl-b').value/100;
  nn.forward([a,b]);
  drawNN([a,b],nn.H,nn.O);
}

// ============ ç•«ç¥ç¶“ç¶²è·¯ ============
function drawNN(inp,hid,out){
  const W=cvs.width, H=cvs.height;
  cx.clearRect(0,0,W,H);
  cx.fillStyle='#1a1a2e';
  cx.fillRect(0,0,W,H);

  const s=SCENES[sceneIdx];
  // 4å±¤ï¼šè¼¸å…¥(2)ã€éš±è—1(4)ã€éš±è—2(4)ã€è¼¸å‡º(1)
  const layerX=[W*.1, W*.37, W*.63, W*.9];
  const sizes=[2,4,4,1];
  const clrs=['#f093fb','#4facfe','#43e97b','#fa709a'];
  const vals=[inp, hid.slice(0,4), hid.slice(0,4), out];
  const topPad=H*0.16, botPad=H*0.16;
  const usable=H-topPad-botPad;

  function ny(li,ni){
    const n=sizes[li];
    const gap=usable/(n);
    return topPad + gap*ni + gap/2;
  }

  const R=Math.max(8, Math.min(16, W*0.028));
  const fs=Math.max(8, Math.min(11, W*0.022));

  // é€£ç·š
  for(let li=0;li<3;li++){
    for(let i=0;i<sizes[li];i++){
      for(let j=0;j<sizes[li+1];j++){
        const v=(vals[li][i]||0);
        cx.beginPath();
        cx.moveTo(layerX[li], ny(li,i));
        cx.lineTo(layerX[li+1], ny(li+1,j));
        cx.strokeStyle=`rgba(${li===0?'240,147,251':'79,172,254'},${.08+v*.45})`;
        cx.lineWidth=.5+v*1.8;
        cx.stroke();
      }
    }
  }

  // ç¯€é»
  for(let li=0;li<4;li++){
    for(let ni=0;ni<sizes[li];ni++){
      const x=layerX[li], y=ny(li,ni);
      const v=vals[li][ni]||0;
      const r=R+v*3;
      const g=cx.createRadialGradient(x,y,0,x,y,r);
      g.addColorStop(0,'white');
      g.addColorStop(.5,clrs[li]);
      g.addColorStop(1,'transparent');
      cx.beginPath(); cx.arc(x,y,r,0,Math.PI*2);
      cx.fillStyle=g;
      if(v>.5){cx.shadowBlur=12;cx.shadowColor=clrs[li]}
      cx.fill(); cx.shadowBlur=0;
      cx.strokeStyle=clrs[li]; cx.lineWidth=1.5; cx.stroke();
    }
  }

  // å±¤æ¨™ç±¤ï¼ˆé ‚éƒ¨ï¼‰
  const layerNames=['è¼¸å…¥å±¤','éš±è—å±¤1','éš±è—å±¤2','è¼¸å‡ºå±¤'];
  cx.textAlign='center'; cx.font=`bold ${fs}px Arial`;
  layerNames.forEach((nm,li)=>{
    cx.fillStyle=clrs[li];
    cx.fillText(nm, layerX[li], H*.08);
  });

  // ç¯€é»æ¨™ç±¤ï¼ˆåº•éƒ¨ï¼Œæ¯å€‹ç¯€é»ä¸‹æ–¹ï¼‰
  const nodeLabels=[[s.lblA, s.lblB],[],[],[s.out]];
  cx.font=`${fs-1}px Arial`;
  for(let li=0;li<4;li++){
    for(let ni=0;ni<sizes[li];ni++){
      const lbl=nodeLabels[li][ni];
      if(!lbl) continue;
      const x=layerX[li], y=ny(li,ni);
      const v=vals[li][ni]||0;
      const r=R+v*3;
      // å»æ‰ emojiï¼Œåªä¿ç•™æ–‡å­—ï¼Œé¿å…å­—å¤ªé•·
      const txt=lbl.replace(/[\u{1F000}-\u{1FFFF}]/gu,'').replace(/^\s+/,'');
      const maxW=Math.floor((layerX[1]-layerX[0])*0.85);
      cx.fillStyle='rgba(255,255,255,.82)';
      // è‡ªå‹•ç¸®çŸ­
      let display=txt;
      cx.font=`${fs-1}px Arial`;
      while(cx.measureText(display).width>maxW && display.length>2){
        display=display.slice(0,-1);
      }
      if(display!==txt) display=display.trim()+'â€¦';
      cx.fillText(display, x, y+r+fs+1);
    }
  }
}

// ============ å ´æ™¯ ============
function loadScene(idx){
  sceneIdx=idx;
  const s=SCENES[idx];
  document.querySelectorAll('.sbtn').forEach((b,i)=>b.classList.toggle('active',i===idx));
  document.getElementById('scene-title').textContent=s.emoji+' '+s.name+' â€” å­¸ç¿’æ¡ˆä¾‹';
  document.getElementById('scene-desc').textContent=s.desc;
  document.getElementById('lbl-a').textContent=s.lblA;
  document.getElementById('lbl-b').textContent=s.lblB;
  document.getElementById('train-list').innerHTML=s.data.map(d=>`
    <div class="train-row">
      <div class="top">
        <span class="io">${s.lblA.slice(0,2)}=${d.a?'æ˜¯':'å¦'}</span>
        <span class="io">${s.lblB.slice(0,2)}=${d.b?'æ˜¯':'å¦'}</span>
        <span class="arrow">â†’</span>
        <span class="io out">${(d.y*100).toFixed(0)}%</span>
      </div>
      <div class="lbl">${d.lbl}</div>
    </div>`).join('');
  document.getElementById('result-box').classList.remove('show');
  resetNN();
}

function buildBtns(){
  document.getElementById('scenes').innerHTML=SCENES.map((s,i)=>`
    <button class="sbtn ${i===0?'active':''}" onclick="loadScene(${i})">
      <span class="emo">${s.emoji}</span>${s.name}
    </button>`).join('');
}

// ============ è¨“ç·´ ============
function getData(){return SCENES[sceneIdx].data.map(d=>({inp:[d.a,d.b],tgt:[d.y]}))}

function updateStats(err){
  epoch++;
  document.getElementById('epoch-val').textContent=epoch;
  document.getElementById('acc-val').textContent=Math.max(0,(1-err)*100).toFixed(1)+'%';
}

function trainOnce(){
  const data=getData(); let err=0;
  data.forEach(d=>{err+=nn.train(d.inp,d.tgt)});
  updateStats(err/data.length);
  redraw();
}

function toggleAuto(){
  isAuto=!isAuto;
  const btn=document.getElementById('auto-btn');
  if(isAuto){
    btn.textContent='â¹ åœæ­¢';
    btn.classList.add('pulsing');
    autoTimer=setInterval(()=>{
      const data=getData(); let err=0;
      data.forEach(d=>{err+=nn.train(d.inp,d.tgt)});
      updateStats(err/data.length);
      redraw();
      if((1-err/data.length)*100>=95) toggleAuto();
    },25);
  } else {
    clearInterval(autoTimer);
    btn.textContent='ğŸš€ å¿«é€Ÿè¨“ç·´';
    btn.classList.remove('pulsing');
  }
}

function resetNN(){
  if(isAuto) toggleAuto();
  nn=new NN(); epoch=0;
  document.getElementById('epoch-val').textContent='0';
  document.getElementById('acc-val').textContent='0%';
  document.getElementById('result-box').classList.remove('show');
  redraw();
}

// ============ é æ¸¬ ============
function getAdvice(v){
  if(v<.2) return{bg:'#fff0f0',bc:'#ffb3b3',emo:'âŒ',text:'åˆ¥åšå¤¢äº†',col:'#e53935',msg:'ç¾åœ¨è¡Œå‹•åªæœƒè¢«ç™¼å¥½äººå¡ï¼Œå…ˆåŸ¹é¤Šæ„Ÿæƒ…å§ï¼'};
  if(v<.4) return{bg:'#fff3e0',bc:'#ffcc80',emo:'ğŸ˜°',text:'æ©Ÿç‡å¾ˆä½',col:'#f57c00',msg:'æ¢ä»¶ä¸è¶³ï¼Œå†åŠªåŠ›è§€å¯Ÿä¸€é™£å­æ¯”è¼ƒå¥½'};
  if(v<.6) return{bg:'#fffde7',bc:'#fff176',emo:'ğŸ¤”',text:'å¯ä»¥è©¦è©¦',col:'#f9a825',msg:'æœ‰ä¸€é»å¸Œæœ›ï¼Œä½†è¦åšå¥½è¢«æ‹’çµ•çš„å¿ƒç†æº–å‚™'};
  if(v<.8) return{bg:'#f1f8e9',bc:'#aed581',emo:'ğŸ˜Š',text:'æˆåŠŸç‡ä¸éŒ¯',col:'#558b2f',msg:'æ™‚æ©Ÿä¸éŒ¯ï¼Œå¯ä»¥å‹‡æ•¢è¡Œå‹•äº†ï¼'};
  return{bg:'#fce4ec',bc:'#f48fb1',emo:'ğŸ’¯',text:'å°±æ˜¯ç¾åœ¨ï¼',col:'#c62828',msg:'å®Œç¾æ™‚æ©Ÿï¼Œä¸å‡ºæ‰‹æœƒå¾Œæ‚”ï¼è¡å•Šå°‘å¹´ï¼ğŸ’ª'};
}

function predict(){
  const a=+document.getElementById('sl-a').value/100;
  const b=+document.getElementById('sl-b').value/100;
  const v=nn.predict([a,b]);
  const adv=getAdvice(v);
  const box=document.getElementById('result-box');
  box.style.background=adv.bg;
  box.style.borderColor=adv.bc;
  document.getElementById('r-emo').textContent=adv.emo;
  document.getElementById('r-text').style.color=adv.col;
  document.getElementById('r-text').textContent=adv.text;
  document.getElementById('r-pct').style.color=adv.col;
  document.getElementById('r-pct').textContent='æˆåŠŸç‡ï¼š'+(v*100).toFixed(0)+'%';
  document.getElementById('r-advice').textContent='ğŸ’¬ '+adv.msg;
  box.classList.add('show');
  redraw();
}

// ============ æ»‘æ¡¿ ============
['a','b'].forEach(k=>{
  document.getElementById('sl-'+k).addEventListener('input',function(){
    document.getElementById('pct-'+k).textContent=this.value+'%';
    redraw();
  });
});

// ============ åˆå§‹åŒ– ============
window.addEventListener('load',()=>{ buildBtns(); loadScene(0); resizeCanvas(); });
window.addEventListener('resize',()=>{ resizeCanvas(); });
</script>
</body>
</html>