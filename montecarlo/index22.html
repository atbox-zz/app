<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 å…¨å°å¤§é¸ï¼šè’™ç‰¹å¡æ´›çµ‚æ¥µæ¨¡æ“¬å™¨</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --blue: #000095; --green: #1b9431; --white: #28c8c8; --grey: #7f8c8d; --dark: #2c3e50; --bg: #f0f2f5; }
        body { font-family: 'Noto Sans TC', sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; height: 100vh; }
        header { background: var(--dark); color: white; padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; }
        
        .layout { display: grid; grid-template-columns: 350px 1fr 300px; gap: 15px; padding: 15px; flex: 1; overflow: hidden; }
        .column { display: flex; flex-direction: column; gap: 15px; overflow-y: auto; padding-right: 5px; }
        .card { background: white; border-radius: 10px; padding: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        
        /* ç¸£å¸‚é¸æ“‡å™¨ */
        .city-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        .btn-city { padding: 8px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; font-size: 0.85rem; background: white; }
        .btn-city.active { background: var(--dark); color: white; border-color: var(--dark); }
        
        /* å¸­æ¬¡çµ±è¨ˆ */
        .seat-counter { display: flex; justify-content: space-around; text-align: center; margin-bottom: 15px; }
        .seat-box { padding: 10px; border-radius: 8px; width: 30%; color: white; }
        .bg-blue { background: var(--blue); } .bg-green { background: var(--green); } .bg-white { background: var(--white); }

        /* åœ–è¡¨é«˜åº¦èª¿æ•´ */
        .chart-box { height: 250px; position: relative; }
        .btn-run { background: #e67e22; color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; font-size: 1.1rem; }
        
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        th, td { padding: 8px; text-align: left; border-bottom: 1px solid #eee; }
        .win-tag { padding: 2px 6px; border-radius: 4px; color: white; font-size: 0.75rem; }
    </style>
</head>
<body>

<header>
    <div>
        <h2 style="margin:0;">ğŸ—³ï¸ 2026 å…¨å°é¸æˆ°æŒ‡æ®ä¸­å¿ƒ</h2>
        <small>ç•¶å‰æ™‚é–“ï¼š2026å¹´1æœˆ13æ—¥ | è·æŠ•ç¥¨æ—¥ï¼š319 å¤©</small>
    </div>
    <button class="btn-run" style="width:auto; padding: 10px 30px;" onclick="simulateAllCounties()">ğŸŒ€ åŸ·è¡Œå…¨å°ç¸½é«”æ¼”åŒ–</button>
</header>

<div class="layout">
    <div class="column">
        <div class="card">
            <h3>ğŸ“ ç¸£å¸‚åˆ‡æ›</h3>
            <div class="city-grid" id="citySelector"></div>
        </div>
        
        <div class="card" id="eventBox">
            <h3>ğŸ“¢ å€åŸŸéš¨æ©Ÿäº‹ä»¶</h3>
            <p id="eventText" style="font-size:0.9rem; color:#666;">é»æ“Šå³ä¸Šæ–¹åŸ·è¡Œéµè§¸ç™¼éš¨æ©Ÿé¸æƒ…éœ‡ç›ª</p>
        </div>

        <div class="card">
            <h3>ğŸ‘¤ å€™é¸äººæˆ°åŠ› (ç•¶å‰ç¸£å¸‚)</h3>
            <div id="candidateList"></div>
        </div>
    </div>

    <div class="column">
        <div class="card">
            <h3>ğŸ“ˆ é¸å‰æ¼”åŒ–è¶¨å‹¢ (Time-Series)</h3>
            <div class="chart-box" style="height:300px;"><canvas id="timeLineChart"></canvas></div>
        </div>
        <div class="card">
            <h3>ğŸ¯ è’™ç‰¹å¡æ´›å‹é¸æ©Ÿç‡</h3>
            <div style="display:flex; gap:10px;">
                <div style="flex:1; height:200px;"><canvas id="radarChart"></canvas></div>
                <div style="flex:1; height:200px;"><canvas id="winChart"></canvas></div>
            </div>
        </div>
    </div>

    <div class="column">
        <div class="card">
            <h3>ğŸ›ï¸ å…¨å°å¸­æ¬¡é æ¸¬ (22 ç¸£å¸‚)</h3>
            <div class="seat-counter">
                <div class="seat-box bg-blue">è—<br><b id="seat-blue">0</b></div>
                <div class="seat-box bg-green">ç¶ <br><b id="seat-green">0</b></div>
                <div class="seat-box bg-white">ç™½/ä»–<br><b id="seat-white">0</b></div>
            </div>
            <div style="overflow-y:auto; height: 500px;">
                <table id="mapTable">
                    <thead><tr><th>ç¸£å¸‚</th><th>é ˜å…ˆ</th><th>å‹ç‡</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
// 1. å®šç¾©å…¨å° 22 ç¸£å¸‚åˆå§‹æ¨¡å‹ (2026.01 çœŸå¯¦æ”¿ç¶“æ¦‚æ³)
const counties = [
    { id: 'TP', name: "å°åŒ—å¸‚", mean: [42, 35, 18], sd: 3, colors: ["#000095", "#1b9431", "#28c8c8"], names: ["è”£è¬å®‰", "ç¶ ç‡ŸæŒ‘æˆ°è€…", "ç™½ç‡ŸæŒ‘æˆ°è€…"] },
    { id: 'NTP', name: "æ–°åŒ—å¸‚", mean: [40, 36, 12], sd: 3, colors: ["#000095", "#1b9431", "#28c8c8"], names: ["æå››å·/æ´ªå­Ÿæ¥·", "è˜‡å·§æ…§", "é»ƒåœ‹æ˜Œ"] },
    { id: 'TY', name: "æ¡ƒåœ’å¸‚", mean: [45, 38, 10], sd: 3, colors: ["#000095", "#1b9431", "#28c8c8"], names: ["å¼µå–„æ”¿", "ç¶ ç‡ŸæŒ‘æˆ°è€…", "ç™½ç‡ŸæŒ‘æˆ°è€…"] },
    { id: 'TC', name: "å°ä¸­å¸‚", mean: [43, 37, 12], sd: 3, colors: ["#000095", "#1b9431", "#28c8c8"], names: ["æ±Ÿå•Ÿè‡£", "ä½•æ¬£ç´”/ç‹ç¾©å·", "ç™½ç‡ŸæŒ‘æˆ°è€…"] },
    { id: 'TN', name: "å°å—å¸‚", mean: [32, 55, 5], sd: 4, colors: ["#000095", "#1b9431", "#28c8c8"], names: ["è¬é¾ä»‹", "é™³äº­å¦ƒ/æ—ä¿Šæ†²", "ç™½ç‡ŸæŒ‘æˆ°è€…"] },
    { id: 'KH', name: "é«˜é›„å¸‚", mean: [38, 45, 5], sd: 4, colors: ["#000095", "#1b9431", "#28c8c8"], names: ["æŸ¯å¿—æ©", "è³´ç‘éš†/è¨±æ™ºå‚‘", "ç™½ç‡ŸæŒ‘æˆ°è€…"] },
    { id: 'KL', name: "åŸºéš†å¸‚", mean: [40, 42, 8], sd: 5, colors: ["#000095", "#1b9431", "#28c8c8"], names: ["è¬åœ‹æ¨‘", "ç¶ ç‡ŸæŒ‘æˆ°è€…", "ç™½ç‡ŸæŒ‘æˆ°è€…"] },
    { id: 'HC', name: "æ–°ç«¹å¸‚", mean: [30, 25, 35], sd: 6, colors: ["#000095", "#1b9431", "#28c8c8"], names: ["è—ç‡ŸæŒ‘æˆ°è€…", "ç¶ ç‡ŸæŒ‘æˆ°è€…", "ä»£ç†/ç™½ç‡Ÿ"] },
    { id: 'HCC', name: "æ–°ç«¹ç¸£", mean: [55, 25, 15], sd: 3, colors: ["#000095", "#1b9431", "#28c8c8"], names: ["è—ç‡Ÿå€™é¸äºº", "ç¶ ç‡ŸæŒ‘æˆ°è€…", "ç™½ç‡ŸæŒ‘æˆ°è€…"] },
    { id: 'ML', name: "è‹—æ —ç¸£", mean: [50, 20, 25], sd: 4, colors: ["#000095", "#1b9431", "#7f8c8d"], names: ["é¾æ±éŒ¦/è—", "ç¶ ç‡ŸæŒ‘æˆ°è€…", "ä»–"] },
    { id: 'CH', name: "å½°åŒ–ç¸£", mean: [42, 40, 10], sd: 4, colors: ["#000095", "#1b9431", "#28c8c8"], names: ["è—ç‡Ÿå€™é¸äºº", "ç¶ ç‡Ÿå€™é¸äºº", "ç™½ç‡ŸæŒ‘æˆ°è€…"] },
    { id: 'NT', name: "å—æŠ•ç¸£", mean: [52, 38, 5], sd: 3, colors: ["#000095", "#1b9431", "#28c8c8"], names: ["è¨±æ·‘è¯", "ç¶ ç‡ŸæŒ‘æˆ°è€…", "ç™½ç‡ŸæŒ‘æˆ°è€…"] },
    { id: 'YL', name: "é›²æ—ç¸£", mean: [45, 43, 5], sd: 4, colors: ["#000095", "#1b9431", "#28c8c8"], names: ["è—ç‡Ÿå€™é¸äºº", "ç¶ ç‡Ÿå€™é¸äºº", "ç™½ç‡ŸæŒ‘æˆ°è€…"] },
    { id: 'CY', name: "å˜‰ç¾©å¸‚", mean: [48, 40, 5], sd: 4, colors: ["#000095", "#1b9431", "#28c8c8"], names: ["é»ƒæ•æƒ /è—", "ç¶ ç‡ŸæŒ‘æˆ°è€…", "ç™½ç‡ŸæŒ‘æˆ°è€…"] },
    { id: 'CYC', name: "å˜‰ç¾©ç¸£", mean: [30, 58, 5], sd: 3, colors: ["#000095", "#1b9431", "#28c8c8"], names: ["è—ç‡ŸæŒ‘æˆ°è€…", "ç¶ ç‡Ÿå€™é¸äºº", "ç™½ç‡ŸæŒ‘æˆ°è€…"] },
    { id: 'PT', name: "å±æ±ç¸£", mean: [38, 52, 5], sd: 3, colors: ["#000095", "#1b9431", "#28c8c8"], names: ["è—ç‡ŸæŒ‘æˆ°è€…", "å‘¨æ˜¥ç±³", "ç™½ç‡ŸæŒ‘æˆ°è€…"] },
    { id: 'IL', name: "å®œè˜­ç¸£", mean: [40, 45, 10], sd: 5, colors: ["#000095", "#1b9431", "#28c8c8"], names: ["è—ç‡ŸæŒ‘æˆ°è€…", "ç¶ ç‡Ÿå€™é¸äºº", "ç™½ç‡ŸæŒ‘æˆ°è€…"] },
    { id: 'HL', name: "èŠ±è“®ç¸£", mean: [60, 25, 10], sd: 3, colors: ["#000095", "#1b9431", "#28c8c8"], names: ["è—ç‡Ÿå€™é¸äºº", "ç¶ ç‡ŸæŒ‘æˆ°è€…", "ç™½ç‡ŸæŒ‘æˆ°è€…"] },
    { id: 'TT', name: "å°æ±ç¸£", mean: [58, 30, 5], sd: 3, colors: ["#000095", "#1b9431", "#28c8c8"], names: ["é¥’æ…¶éˆ´/è—", "ç¶ ç‡ŸæŒ‘æˆ°è€…", "ç™½ç‡ŸæŒ‘æˆ°è€…"] },
    { id: 'PH', name: "æ¾æ¹–ç¸£", mean: [42, 45, 5], sd: 6, colors: ["#000095", "#1b9431", "#28c8c8"], names: ["è—ç‡ŸæŒ‘æˆ°è€…", "é™³å…‰å¾©", "ç™½ç‡ŸæŒ‘æˆ°è€…"] },
    { id: 'KM', name: "é‡‘é–€ç¸£", mean: [65, 5, 25], sd: 4, colors: ["#000095", "#1b9431", "#28c8c8"], names: ["é™³ç¦æµ·/ä»–", "ç¶ ç‡Ÿ", "è—ç‡Ÿ"] },
    { id: 'LC', name: "é€£æ±Ÿç¸£", mean: [75, 5, 15], sd: 3, colors: ["#000095", "#1b9431", "#7f8c8d"], names: ["è—ç‡Ÿå€™é¸äºº", "ç¶ ç‡Ÿ", "ä»–"] }
];

let selectedCityId = 'NTP';
let charts = {};

// 2. åˆå§‹åŒ–ä»‹é¢
function init() {
    const selector = document.getElementById('citySelector');
    counties.forEach(c => {
        const btn = document.createElement('button');
        btn.className = `btn-city ${c.id === selectedCityId ? 'active' : ''}`;
        btn.innerText = c.name;
        btn.onclick = () => {
            selectedCityId = c.id;
            document.querySelectorAll('.btn-city').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            simulateCurrentCity();
        };
        selector.appendChild(btn);
    });
    simulateAllCounties();
}

function randn_bm() {
    let u = 0, v = 0;
    while(u === 0) u = Math.random();
    while(v === 0) v = Math.random();
    return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
}

// 3. å…¨å°ç¸½é«”æ¨¡æ“¬ (è’™ç‰¹å¡æ´› 1,000 æ¬¡ x 22 ç¸£å¸‚)
function simulateAllCounties() {
    let seats = { blue: 0, green: 0, white: 0 };
    const tableBody = document.querySelector('#mapTable tbody');
    tableBody.innerHTML = '';

    counties.forEach(county => {
        let wins = [0, 0, 0];
        for (let i = 0; i < 500; i++) {
            let s = county.mean.map((m, idx) => m + randn_bm() * county.sd);
            let winnerIdx = s.indexOf(Math.max(...s));
            wins[winnerIdx]++;
        }
        
        let maxWinIdx = wins.indexOf(Math.max(...wins));
        let prob = (wins[maxWinIdx] / 500 * 100).toFixed(0);
        
        if (maxWinIdx === 0) seats.blue++;
        else if (maxWinIdx === 1) seats.green++;
        else seats.white++;

        const row = `<tr>
            <td>${county.name}</td>
            <td><span class="win-tag" style="background:${county.colors[maxWinIdx]}">${county.names[maxWinIdx].split('/')[0]}</span></td>
            <td>${prob}%</td>
        </tr>`;
        tableBody.innerHTML += row;
    });

    document.getElementById('seat-blue').innerText = seats.blue;
    document.getElementById('seat-green').innerText = seats.green;
    document.getElementById('seat-white').innerText = seats.white;
    
    simulateCurrentCity();
}

// 4. ç•¶å‰ç¸£å¸‚æ·±å…¥åˆ†æ
function simulateCurrentCity() {
    const c = counties.find(i => i.id === selectedCityId);
    renderCandidateCards(c);
    
    // æ™‚é–“è»¸æ¨¡æ“¬
    const days = 100;
    const labels = Array.from({length: days}, (_, i) => i);
    const datasets = c.names.map((name, idx) => {
        let val = c.mean[idx];
        let data = [];
        for(let d=0; d<days; d++) {
            val += randn_bm() * (c.sd/3);
            data.push(val.toFixed(2));
        }
        return { label: name, data: data, borderColor: c.colors[idx], fill: false, pointRadius: 0 };
    });

    if (charts.time) charts.time.destroy();
    charts.time = new Chart(document.getElementById('timeLineChart'), {
        type: 'line',
        data: { labels, datasets },
        options: { maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
    });

    // å‹ç‡åœ“é¤…åœ–
    if (charts.win) charts.win.destroy();
    charts.win = new Chart(document.getElementById('winChart'), {
        type: 'doughnut',
        data: {
            labels: c.names,
            datasets: [{ data: c.mean, backgroundColor: c.colors }]
        },
        options: { maintainAspectRatio: false }
    });
}

function renderCandidateCards(c) {
    const container = document.getElementById('candidateList');
    container.innerHTML = c.names.map((name, i) => `
        <div style="border-left:4px solid ${c.colors[i]}; padding:5px 10px; margin-bottom:5px; background:#f9f9f9;">
            <b style="font-size:0.9rem">${name}</b><br>
            <small>æœŸæœ›å€¼: ${c.mean[i]}% | æ³¢å‹•ç‡: Â±${c.sd}%</small>
        </div>
    `).join('');
}

window.onload = init;
</script>
</body>
</html>