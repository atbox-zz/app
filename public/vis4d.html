<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>六十四卦互動地圖（六維超立方體投影）</title>
  <script type="text/javascript" src="https://unpkg.com/vis-network@9.1.2/dist/vis-network.min.js"></script>
  <link href="https://unpkg.com/vis-network@9.1.2/styles/vis-network.min.css" rel="stylesheet" type="text/css" />
  <style>
    body { font-family: "Noto Sans TC", "Microsoft JhengHei", "PingFang TC", sans-serif; margin: 0; }
    #container { height: 100vh; position: relative; }
    #mynetwork { width: 100%; height: 100%; }
    #panel {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90vw;
      max-width: 420px;
      max-height: 80vh;
      padding: 16px;
      box-sizing: border-box;
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      overflow-y: auto;
      display: none;
      z-index: 10;
    }
    .gua-title { font-size: 22px; font-weight: 700; margin-bottom: 6px; }
    .gua-bits { color: #666; margin-bottom: 8px; }
    .gua-text h4 { margin-top: 12px; font-size: 16px; font-weight: 700; }
    .gua-text p, .gua-text ul { margin: 8px 0; }
    .gua-text ul { padding-left: 20px; }
    .change-list { margin-top: 12px; }
    .change-item { padding: 6px; border: 1px solid #eee; margin-bottom: 6px; cursor: pointer; border-radius: 6px; }
    .highlight { background: #fff9c4; }
    .btn { display: inline-block; padding: 6px 10px; border-radius: 6px; background: #1976d2; color: white; text-decoration: none; }
    .close-btn { 
      position: absolute; 
      top: 10px; 
      right: 10px; 
      background: #d32f2f; 
      color: white; 
      border: none; 
      border-radius: 4px; 
      padding: 6px 10px; 
      cursor: pointer; 
    }
    #panel {
      opacity: 0;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }
    #panel.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }
    #panel.hide {
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.9);
    }
    .amino-acid { display: inline-block; padding: 2px 6px; border-radius: 4px; color: white; }
    @media (max-width: 600px) {
      #panel { width: 95vw; padding: 12px; }
      .gua-title { font-size: 18px; }
      .btn, .close-btn { font-size: 14px; padding: 5px 8px; }
    }
    @media (max-height: 600px) {
      #panel { max-height: 90vh; }
    }
  </style>
</head>
<body>
<div id="container">
  <div id="mynetwork"></div>
  <div id="panel">
    <button class="close-btn" onclick="closePanel()">關閉</button>
    <div class="gua-title" id="guaName">點選節點查看卦象</div>
    <div class="gua-bits" id="guaBits"></div>
    <div class="gua-text" id="guaText"></div>
    <div class="change-list" id="changeList"></div>
    <div style="margin-top:12px;">
      <a class="btn" id="btnCenter">重置視角</a>
      <div style="margin-top:8px; color:#777; font-size:13px;">
        說明：點選變卦可以跳至該卦。陽爻=1，陰爻=0，自上而下。</div>
    </div>
  </div>
</div>

<script>
// 64卦名（文王卦序）
const guaNames = [
  "乾為天", "澤天夬", "火天大有", "雷天大壯", "風天小畜", "水天需", "山天大畜", "地天泰",
  "天澤履", "兌為澤", "火澤睽", "雷澤歸妹", "風澤中孚", "水澤節", "山澤損", "地澤臨",
  "天火同人", "澤火革", "離為火", "雷火豐", "風火家人", "水火既濟", "山火賁", "地火明夷",
  "天雷無妄", "澤雷隨", "火雷噬嗑", "震為雷", "風雷益", "水雷屯", "山雷頤", "地雷復",
  "天風姤", "澤風大過", "火風鼎", "雷風恆", "巽為風", "水風井", "山風蠱", "地風升",
  "天水訟", "澤水困", "火水未濟", "雷水解", "風水渙", "坎為水", "山水蒙", "地水師",
  "天山遯", "澤山咸", "火山旅", "雷山小過", "風山漸", "水山蹇", "艮為山", "地山謙",
  "天地否", "澤地萃", "火地晉", "雷地豫", "風地觀", "水地比", "山地剝", "坤為地"
];

// 二進位代碼（文王卦序）
const kingwenBits = [
  "111111","111110","111101","111100","111011","111010","111001","111000",
  "110111","110110","110101","110100","110011","110010","110001","110000",
  "101111","101110","101101","101100","101011","101010","101001","101000",
  "100111","100110","100101","100100","100011","100010","100001","100000",
  "011111","011110","011101","011100","011011","011010","011001","011000",
  "010111","010110","010101","010100","010011","010010","010001","010000",
  "001111","001110","001101","001100","001011","001010","001001","001000",
  "000111","000110","000101","000100","000011","000010","000001","000000"
];

// 遺傳密碼子與胺基酸資料
const codonData = [
  { bits: "000000", codon: "TTT", aminoAcid: "苯丙氨酸 (Phe)", color: "#1b9e77" },
  { bits: "000001", codon: "TTC", aminoAcid: "苯丙氨酸 (Phe)", color: "#1b9e77" },
  { bits: "000010", codon: "TTA", aminoAcid: "亮氨酸 (Leu)", color: "#d95f02" },
  { bits: "000011", codon: "TTG", aminoAcid: "亮氨酸 (Leu)", color: "#d95f02" },
  { bits: "000100", codon: "TCT", aminoAcid: "絲氨酸 (Ser)", color: "#7570b3" },
  { bits: "000101", codon: "TCC", aminoAcid: "絲氨酸 (Ser)", color: "#7570b3" },
  { bits: "000110", codon: "TCA", aminoAcid: "絲氨酸 (Ser)", color: "#7570b3" },
  { bits: "000111", codon: "TCG", aminoAcid: "絲氨酸 (Ser)", color: "#7570b3" },
  { bits: "001000", codon: "TAT", aminoAcid: "酪氨酸 (Tyr)", color: "#e7298a" },
  { bits: "001001", codon: "TAC", aminoAcid: "酪氨酸 (Tyr)", color: "#e7298a" },
  { bits: "001010", codon: "TAA", aminoAcid: "終止 (Stop)", color: "#666666" },
  { bits: "001011", codon: "TAG", aminoAcid: "終止 (Stop)", color: "#666666" },
  { bits: "001100", codon: "TGT", aminoAcid: "半胱氨酸 (Cys)", color: "#66a61e" },
  { bits: "001101", codon: "TGC", aminoAcid: "半胱氨酸 (Cys)", color: "#66a61e" },
  { bits: "001110", codon: "TGA", aminoAcid: "終止 (Stop)", color: "#666666" },
  { bits: "001111", codon: "TGG", aminoAcid: "色氨酸 (Trp)", color: "#e6ab02" },
  { bits: "010000", codon: "CTT", aminoAcid: "亮氨酸 (Leu)", color: "#d95f02" },
  { bits: "010001", codon: "CTC", aminoAcid: "亮氨酸 (Leu)", color: "#d95f02" },
  { bits: "010010", codon: "CTA", aminoAcid: "亮氨酸 (Leu)", color: "#d95f02" },
  { bits: "010011", codon: "CTG", aminoAcid: "亮氨酸 (Leu)", color: "#d95f02" },
  { bits: "010100", codon: "CCT", aminoAcid: "脯氨酸 (Pro)", color: "#a6761d" },
  { bits: "010101", codon: "CCC", aminoAcid: "脯氨酸 (Pro)", color: "#a6761d" },
  { bits: "010110", codon: "CCA", aminoAcid: "脯氨酸 (Pro)", color: "#a6761d" },
  { bits: "010111", codon: "CCG", aminoAcid: "脯氨酸 (Pro)", color: "#a6761d" },
  { bits: "011000", codon: "CAT", aminoAcid: "組氨酸 (His)", color: "#377eb8" },
  { bits: "011001", codon: "CAC", aminoAcid: "組氨酸 (His)", color: "#377eb8" },
  { bits: "011010", codon: "CAA", aminoAcid: "谷氨酰胺 (Gln)", color: "#4daf4a" },
  { bits: "011011", codon: "CAG", aminoAcid: "谷氨酰胺 (Gln)", color: "#4daf4a" },
  { bits: "011100", codon: "CGT", aminoAcid: "精氨酸 (Arg)", color: "#ff7f00" },
  { bits: "011101", codon: "CGC", aminoAcid: "精氨酸 (Arg)", color: "#ff7f00" },
  { bits: "011110", codon: "CGA", aminoAcid: "精氨酸 (Arg)", color: "#ff7f00" },
  { bits: "011111", codon: "CGG", aminoAcid: "精氨酸 (Arg)", color: "#ff7f00" },
  { bits: "100000", codon: "ATT", aminoAcid: "異亮氨酸 (Ile)", color: "#984ea3" },
  { bits: "100001", codon: "ATC", aminoAcid: "異亮氨酸 (Ile)", color: "#984ea3" },
  { bits: "100010", codon: "ATA", aminoAcid: "異亮氨酸 (Ile)", color: "#984ea3" },
  { bits: "100011", codon: "ATG", aminoAcid: "甲硫氨酸 (Met)", color: "#e41a1c" },
  { bits: "100100", codon: "ACT", aminoAcid: "蘇氨酸 (Thr)", color: "#66c2a5" },
  { bits: "100101", codon: "ACC", aminoAcid: "蘇氨酸 (Thr)", color: "#66c2a5" },
  { bits: "100110", codon: "ACA", aminoAcid: "蘇氨酸 (Thr)", color: "#66c2a5" },
  { bits: "100111", codon: "ACG", aminoAcid: "蘇氨酸 (Thr)", color: "#66c2a5" },
  { bits: "101000", codon: "AAT", aminoAcid: "天冬酰胺 (Asn)", color: "#8c510a" },
  { bits: "101001", codon: "AAC", aminoAcid: "天冬酰胺 (Asn)", color: "#8c510a" },
  { bits: "101010", codon: "AAA", aminoAcid: "賴氨酸 (Lys)", color: "#01665e" },
  { bits: "101011", codon: "AAG", aminoAcid: "賴氨酸 (Lys)", color: "#01665e" },
  { bits: "101100", codon: "AGT", aminoAcid: "絲氨酸 (Ser)", color: "#7570b3" },
  { bits: "101101", codon: "AGC", aminoAcid: "絲氨酸 (Ser)", color: "#7570b3" },
  { bits: "101110", codon: "AGA", aminoAcid: "精氨酸 (Arg)", color: "#ff7f00" },
  { bits: "101111", codon: "AGG", aminoAcid: "精氨酸 (Arg)", color: "#ff7f00" },
  { bits: "110000", codon: "GTT", aminoAcid: "纈氨酸 (Val)", color: "#5e4fa2" },
  { bits: "110001", codon: "GTC", aminoAcid: "纈氨酸 (Val)", color: "#5e4fa2" },
  { bits: "110010", codon: "GTA", aminoAcid: "纈氨酸 (Val)", color: "#5e4fa2" },
  { bits: "110011", codon: "GTG", aminoAcid: "纈氨酸 (Val)", color: "#5e4fa2" },
  { bits: "110100", codon: "GCT", aminoAcid: "丙氨酸 (Ala)", color: "#f4a582" },
  { bits: "110101", codon: "GCC", aminoAcid: "丙氨酸 (Ala)", color: "#f4a582" },
  { bits: "110110", codon: "GCA", aminoAcid: "丙氨酸 (Ala)", color: "#f4a582" },
  { bits: "110111", codon: "GCG", aminoAcid: "丙氨酸 (Ala)", color: "#f4a582" },
  { bits: "111000", codon: "GAT", aminoAcid: "天冬氨酸 (Asp)", color: "#d53e4f" },
  { bits: "111001", codon: "GAC", aminoAcid: "天冬氨酸 (Asp)", color: "#d53e4f" },
  { bits: "111010", codon: "GAA", aminoAcid: "谷氨酸 (Glu)", color: "#3288bd" },
  { bits: "111011", codon: "GAG", aminoAcid: "谷氨酸 (Glu)", color: "#3288bd" },
  { bits: "111100", codon: "GGT", aminoAcid: "甘氨酸 (Gly)", color: "#99d594" },
  { bits: "111101", codon: "GGC", aminoAcid: "甘氨酸 (Gly)", color: "#99d594" },
  { bits: "111110", codon: "GGA", aminoAcid: "甘氨酸 (Gly)", color: "#99d594" },
  { bits: "111111", codon: "GGG", aminoAcid: "甘氨酸 (Gly)", color: "#99d594" }
];

// 卦辭與爻辭資料（完整卦辭與爻辭）
const guaTextData = [
  { 
    bits: "111111", 
    guaText: "乾：元亨利貞。", 
    yaoText: [
      "初九：潛龍勿用。",
      "九二：見龍在田，利見大人。",
      "九三：君子終日乾乾，夕惕若，厲無咎。",
      "九四：或躍在淵，無咎。",
      "九五：飛龍在天，利見大人。",
      "上九：亢龍有悔。"
    ] 
  },
  { 
    bits: "111110", 
    guaText: "夬：揚于王庭，孚號有厲，告自邑，不利即戎，利有攸往。", 
    yaoText: [
      "初九：壯于前趾，往不勝，為咎。",
      "九二：惕號，莫夜有戎，勿恤。",
      "九三：壯于頄，有凶。君子夬夬，獨行遇雨，若濡有慍，無咎。",
      "九四：臀無膚，其行次且，牽羊悔亡，聞言不信。",
      "九五：莧陸夬夬，中行無咎。",
      "上六：無號，終有凶。"
    ] 
  },
  { 
    bits: "111101", 
    guaText: "大有：元亨。", 
    yaoText: [
      "初九：無交害，匪咎，艱則無咎。",
      "九二：大車以載，有攸往，無咎。",
      "九三：公用亨于天子，小人弗克。",
      "九四：匪其彭，無咎。",
      "六五：厥孚交如，威如，吉。",
      "上九：自天祐之，吉無不利。"
    ] 
  },
  { 
    bits: "111100", 
    guaText: "大壯：利貞。", 
    yaoText: [
      "初九：壯于趾，征凶，有孚。",
      "九二：貞吉。",
      "九三：小人用壯，君子用罔，貞厲。羝羊觸藩，羸其角。",
      "九四：貞吉悔亡，藩決不羸，壯于大輿之輹。",
      "六五：喪羊于易，無悔。",
      "上六：羝羊觸藩，不能退，不能遂，無攸利，艱則吉。"
    ] 
  },
  { 
    bits: "111011", 
    guaText: "小畜：亨。密雲不雨，自我西郊。", 
    yaoText: [
      "初九：復自道，何其咎，吉。",
      "九二：牽復，吉。",
      "九三：輿說輻，夫妻反目。",
      "六四：有孚，血去惕出，無咎。",
      "九五：有孚攣如，富以其鄰。",
      "上九：既雨且處，尚德載，婦貞厲。月幾望，君子征凶。"
    ] 
  },
  { 
    bits: "111010", 
    guaText: "需：有孚，光亨，貞吉。利涉大川。", 
    yaoText: [
      "初九：需于郊，利用恆，無咎。",
      "九二：需于沙，小有言，終吉。",
      "九三：需于泥，致寇至。",
      "六四：需于血，出自穴。",
      "九五：需于酒食，貞吉。",
      "上六：入于穴，有不速之客三人來，敬之終吉。"
    ] 
  },
  { 
    bits: "111001", 
    guaText: "大畜：利貞，不家食吉，利涉大川。", 
    yaoText: [
      "初九：有厲利己。",
      "九二：輿說輻。",
      "九三：良馬逐，利艱貞。日閒輿衛，利有攸往。",
      "六四：童牛之牿，元吉。",
      "六五：豶豕之牙，吉。",
      "上九：何天之衢，亨。"
    ] 
  },
  { 
    bits: "111000", 
    guaText: "泰：小往大來，吉亨。", 
    yaoText: [
      "初九：拔茅茹，以其彙，征吉。",
      "九二：包荒，用馮河，不遐遺，朋亡，得尚于中行。",
      "九三：無平不陂，無往不復，艱貞無咎。勿恤其孚，于食有福。",
      "六四：翩翩，不富以其鄰，不戒以孚。",
      "六五：帝乙歸妹，以祉元吉。",
      "上六：城復于隍，勿用師，自邑告命，貞吝。"
    ] 
  },
  { 
    bits: "110111", 
    guaText: "履：履虎尾，不咥人，亨。", 
    yaoText: [
      "初九：素履，往無咎。",
      "九二：履道坦坦，幽人貞吉。",
      "六三：眇能視，跛能履，履虎尾，咥人，凶。武人為于大君。",
      "九四：履虎尾，愬愬，終吉。",
      "九五：夬履，貞厲。",
      "上九：視履考祥，其旋元吉。"
    ] 
  },
  { 
    bits: "110110", 
    guaText: "兌：亨，利貞。", 
    yaoText: [
      "初九：和兌，吉。",
      "九二：孚兌，吉，悔亡。",
      "六三：來兌，凶。",
      "九四：商兌未寧，介疾有喜。",
      "九五：孚于剝，有厲。",
      "上六：引兌。"
    ] 
  },
  { 
    bits: "110101", 
    guaText: "睽：小事吉。", 
    yaoText: [
      "初九：悔亡，喪馬勿逐，自復。見惡人，無咎。",
      "九二：遇主于巷，無咎。",
      "六三：見輿曳，其牛掣，其人天且劓，無初有終。",
      "九四：睽孤，遇元夫，交孚，厲無咎。",
      "六五：悔亡，厥宗噬膚，往何咎。",
      "上九：睽孤，見豕負塗，載鬼一車，先張之弧，后說之弧，匪寇婚媾，往遇雨則吉。"
    ] 
  },
  { 
    bits: "110100", 
    guaText: "歸妹：征凶，無攸利。", 
    yaoText: [
      "初九：歸妹以娣，跛能履，征吉。",
      "九二：眇能視，利幽人之貞。",
      "六三：歸妹以須，反歸以娣。",
      "九四：歸妹愆期，遲歸有時。",
      "六五：帝乙歸妹，其君之袂，不如其娣之袂良，月幾望，吉。",
      "上六：女承筐無實，士刲羊無血，無攸利。"
    ] 
  },
  { 
    bits: "110011", 
    guaText: "中孚：豚魚吉，利涉大川，利貞。", 
    yaoText: [
      "初九：虞吉，有它不燕。",
      "九二：鳴鶴在陰，其子和之。我有好爵，吾與爾靡之。",
      "六三：得敵，或鼓或罷，或泣或歌。",
      "六四：月幾望，馬匹亡，無咎。",
      "九五：有孚攣如，無咎。",
      "上九：翰音登于天，貞凶。"
    ] 
  },
  { 
    bits: "110010", 
    guaText: "節：亨。苦節不可貞。", 
    yaoText: [
      "初九：不出戶庭，無咎。",
      "九二：不出門庭，凶。",
      "六三：不節若，則嗟若，無咎。",
      "六四：安節，亨。",
      "九五：甘節，吉，往有尚。",
      "上六：苦節，貞凶，悔亡。"
    ] 
  },
  { 
    bits: "110001", 
    guaText: "損：有孚，元吉，無咎，可貞，利有攸往。", 
    yaoText: [
      "初九：已事遄往，無咎，酌損之。",
      "九二：利貞，征凶，弗損益之。",
      "六三：三人行則損一人，一人行則得其友。",
      "六四：損其疾，使遄有喜，無咎。",
      "六五：或益之十朋之龜，弗克違，元吉。",
      "上九：弗損益之，無咎，貞吉，利有攸往，得臣無家。"
    ] 
  },
  { 
    bits: "110000", 
    guaText: "臨：元亨，利貞。至於八月有凶。", 
    yaoText: [
      "初九：咸臨，貞吉。",
      "九二：咸臨，吉，無不利。",
      "六三：甘臨，無攸利。既憂之，無咎。",
      "六四：至臨，無咎。",
      "六五：知臨，大君之宜，吉。",
      "上六：敦臨，吉，無咎。"
    ] 
  },
  { 
    bits: "101111", 
    guaText: "同人：同人于野，亨。利涉大川，利君子貞。", 
    yaoText: [
      "初九：同人于門，無咎。",
      "六二：同人于宗，吝。",
      "九三：伏戎于莽，升其高陵，三歲不興。",
      "九四：乘其墉，弗克攻，吉。",
      "九五：同人，先號咷而后笑，大師克相遇。",
      "上九：同人于郊，無悔。"
    ] 
  },
  { 
    bits: "101110", 
    guaText: "革：己日乃孚，元亨利貞，悔亡。", 
    yaoText: [
      "初九：鞏用黃牛之革。",
      "六二：己日乃革之，征吉，無咎。",
      "九三：征凶，貞厲。革言三就，有孚。",
      "九四：悔亡，有孚改命，吉。",
      "九五：大人虎變，未占有孚。",
      "上六：君子豹變，小人革面，征凶，居貞吉。"
    ] 
  },
  { 
    bits: "101101", 
    guaText: "離：利貞，亨。畜牝牛吉。", 
    yaoText: [
      "初九：履錯然，敬之無咎。",
      "六二：黃離，元吉。",
      "九三：日昃之離，不鼓缶而歌，則大耋之嗟，凶。",
      "九四：突如其來如，焚如，死如，棄如。",
      "六五：出涕沱若，戚嗟若，吉。",
      "上九：王用出征，有嘉折首，獲匪其醜，無咎。"
    ] 
  },
  { 
    bits: "101100", 
    guaText: "豐：亨，王假之，勿憂，宜日中。", 
    yaoText: [
      "初九：遇其配主，雖旬無咎，往有尚。",
      "六二：豐其蔀，日中見斗，往得疑疾，有孚發若，吉。",
      "九三：豐其沛，日中見沫，折其右肱，無咎。",
      "九四：豐其蔀，日中見斗，遇其夷主，吉。",
      "六五：來章，有慶譽，吉。",
      "上六：豐其屋，蔀其家，窺其戶，闃其無人，三歲不覿，凶。"
    ] 
  },
  { 
    bits: "101011", 
    guaText: "家人：利女貞。", 
    yaoText: [
      "初九：閒有家，悔亡。",
      "六二：無攸遂，在中饋，貞吉。",
      "九三：家人嗃嗃，悔厲吉；婦子嘻嘻，終吝。",
      "六四：富家，大吉。",
      "九五：王假有家，勿恤，吉。",
      "上九：有孚威如，終吉。"
    ] 
  },
  { 
    bits: "101010", 
    guaText: "既濟：亨小，利貞，初吉終亂。", 
    yaoText: [
      "初九：曳其輪，濡其尾，無咎。",
      "六二：婦喪其茀，勿逐，七日得。",
      "九三：高宗伐鬼方，三年克之，小人勿用。",
      "六四：繻有衣袽，終日戒。",
      "九五：東鄰殺牛，不如西鄰之禴祭，實受其福。",
      "上六：濡其首，厲。"
    ] 
  },
  { 
    bits: "101001", 
    guaText: "賁：亨。小利有攸往。", 
    yaoText: [
      "初九：賁其趾，舍車而徒。",
      "六二：賁其須。",
      "九三：賁如濡如，永貞吉。",
      "六四：賁如皤如，白馬翰如，匪寇婚媾。",
      "六五：賁于丘園，束帛戔戔，吝，終吉。",
      "上九：白賁，無咎。"
    ] 
  },
  { 
    bits: "101000", 
    guaText: "明夷：利艱貞。", 
    yaoText: [
      "初九：明夷于飛，垂其翼。君子于行，三日不食，有攸往，主人有言。",
      "六二：明夷，夷于左股，用拯馬壯，吉。",
      "九三：明夷于南狩，得其大首，不可疾貞。",
      "六四：入于左腹，獲明夷之心，于出門庭。",
      "六五：箕子之明夷，利貞。",
      "上六：不明晦，初登于天，后入于地。"
    ] 
  },
  { 
    bits: "100111", 
    guaText: "無妄：元亨利貞。其匪正有眚，不利有攸往。", 
    yaoText: [
      "初九：無妄，往吉。",
      "六二：不耕獲，不菑畬，則利有攸往。",
      "六三：無妄之災，或繫之牛，行人之得，邑人之災。",
      "九四：可貞，無咎。",
      "九五：無妄之疾，勿藥有喜。",
      "上九：無妄，行有眚，無攸利。"
    ] 
  },
  { 
    bits: "100110", 
    guaText: "隨：元亨利貞，無咎。", 
    yaoText: [
      "初九：官有渝，貞吉。出門交有功。",
      "六二：繫小子，失丈夫。",
      "六三：繫丈夫，失小子。隨有求得，利居貞。",
      "九四：隨有獲，貞凶。有孚在道，以明，何咎。",
      "九五：孚于嘉，吉。",
      "上六：拘繫之，乃從維之，王用亨于西山。"
    ] 
  },
  { 
    bits: "100101", 
    guaText: "噬嗑：亨。利用獄。", 
    yaoText: [
      "初九：屨校滅趾，無咎。",
      "六二：噬膚滅鼻，無咎。",
      "六三：噬腊肉，遇毒，小吝，無咎。",
      "九四：噬乾胏，得金矢，利艱貞，吉。",
      "九五：噬乾肉，得黃金，貞厲，無咎。",
      "上九：何校滅耳，凶。"
    ] 
  },
  { 
    bits: "100100", 
    guaText: "震：亨。震來虩虩，笑言啞啞，震驚百里，不喪匕鬯。", 
    yaoText: [
      "初九：震來虩虩，后笑言啞啞，吉。",
      "六二：震來厲，億喪貝，躋于九陵，勿逐，七日得。",
      "六三：震蘇蘇，震行無眚。",
      "九四：震遂泥。",
      "六五：震往來厲，億無喪，有事。",
      "上六：震索索，視矍矍，征凶。震不于其躬，于其鄰，無咎。婚媾有言。"
    ] 
  },
  { 
    bits: "100011", 
    guaText: "益：利有攸往，利涉大川。", 
    yaoText: [
      "初九：利用為大作，元吉，無咎。",
      "六二：或益之十朋之龜，弗克違，永貞吉。王用享于帝，吉。",
      "六三：益之用凶事，無咎。有孚中行，告公用圭。",
      "六四：中行，告公從，利用為依遷國。",
      "九五：有孚惠心，勿問元吉。有孚惠我德。",
      "上九：莫益之，或擊之，立心勿恆，凶。"
    ] 
  },
  { 
    bits: "100010", 
    guaText: "屯：元亨利貞，勿用有攸往，利建侯。", 
    yaoText: [
      "初九：磐桓，利居貞，利建侯。",
      "六二：屯如邅如，乘馬班如。匪寇婚媾，女子貞不字，十年乃字。",
      "六三：即鹿無虞，惟入于林中，君子幾不如舍，往吝。",
      "六四：乘馬班如，求婚媾，往吉，無不利。",
      "九五：屯其膏，小貞吉，大貞凶。",
      "上六：乘馬班如，泣血漣如。"
    ] 
  },
  { 
    bits: "100001", 
    guaText: "頤：貞吉。觀頤，自求口實。", 
    yaoText: [
      "初九：舍爾靈龜，觀我朵頤，凶。",
      "六二：顛頤，拂經于丘頤，征凶。",
      "六三：拂頤，貞凶，十年勿用，無攸利。",
      "六四：顛頤，吉，虎視眈眈，其欲逐逐，無咎。",
      "六五：拂經，居貞吉，不可涉大川。",
      "上九：由頤，厲吉，利涉大川。"
    ] 
  },
  { 
    bits: "100000", 
    guaText: "復：亨。出入無疾，朋來無咎。反復其道，七日來復，利有攸往。", 
    yaoText: [
      "初九：不遠復，無祗悔，元吉。",
      "六二：休復，吉。",
      "六三：頻復，厲無咎。",
      "六四：中行獨復。",
      "六五：敦復，無悔。",
      "上六：迷復，凶，有災眚。用行師，終以大敗，以其國君凶，至于十年不克征。"
    ] 
  },
  { 
    bits: "011111", 
    guaText: "姤：女壯，勿用取女。", 
    yaoText: [
      "初六：繫于金柅，貞吉，有攸往，見凶，羸豕孚蹢躅。",
      "九二：包有魚，無咎，不利賓。",
      "九三：臀無膚，其行次且，厲，無大咎。",
      "九四：包無魚，起凶。",
      "九五：以杞包瓜，含章，有隕自天。",
      "上九：姤其角，吝，無咎。"
    ] 
  },
  { 
    bits: "011110", 
    guaText: "大過：棟撓，利有攸往，亨。", 
    yaoText: [
      "初六：藉用白茅，無咎。",
      "九二：枯楊生稊，老夫得其女妻，無不利。",
      "九三：棟撓，凶。",
      "九四：棟隆，吉；有它吝。",
      "九五：枯楊生華，老婦得士夫，無咎無譽。",
      "上六：過涉滅頂，凶，無咎。"
    ] 
  },
  { 
    bits: "011101", 
    guaText: "鼎：元吉，亨。", 
    yaoText: [
      "初六：鼎顛趾，利出否，得妾以其子，無咎。",
      "九二：鼎有實，我仇有疾，不我能即，吉。",
      "九三：鼎耳革，其行塞，雉膏不食，方雨虧悔，終吉。",
      "九四：鼎折足，覆公餗，其形渥，凶。",
      "六五：鼎黃耳金鉉，利貞。",
      "上九：鼎玉鉉，大吉，無不利。"
    ] 
  },
  { 
    bits: "011100", 
    guaText: "恆：亨，無咎，利貞，利有攸往。", 
    yaoText: [
      "初六：浚恆，貞凶，無攸利。",
      "九二：悔亡。",
      "九三：不恆其德，或承之羞，貞吝。",
      "九四：田無禽。",
      "六五：恆其德，貞，婦人吉，夫子凶。",
      "上六：振恆，凶。"
    ] 
  },
  { 
    bits: "011011", 
    guaText: "巽：小亨，利有攸往，利見大人。", 
    yaoText: [
      "初六：進退，利武人之貞。",
      "六二：巽在床下，用史巫紛若，吉，無咎。",
      "九三：頻巽，吝。",
      "六四：悔亡，田獲三品。",
      "九五：貞吉，悔亡，無不利。無初有終，先庚三日，后庚三日，吉。",
      "上九：巽在床下，喪其資斧，貞凶。"
    ] 
  },
  { 
    bits: "011010", 
    guaText: "井：改邑不改井，無喪無得，往來井井。汔至，亦未繘井，羸其瓶，凶。", 
    yaoText: [
      "初六：井泥不食，舊井無禽。",
      "九二：井谷射鮒，瓮敝漏。",
      "九三：井渫不食，為我心惻，可用汲，王明，並受其福。",
      "六四：井甃，無咎。",
      "九五：井冽，寒泉食。",
      "上六：井收勿幕，有孚元吉。"
    ] 
  },
  { 
    bits: "011001", 
    guaText: "蠱：元亨，利涉大川。先甲三日，后甲三日。", 
    yaoText: [
      "初六：幹父之蠱，有子，考無咎，厲終吉。",
      "九二：幹母之蠱，不可貞。",
      "九三：幹父之蠱，小有悔，無大咎。",
      "六四：裕父之蠱，往見吝。",
      "六五：幹父之蠱，用譽。",
      "上九：不事王侯，高尚其事。"
    ] 
  },
  { 
    bits: "011000", 
    guaText: "升：元亨，用見大人，勿恤，南征吉。", 
    yaoText: [
      "初六：允升，大吉。",
      "九二：孚乃利用禴，無咎。",
      "九三：升虛邑。",
      "六四：王用亨于岐山，吉，無咎。",
      "六五：貞吉，升階。",
      "上六：冥升，利于不息之貞。"
    ] 
  },
  { 
    bits: "010111", 
    guaText: "訟：有孚窒，惕中吉，終凶。利見大人，不利涉大川。", 
    yaoText: [
      "初六：不永所事，小有言，終吉。",
      "九二：不克訟，歸而逋，其邑人三百戶，無眚。",
      "六三：食舊德，貞厲，終吉，或從王事，無成。",
      "九四：不克訟，復即命，渝安貞，吉。",
      "九五：訟元吉。",
      "上九：或錫之鞶帶，終朝三褫之。"
    ] 
  },
  { 
    bits: "010110", 
    guaText: "困：亨，貞，大人吉，無咎，有言不信。", 
    yaoText: [
      "初六：臀困于株木，入于幽谷，三歲不覿。",
      "九二：困于酒食，朱紱方來，利用享祀，征凶，無咎。",
      "六三：困于石，據于蒺藜，入于其宮，不見其妻，凶。",
      "九四：來徐徐，困于金車，吝，有終。",
      "九五：劓刖，困于赤紱，乃徐有說，利用祭祀。",
      "上六：困于葛藟，于臲卼，曰動悔有悔，征吉。"
    ] 
  },
  { 
    bits: "010101", 
    guaText: "未濟：亨，小狐汔濟，未出中。利貞。", 
    yaoText: [
      "初六：濡其尾，吝。",
      "九二：曳其輪，貞吉。",
      "六三：未濟，征凶，利涉大川。",
      "九四：貞吉，悔亡，震用伐鬼方，三年有賞于大國。",
      "六五：貞吉，無悔，君子之光，有孚，吉。",
      "上九：有孚于飲酒，無咎，濡其首，有孚失是。"
    ] 
  },
  { 
    bits: "010100", 
    guaText: "解：利西南，無不利，利有攸往。", 
    yaoText: [
      "初六：無咎。",
      "九二：田獲三狐，得黃矢，貞吉。",
      "六三：負且乘，致寇至，貞吝。",
      "九四：解而拇，朋至斯孚。",
      "六五：君子維有解，吉，有孚于小人。",
      "上六：公用射隼于高墉之上，獲之，無不利。"
    ] 
  },
  { 
    bits: "010011", 
    guaText: "渙：亨，王假之，無咎。", 
    yaoText: [
      "初六：用拯馬壯，吉。",
      "九二：渙奔其機，悔亡。",
      "六三：渙其躬，無悔。",
      "六四：渙其群，元吉。渙有丘，匪夷所思。",
      "九五：渙汗其大號，渙王居，無咎。",
      "上九：渙其血，去逖出，無咎。"
    ] 
  },
  { 
    bits: "010010", 
    guaText: "坎：有孚，維心亨，行有尚。", 
    yaoText: [
      "初六：習坎，入于坎窞，凶。",
      "九二：坎有險，求小得。",
      "六三：來之坎坎，險且枕，入于坎窞，勿用。",
      "六四：樽酒簋貳，用缶，納約自牖，終無咎。",
      "九五：坎不盈，祗既平，無咎。",
      "上六：繫用徽纆，寘于叢棘，三歲不得，凶。"
    ] 
  },
  { 
    bits: "010001", 
    guaText: "蒙：亨。匪我求童蒙，童蒙求我。初筮告，再三瀆，瀆則不告。利貞。", 
    yaoText: [
      "初六：發蒙，利用刑人，用說桎梏，以往吝。",
      "九二：包蒙吉，納婦吉，子克家。",
      "六三：勿用取女，見金夫，不有躬，無攸利。",
      "六四：困蒙，吝。",
      "六五：童蒙，吉。",
      "上九：擊蒙，不利為寇，利御寇。"
    ] 
  },
  { 
    bits: "010000", 
    guaText: "師：貞，丈人吉，無咎。", 
    yaoText: [
      "初六：師出以律，否臧凶。",
      "九二：在師中吉，無咎，王三錫命。",
      "六三：師或輿尸，凶。",
      "六四：師左次，無咎。",
      "六五：田有禽，利執言，無咎。長子帥師，弟子輿尸，貞凶。",
      "上六：大君有命，開國承家，小人勿用。"
    ] 
  },
  { 
    bits: "001111", 
    guaText: "遯：亨，小利貞。", 
    yaoText: [
      "初六：遯尾，厲，勿用有攸往。",
      "六二：執之用黃牛之革，莫之勝說。",
      "九三：繫遯，有疾厲，畜臣妾吉。",
      "九四：好遯，君子吉，小人否。",
      "九五：嘉遯，貞吉。",
      "上九：肥遯，無不利。"
    ] 
  },
  { 
    bits: "001110", 
    guaText: "咸：亨，利貞，取女吉。", 
    yaoText: [
      "初六：咸其拇。",
      "六二：咸其腓，凶，居吉。",
      "九三：咸其股，執其隨，往吝。",
      "九四：貞吉，悔亡，憧憧往來，朋從爾思。",
      "九五：咸其脢，無悔。",
      "上六：咸其輔，顎，舌。"
    ] 
  },
  { 
    bits: "001101", 
    guaText: "旅：小亨，旅貞吉。", 
    yaoText: [
      "初六：旅瑣瑣，斯其所取災。",
      "六二：旅即次，懷其資，得童僕，貞。",
      "九三：旅焚其次，喪其童僕，貞厲。",
      "九四：旅于處，得其資斧，我心不快。",
      "六五：射雉一矢亡，終以譽命。",
      "上九：鳥焚其巢，旅人先笑后號咷，喪牛于易，凶。"
    ] 
  },
  { 
    bits: "001100", 
    guaText: "小過：亨，利貞，可小事，不可大事。飛鳥遺之音，不宜上，宜下，大吉。", 
    yaoText: [
      "初六：飛鳥以凶。",
      "六二：過其祖，遇其妣；不及其君，遇其臣，無咎。",
      "九三：弗過防之，從或戕之，凶。",
      "九四：無咎，弗過遇之，往厲必戒，勿用永貞。",
      "六五：密雲不雨，自我西郊，公弋取彼在穴。",
      "上六：弗遇過之，飛鳥離之，凶，是謂災眚。"
    ] 
  },
  { 
    bits: "001011", 
    guaText: "漸：女歸吉，利貞。", 
    yaoText: [
      "初六：鴻漸于乾，君子之行，無咎。",
      "六二：鴻漸于磐，飲食衎衎，吉。",
      "九三：鴻漸于陸，夫征不復，婦孕不育，凶；利御寇。",
      "六四：鴻漸于木，或得其桷，無咎。",
      "九五：鴻漸于陵，婦三歲不孕，終莫之勝，吉。",
      "上九：鴻漸于陸，其羽可用為儀，吉。"
    ] 
  },
  { 
    bits: "001010", 
    guaText: "蹇：利西南，不利東北，利見大人，貞吉。", 
    yaoText: [
      "初六：往蹇，來譽。",
      "六二：王臣蹇蹇，匪躬之故。",
      "九三：往蹇，來反。",
      "六四：往蹇，來連。",
      "九五：大蹇，朋來。",
      "上六：往蹇，來碩，吉，利見大人。"
    ] 
  },
  { 
    bits: "001001", 
    guaText: "艮：艮其背，不獲其身，行其庭，不見其人，無咎。", 
    yaoText: [
      "初六：艮其趾，無咎，利永貞。",
      "六二：艮其腓，不拯其隨，其心不快。",
      "九三：艮其限，列其夤，厲薰心。",
      "六四：艮其身，無咎。",
      "六五：艮其輔，言有序，悔亡。",
      "上九：敦艮，吉。"
    ] 
  },
  { 
    bits: "001000", 
    guaText: "謙：亨，君子有終。", 
    yaoText: [
      "初六：謙謙君子，用涉大川，吉。",
      "六二：鳴謙，貞吉。",
      "九三：勞謙，君子有終，吉。",
      "六四：無不利，撝謙。",
      "六五：不富以其鄰，利用侵伐，無不利。",
      "上六：鳴謙，利用行師，征邑國。"
    ] 
  },
  { 
    bits: "000111", 
    guaText: "否：否之匪人，不利君子貞，大往小來。", 
    yaoText: [
      "初六：拔茅茹，以其彙，貞吉，亨。",
      "六二：包承，小人吉，大人否，亨。",
      "六三：包羞。",
      "九四：有命無咎，畴離祉。",
      "九五：休否，大人吉。其亡其亡，繫于苞桑。",
      "上九：傾否，先否后喜。"
    ] 
  },
  { 
    bits: "000110", 
    guaText: "萃：亨，王假有廟，利見大人，亨，利貞。用大牲吉，利有攸往。", 
    yaoText: [
      "初六：有孚不終，乃亂乃萃，若號，一握為笑，勿恤，往無咎。",
      "六二：引吉，無咎，孚乃利用禴。",
      "六三：萃如嗟如，無攸利，往無咎，小吝。",
      "九四：大吉，無咎。",
      "九五：萃有位，無咎。匪孚，元永貞，悔亡。",
      "上六：齎咨涕洟，無咎。"
    ] 
  },
  { 
    bits: "000101", 
    guaText: "晉：康侯用錫馬蕃庶，晝日三接不说，三接。", 
    yaoText: [
      "初六：晉如，摧如，無攸利。",
      "六二：晉其大，吉，無咎。",
      "九三：受爵，勿用，無咎。",
      "九四：晉其足，利，無咎。",
      "六五：晉其明，利，無咎。",
      "上九：晉其燿，利，無咎。"
    ] 
  },
  { 
    bits: "000100", 
    guaText: "豫：利建侯行師。", 
    yaoText: [
      "初六：鳴豫，大吝。",
      "六二：介于石，不終日，貞吉。",
      "六三：盱豫，悔，遲有悔。",
      "九四：由豫，大有得，勿疑，朋盍簪。",
      "九五：貞疾，恆不豫，無咎。",
      "上六：冥豫，成有渝，無咎。"
    ] 
  },
  { 
    bits: "000011", 
    guaText: "觀：盥而不薦，有孚顒若。", 
    yaoText: [
      "初六：童觀，小人無咎，君子吝。",
      "六二：窺觀，利女貞。",
      "六三：觀我生，進退。",
      "九四：觀國之光，利用賓于王。",
      "九五：觀我生，君子無咎。",
      "上九：觀其生，志未平。"
    ] 
  },
  { 
    bits: "000010", 
    guaText: "比：吉。原筮，元永貞，無咎。不寧方來，后夫凶。", 
    yaoText: [
      "初九：有孚比，吉。",
      "九二：比之自內，貞吉。",
      "六三：比之匪人。",
      "六四：外比之，與賢人親。",
      "九五：顯比，王用三驅，失前禽，邑人不戒，吉。",
      "上六：比之無首，凶。"
    ] 
  },
  { 
    bits: "000001", 
    guaText: "剝：不利有攸往。", 
    yaoText: [
      "初六：剝床以足，蔑貞，凶。",
      "六二：剝床以辨，蔑貞，凶。",
      "六三：剝之無咎。",
      "六四：剝床以膚，凶。",
      "六五：貫魚，以宮人寵，無不利。",
      "上九：碩果不食，君子得輿，小人剝盧。"
    ] 
  },
  { 
    bits: "000000", 
    guaText: "坤：元亨，利牝馬之貞。君子有攸往，先迷后得主，利西南得朋，東北喪朋。安貞吉。", 
    yaoText: [
      "初六：履霜，堅冰至。",
      "六二：直方大，不習無不利。",
      "六三：含章可貞，或從王事，無成有終。",
      "六四：括囊，無咎無譽。",
      "六五：黃裳，元吉。",
      "上六：龍戰於野，其血玄黃。"
    ] 
  }
];

// 建立節點與邊線
const nodes = [];
const edges = [];
const bitToIndex = {};
for (let i = 0; i < kingwenBits.length; i++) {
  const bits = kingwenBits[i];
  const name = guaNames[i];
  const codonInfo = codonData.find(c => c.bits === bits) || { codon: "未知", aminoAcid: "未知", color: "#888" };
  const sunCount = bits.split('').reduce((a, b) => a + Number(b), 0);
  nodes.push({
    id: i,
    label: name,
    title: `<b>${name}</b><br>${bits}<br>密碼子: ${codonInfo.codon}<br>胺基酸: ${codonInfo.aminoAcid}<br><small>點擊查看詳細</small>`,
    bits: bits,
    gua: name,
    codon: codonInfo.codon,
    aminoAcid: codonInfo.aminoAcid,
    color: { background: codonInfo.color },
    value: Math.max(1, sunCount)
  });
  bitToIndex[bits] = i;
}
for (let i = 0; i < kingwenBits.length; i++) {
  const bits = kingwenBits[i];
  for (let j = 0; j < 6; j++) {
    const nb = bits.split('');
    nb[j] = nb[j] === '1' ? '0' : '1';
    const nbstr = nb.join('');
    const k = bitToIndex[nbstr];
    if (k !== undefined && i < k) {
      edges.push({ from: i, to: k });
    }
  }
}

// 建立網絡
const container = document.getElementById('mynetwork');
const data = { nodes: nodes, edges: edges };
const options = {
  nodes: {
    shape: 'dot',
    size: 18,
    font: { size: 12 }
  },
  edges: {
    width: 1,
    color: { color: '#888' }
  },
  physics: {
    stabilization: false,
    barnesHut: { gravitationalConstant: -4000, springLength: 120 }
  }
};
const network = new vis.Network(container, data, options);

// 顯示卦象資訊
function showGua(idx, highlightLine = null) {
  const node = nodes[idx];
  const guaTextInfo = guaTextData.find(g => g.bits === node.bits) || {
    guaText: "暫無卦辭",
    yaoText: ["暫無爻辭", "暫無爻辭", "暫無爻辭", "暫無爻辭", "暫無爻辭", "暫無爻辭"]
  };
  document.getElementById('guaName').innerText = `${node.gua} （#${idx + 1}）`;
  document.getElementById('guaBits').innerText = `六爻二進位：${node.bits} （上→下，1=陽，0=陰）`;
  document.getElementById('guaText').innerHTML = `
    <h4>遺傳密碼子</h4>
    <p>密碼子：${node.codon}</p>
    <p>胺基酸：<span class="amino-acid" style="background-color:${node.color.background}" aria-label="胺基酸 ${node.aminoAcid}">${node.aminoAcid}</span></p>
    <h4>卦辭</h4>
    <p>${guaTextInfo.guaText}</p>
    <h4>爻辭</h4>
    <ul>${guaTextInfo.yaoText.map((yao, i) => `<li>${6 - i}爻：${yao}</li>`).join('')}</ul>
  `;
  let changeHtml = '<h4>六個可能的變卦（點擊跳轉並高亮）</h4>';
  for (let j = 0; j < 6; j++) {
    const bitsArr = node.bits.split('');
    bitsArr[j] = bitsArr[j] === '1' ? '0' : '1';
    const newBits = bitsArr.join('');
    const newIdx = bitToIndex[newBits];
    const moving = 6 - j;
    const newCodon = codonData.find(c => c.bits === newBits).codon;
    const newAminoAcid = codonData.find(c => c.bits === newBits).aminoAcid;
    const newColor = codonData.find(c => c.bits === newBits).color;
    changeHtml += `
      <div class="change-item" onclick="jumpTo(${newIdx}, ${j})">
        <b>動爻 ${moving}（翻轉） → ${guaNames[newIdx]} （#${newIdx + 1}）</b><br>
        <small>${newBits} | 密碼子: ${newCodon} | 胺基酸: <span class="amino-acid" style="background-color:${newColor}" aria-label="胺基酸 ${newAminoAcid}">${newAminoAcid}</span></small>
      </div>`;
  }
  document.getElementById('changeList').innerHTML = changeHtml;
  network.selectNodes([idx]);
  network.focus(idx, { scale: 1.2, animation: true });
  clearHighlights();
  network.body.data.nodes.update({ id: idx, color: { background: '#ffeb3b' } });
  const panel = document.getElementById('panel');
  panel.classList.remove('hide');
  panel.classList.add('show');
  panel.style.display = 'block';
}

// 關閉面板
function closePanel() {
  const panel = document.getElementById('panel');
  panel.classList.remove('show');
  panel.classList.add('hide');
  setTimeout(() => { panel.style.display = 'none'; }, 300);
  clearHighlights();
}

// 跳轉至變卦
function jumpTo(idx, movedIndex) {
  showGua(idx);
  const list = document.getElementById('changeList');
  const items = list.getElementsByClassName('change-item');
  for (let i = 0; i < items.length; i++) items[i].classList.remove('highlight');
  if (items && items[movedIndex]) {
    items[movedIndex].classList.add('highlight');
  }
}

// 清除高亮
function clearHighlights() {
  const updates = [];
  for (const n of nodes) {
    updates.push({ id: n.id, color: { background: n.color.background } });
  }
  network.body.data.nodes.update(updates);
}

// 網絡點擊事件
network.on("click", function (params) {
  if (params.nodes.length > 0) {
    const idx = params.nodes[0];
    showGua(idx);
  } else {
    closePanel();
  }
});

// 重置視角
document.getElementById('btnCenter').onclick = function () {
  network.fit({ animation: true });
  closePanel();
};
</script>
</body>
</html>