<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 è’™ç‰¹å¡æ´› 2.0 - æˆ°ç•¥æ±ºç­–æ¨¡æ“¬ç¶²</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #2c3e50; --accent: #e67e22; --bg: #f8f9fa; }
        body { font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; background: var(--bg); margin: 0; padding: 15px; }
        .grid-layout { display: grid; grid-template-columns: 350px 1fr; gap: 20px; max-width: 1300px; margin: auto; }
        .panel { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        h2 { border-bottom: 2px solid var(--accent); padding-bottom: 10px; font-size: 1.2rem; }
        .input-group { margin-bottom: 15px; padding: 10px; border: 1px solid #eee; border-radius: 8px; }
        label { display: block; font-size: 0.9rem; font-weight: bold; margin-bottom: 5px; }
        input[type="number"] { width: 60px; padding: 4px; border-radius: 4px; border: 1px solid #ccc; }
        .btn-sync { background: #3498db; color: white; width: 100%; padding: 10px; border: none; border-radius: 5px; cursor: pointer; margin-bottom: 10px; }
        .btn-run { background: var(--accent); color: white; width: 100%; padding: 15px; border: none; border-radius: 5px; cursor: pointer; font-size: 1.1rem; font-weight: bold; }
        .chart-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .radar-box { height: 400px; }
        .stats-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9rem; }
        .stats-table th { background: #eee; padding: 8px; }
        .stats-table td { padding: 8px; border-bottom: 1px solid #eee; text-align: center; }
        @media (max-width: 900px) { .grid-layout { grid-template-columns: 1fr; } .chart-container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="grid-layout">
    <div class="panel">
        <h2>ğŸ› ï¸ é¸æƒ…æ¨¡å‹åƒæ•¸</h2>
        <button class="btn-sync" onclick="sync2026Data()">ğŸ“¡ åŒæ­¥ 2026.01 æœ€æ–°æ°‘èª¿ (API æ¨¡æ“¬)</button>
        
        <div id="controls">
            </div>

        <button class="btn-run" onclick="startMonteCarlo()">ğŸ² å•Ÿå‹• 10,000 æ¬¡è’™ç‰¹å¡æ´›æ¨¡æ“¬</button>
        
        <p style="font-size: 0.8rem; color: #666; margin-top: 15px;">
            * æ¨¡æ“¬åŒ…å«ï¼šBox-Muller å¸¸æ…‹åˆ†é…ã€æ£„ä¿æ•ˆæ‡‰æ¼”ç®—ã€çµ„ç¹”å‹•å“¡åŠ æ¬Šã€‚
        </p>
    </div>

    <div class="panel">
        <h2>ğŸ“Š æˆ°ç•¥åˆ†æå ±è¡¨</h2>
        <div class="chart-container">
            <div class="radar-box">
                <canvas id="radarChart"></canvas>
            </div>
            <div class="radar-box">
                <canvas id="winChart"></canvas>
            </div>
        </div>
        
        <div style="margin-top: 20px;">
            <h3>ğŸ æ¨¡æ“¬é æ¸¬çµæœ</h3>
            <table class="stats-table" id="resultTable">
                <thead>
                    <tr>
                        <th>å€™é¸äºº</th>
                        <th>å¹³å‡æ”¯æŒåº¦</th>
                        <th>å‹é¸æ¬¡æ•¸</th>
                        <th>å‹é¸æ©Ÿç‡ (Win Prob.)</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<script>
let candidates = [
    { id: 0, name: "æå››å· (è—)", mean: 40, sd: 3, air: 70, org: 90, img: 85, color: "rgba(0, 0, 149, 0.7)" },
    { id: 1, name: "è˜‡å·§æ…§ (ç¶ )", mean: 35, sd: 3, air: 85, org: 80, img: 80, color: "rgba(27, 148, 49, 0.7)" },
    { id: 2, name: "é»ƒåœ‹æ˜Œ (ç™½)", mean: 15, sd: 5, air: 95, org: 40, img: 70, color: "rgba(40, 200, 200, 0.7)" }
];

let radarChart, winChart;

// 1. åˆå§‹åŒ–ç•Œé¢
function renderInputs() {
    const container = document.getElementById('controls');
    container.innerHTML = candidates.map((c, i) => `
        <div class="input-group" style="border-left: 5px solid ${c.color}">
            <label>${c.name}</label>
            æ°‘èª¿ %: <input type="number" value="${c.mean}" id="m-${i}"> 
            èª¤å·®: <input type="number" value="${c.sd}" id="s-${i}"> <br>
            <small>ç©ºæˆ°:${c.air} / çµ„ç¹”:${c.org} / å½¢è±¡:${c.img}</small>
        </div>
    `).join('');
    updateRadar();
}

// 2. é›·é”åœ–æ›´æ–° (éœ€æ±‚ 1)
function updateRadar() {
    const ctx = document.getElementById('radarChart').getContext('2d');
    if (radarChart) radarChart.destroy();
    radarChart = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: ['ç©ºæˆ°èƒ½åŠ›', 'åœ°æ–¹çµ„ç¹”', 'å½¢è±¡é­…åŠ›'],
            datasets: candidates.map(c => ({
                label: c.name,
                data: [c.air, c.org, c.img],
                backgroundColor: c.color,
                borderColor: c.color.replace('0.7', '1'),
                borderWidth: 1
            }))
        },
        options: { scales: { r: { suggestMin: 0, suggestMax: 100 } } }
    });
}

// 3. æ¨¡æ“¬ API åŒæ­¥ (éœ€æ±‚ 2)
function sync2026Data() {
    // æ¨¡æ“¬å¾ 2026 å¹´ 1 æœˆçš„çœŸå¯¦æ°‘èª¿æ•¸æ“šæ›´æ–°
    alert("æ­£åœ¨é€£ç·šè‡³ 2026 ä¸­å¤®é¸å§”æœƒ/åª’é«”æ°‘èª¿è³‡æ–™åº«...");
    
    // æ ¹æ“š 2026.01 çš„é¸æƒ…ï¼ˆæ°‘é€²é»¨åˆé¸ç™½ç†±åŒ–ã€è—ç™½åˆè¨è«–ï¼‰èª¿æ•´åƒæ•¸
    candidates[0].mean = 38.5; // æå››å·
    candidates[1].mean = 34.2; // è˜‡å·§æ…§
    candidates[2].mean = 12.5; // é»ƒåœ‹æ˜Œ
    
    renderInputs();
}

// è’™ç‰¹å¡æ´›æ ¸å¿ƒæ¼”ç®—
function randn_bm() {
    let u = 0, v = 0;
    while(u === 0) u = Math.random();
    while(v === 0) v = Math.random();
    return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
}

function startMonteCarlo() {
    const iterations = 10000;
    const stats = candidates.map(c => ({ ...c, wins: 0, totalScore: 0 }));

    for (let i = 0; i < iterations; i++) {
        let currentScores = stats.map(c => {
            let base = parseFloat(document.getElementById(`m-${c.id}`).value);
            let sd = parseFloat(document.getElementById(`s-${c.id}`).value);
            
            // åŠ å…¥çµ„ç¹”åŠ›åŠ æ¬Šï¼šçµ„ç¹”åŠ›è¶Šé«˜ï¼Œå¾—ç¥¨ä¸‹é™è¶Šé«˜
            let orgBonus = (c.org / 100) * 2; 
            let score = base + (randn_bm() * sd) + orgBonus;
            return { id: c.id, score: score };
        });

        // ç­–ç•¥æ€§æ£„ä¿æ¨¡æ“¬ï¼šè‹¥ç¬¬ä¸‰åä½æ–¼ 12%ï¼Œå°‡éƒ¨åˆ†é¸ç¥¨æµå‘å…‰è­œæ¥è¿‘è€…
        let whiteIndex = currentScores.find(s => s.id === 2);
        if (whiteIndex.score < 12) {
            let leakage = whiteIndex.score * 0.3;
            whiteIndex.score -= leakage;
            currentScores[0].score += leakage; // å‡è¨­æµå‘è—ç‡Ÿ
        }

        let winner = currentScores.reduce((prev, curr) => (curr.score > prev.score) ? curr : prev);
        stats[winner.id].wins++;
        stats.forEach((c, idx) => c.totalScore += currentScores[idx].score);
    }

    updateResults(stats, iterations);
}

function updateResults(stats, total) {
    // æ›´æ–°è¡¨æ ¼
    const tbody = document.querySelector('#resultTable tbody');
    tbody.innerHTML = stats.sort((a,b) => b.wins - a.wins).map(c => `
        <tr>
            <td>${c.name}</td>
            <td>${(c.totalScore/total).toFixed(2)}%</td>
            <td>${c.wins}</td>
            <td style="color:red; font-weight:bold;">${((c.wins/total)*100).toFixed(1)}%</td>
        </tr>
    `).join('');

    // æ›´æ–°å‹ç‡åœ–
    const ctx = document.getElementById('winChart').getContext('2d');
    if (winChart) winChart.destroy();
    winChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: stats.map(c => c.name),
            datasets: [{
                data: stats.map(c => c.wins),
                backgroundColor: stats.map(c => c.color)
            }]
        },
        options: { plugins: { title: { display: true, text: 'å‹é¸æ©Ÿç‡åˆ†ä½ˆ' } } }
    });
}

// å•Ÿå‹•
renderInputs();
</script>

</body>
</html>