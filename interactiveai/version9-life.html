<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>ğŸ¤– ç”Ÿæ´»åŒ– AI æ±ºç­–</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{width:100%;overflow-x:hidden}
body{font-family:'Segoe UI',sans-serif;background:linear-gradient(160deg,#43e97b 0%,#38f9d7 40%,#4facfe 100%);min-height:100vh;padding:12px}

h1{color:#fff;text-align:center;font-size:clamp(1.3rem,6vw,2rem);text-shadow:0 2px 8px rgba(0,0,0,0.2);margin-bottom:3px}
.subtitle{color:rgba(255,255,255,0.9);text-align:center;font-size:clamp(0.78rem,3.5vw,1rem);margin-bottom:14px}

.card{background:#fff;border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,0.12);padding:14px;margin-bottom:12px}
h2{color:#00b09b;font-size:clamp(0.95rem,4.5vw,1.25rem);margin-bottom:10px;display:flex;align-items:center;gap:6px}

/* å ´æ™¯æŒ‰éˆ• */
.scenes{display:grid;grid-template-columns:repeat(2,1fr);gap:6px}
@media(min-width:480px){.scenes{grid-template-columns:repeat(4,1fr)}}
.sbtn{padding:12px 6px;border:2px solid #eee;border-radius:12px;background:#fafafa;cursor:pointer;text-align:center;transition:all .2s;font-size:clamp(0.65rem,2.8vw,0.85rem);color:#555;line-height:1.4;width:100%}
.sbtn .emo{font-size:clamp(1.5rem,6vw,2rem);display:block;margin-bottom:4px}
.sbtn:active{transform:scale(.94)}
.sbtn.active{border-color:#00b09b;background:linear-gradient(135deg,#d4f5ee,#b2ede3);color:#00796b;font-weight:700}

/* è¨“ç·´è³‡æ–™ */
.train-list{background:#f0faf8;border-radius:10px;padding:10px}
.train-row{padding:7px 0;border-bottom:1px dashed #b2ede3;font-size:clamp(0.7rem,2.8vw,0.88rem);line-height:1.5}
.train-row:last-child{border-bottom:none}
.train-row .top{display:flex;align-items:center;gap:5px;flex-wrap:wrap;margin-bottom:3px}
.io{background:#00b09b;color:#fff;border-radius:5px;padding:2px 7px;font-size:clamp(0.62rem,2.5vw,0.78rem);white-space:nowrap;flex-shrink:0}
.io.out{background:#4facfe}
.arrow{color:#ccc}
.train-row .lbl{color:#888;font-size:clamp(0.65rem,2.5vw,0.82rem)}

/* Canvas */
#nn-canvas{width:100%;display:block;border-radius:12px;background:#1a1a2e}

/* è¨“ç·´æŒ‰éˆ• */
.btn-row{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px}
.btn{padding:13px 6px;border:none;border-radius:10px;cursor:pointer;font-weight:700;font-size:clamp(0.82rem,3.5vw,1rem);transition:all .2s;color:#fff;touch-action:manipulation}
.btn:active{transform:scale(.96)}
.btn-train{background:linear-gradient(135deg,#43e97b,#38f9d7)}
.btn-auto{background:linear-gradient(135deg,#4facfe,#00f2fe)}
.btn-reset{background:linear-gradient(135deg,#96fbc4,#f9f586);color:#555;grid-column:1/-1}
.stats{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.stat-box{background:linear-gradient(135deg,#d4f5ee,#b2ede3);border-radius:10px;padding:10px;text-align:center}
.stat-lbl{font-size:clamp(0.7rem,2.8vw,0.85rem);color:#aaa;margin-bottom:3px}
.stat-val{font-size:clamp(1.3rem,6vw,1.8rem);font-weight:900;color:#00796b}

/* æ»‘æ¡¿ */
.slider-wrap{margin-bottom:14px}
.sl-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px}
.sl-top span:first-child{font-weight:600;color:#555;font-size:clamp(0.82rem,3.5vw,1rem)}
.sl-pct{font-size:clamp(0.9rem,4vw,1.1rem);font-weight:700;color:#00b09b;min-width:42px;text-align:right}
input[type=range]{width:100%;-webkit-appearance:none;appearance:none;height:7px;border-radius:4px;background:#b2ede3;outline:none;cursor:pointer}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:26px;height:26px;border-radius:50%;background:linear-gradient(135deg,#43e97b,#00b09b);cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.18)}
input[type=range]::-moz-range-thumb{width:26px;height:26px;border-radius:50%;background:linear-gradient(135deg,#43e97b,#00b09b);cursor:pointer;border:none}

.predict-btn{width:100%;padding:16px;border:none;border-radius:12px;background:linear-gradient(135deg,#43e97b,#4facfe);color:#fff;font-weight:700;font-size:clamp(1rem,4.5vw,1.2rem);cursor:pointer;margin-top:6px;box-shadow:0 4px 15px rgba(67,233,123,0.4);touch-action:manipulation;transition:all .2s}
.predict-btn:active{transform:scale(.97)}

/* çµæœ */
.result-box{border-radius:12px;padding:16px;text-align:center;margin-top:12px;display:none;border:2px solid transparent;animation:pop .3s ease}
.result-box.show{display:block}
.r-emo{font-size:clamp(2rem,10vw,3rem);margin-bottom:6px}
.r-text{font-size:clamp(1.2rem,5.5vw,1.7rem);font-weight:700;margin-bottom:5px}
.r-pct{font-size:clamp(1.4rem,7vw,2rem);font-weight:900;margin-bottom:8px}
.r-advice{font-size:clamp(0.8rem,3.2vw,0.95rem);line-height:1.7;background:rgba(255,255,255,0.75);border-radius:8px;padding:10px;color:#555}

/* èªªæ˜ */
.steps{display:grid;gap:10px}
.step{display:flex;gap:10px;align-items:flex-start}
.step-ico{font-size:clamp(1.5rem,6vw,1.9rem);flex-shrink:0;line-height:1}
.step-text h4{color:#555;font-weight:700;margin-bottom:2px;font-size:clamp(0.85rem,3.5vw,1rem)}
.step-text p{color:#999;font-size:clamp(0.75rem,3vw,0.88rem);line-height:1.5}
.tip-box{background:linear-gradient(135deg,#d4f5ee,#b2ede3);border-radius:10px;padding:13px;margin-top:10px}
.tip-box p{font-size:clamp(0.75rem,3vw,0.9rem);color:#00796b;line-height:1.9}

@keyframes pop{from{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
.pulsing{animation:pulse 1s infinite}
</style>
</head>
<body>

<h1>ğŸ¤– ç”Ÿæ´»åŒ– AI æ±ºç­–</h1>
<p class="subtitle">ç”¨æ—¥å¸¸å ´æ™¯å­¸ç¿’ç¥ç¶“ç¶²è·¯ï¼</p>

<!-- å ´æ™¯ -->
<div class="card">
  <h2>ğŸ¯ é¸æ“‡ç”Ÿæ´»å ´æ™¯</h2>
  <div class="scenes" id="scenes"></div>
</div>

<!-- ç¥ç¶“ç¶²è·¯ç•«å¸ƒ -->
<div class="card">
  <h2>ğŸ§  ç¥ç¶“ç¶²è·¯çµæ§‹</h2>
  <canvas id="nn-canvas"></canvas>
</div>

<!-- è¨“ç·´è³‡æ–™ -->
<div class="card">
  <h2 id="scene-title">ğŸ“š å­¸ç¿’æ¡ˆä¾‹</h2>
  <p id="scene-desc" style="color:#aaa;font-size:clamp(0.78rem,3vw,0.92rem);margin-bottom:10px;line-height:1.5"></p>
  <div class="train-list" id="train-list"></div>
</div>

<!-- è¨“ç·´ -->
<div class="card">
  <h2>ğŸ® è¨“ç·´ AI</h2>
  <div class="btn-row">
    <button class="btn btn-train" onclick="trainOnce()">ğŸ’ª å­¸ç¿’ä¸€æ¬¡</button>
    <button class="btn btn-auto" id="auto-btn" onclick="toggleAuto()">ğŸš€ å¿«é€Ÿè¨“ç·´</button>
    <button class="btn btn-reset" onclick="resetNN()">ğŸ”„ é‡æ–°é–‹å§‹</button>
  </div>
  <div class="stats">
    <div class="stat-box"><div class="stat-lbl">å­¸ç¿’æ¬¡æ•¸</div><div class="stat-val" id="epoch-val">0</div></div>
    <div class="stat-box"><div class="stat-lbl">AI æº–ç¢ºåº¦</div><div class="stat-val" id="acc-val">0%</div></div>
  </div>
</div>

<!-- æ¸¬è©¦ -->
<div class="card">
  <h2>ğŸ”® æ¸¬è©¦ä½ çš„æƒ…æ³</h2>
  <div class="slider-wrap">
    <div class="sl-top"><span id="lbl-a">æ¢ä»¶A</span><span class="sl-pct" id="pct-a">50%</span></div>
    <input type="range" id="sl-a" min="0" max="100" value="50">
  </div>
  <div class="slider-wrap">
    <div class="sl-top"><span id="lbl-b">æ¢ä»¶B</span><span class="sl-pct" id="pct-b">50%</span></div>
    <input type="range" id="sl-b" min="0" max="100" value="50">
  </div>
  <button class="predict-btn" onclick="predict()">ğŸ¤– AI çš„å»ºè­°æ˜¯ï¼Ÿ</button>
  <div class="result-box" id="result-box">
    <div class="r-emo" id="r-emo"></div>
    <div class="r-text" id="r-text"></div>
    <div class="r-pct" id="r-pct"></div>
    <div class="r-advice" id="r-advice"></div>
  </div>
</div>

<!-- åŸç† -->
<div class="card">
  <h2>ğŸ’¡ AI æ€éº¼åšæ±ºç­–çš„ï¼Ÿ</h2>
  <div class="steps">
    <div class="step"><span class="step-ico">ğŸ‘¶</span><div class="step-text"><h4>ä¸€é–‹å§‹ä»€éº¼éƒ½ä¸æœƒ</h4><p>å°±åƒå¬°å…’ä¸€æ¨£ï¼Œäº‚çŒœç­”æ¡ˆ</p></div></div>
    <div class="step"><span class="step-ico">ğŸ“–</span><div class="step-text"><h4>çœ‹ä¾‹å­å­¸ç¿’</h4><p>çµ¦å®ƒå¾ˆå¤šã€Œé€™æ¨£çš„æƒ…æ³â†’é€™æ¨£æ±ºå®šã€çš„ä¾‹å­</p></div></div>
    <div class="step"><span class="step-ico">ğŸ¯</span><div class="step-text"><h4>ç™¼ç¾è¦å¾‹</h4><p>é€æ¼¸æ‰¾å‡ºã€Œä»€éº¼æƒ…æ³â†’ä»€éº¼æ±ºå®šã€çš„æ¨¡å¼</p></div></div>
    <div class="step"><span class="step-ico">ğŸ“</span><div class="step-text"><h4>å­¸æœƒé æ¸¬</h4><p>é¢å°æ–°æƒ…æ³ä¹Ÿèƒ½åšå‡ºåˆç†åˆ¤æ–·</p></div></div>
  </div>
  <div class="tip-box">
    <p>ğŸ’¡ <strong>å°±åƒäººé¡å­¸ç¿’ï¼š</strong><br>
    â€¢ å°æ™‚å€™ï¼šçˆ¶æ¯æ•™ã€Œç´…ç‡ˆåœã€ç¶ ç‡ˆè¡Œã€<br>
    â€¢ æˆé•·å¾Œï¼šçœ‹åˆ°é»ƒç‡ˆä¹ŸçŸ¥é“è¦æ¸›é€Ÿ<br>
    â€¢ AI ä¹Ÿä¸€æ¨£ï¼šå¾ä¾‹å­ä¸­å­¸æœƒèˆ‰ä¸€åä¸‰ï¼ğŸš€</p>
  </div>
</div>

<script>
// ============ ç¥ç¶“ç¶²è·¯ ============
class NN {
  constructor(lr=0.5){
    this.lr=lr;
    this.w1=this.rm(2,4); this.w2=this.rm(4,1);
    this.b1=this.ra(4);   this.b2=this.ra(1);
    this.H=[0,0,0,0]; this.O=[0];
  }
  rm(r,c){return Array(r).fill(0).map(()=>Array(c).fill(0).map(()=>Math.random()*2-1))}
  ra(n){return Array(n).fill(0).map(()=>Math.random()*2-1)}
  sig(x){return 1/(1+Math.exp(-x))}
  sd(x){return x*(1-x)}
  forward(inp){
    this.H=this.b1.map((b,i)=>this.sig(inp.reduce((s,v,j)=>s+v*this.w1[j][i],b)));
    this.O=this.b2.map((b,i)=>this.sig(this.H.reduce((s,v,j)=>s+v*this.w2[j][i],b)));
    return this.O;
  }
  train(inp,tgt){
    const o=this.forward(inp);
    const oe=o.map((v,i)=>tgt[i]-v);
    const od=o.map((v,i)=>oe[i]*this.sd(v));
    const he=this.H.map((_,i)=>od.reduce((s,d,j)=>s+d*this.w2[i][j],0));
    const hd=this.H.map((h,i)=>he[i]*this.sd(h));
    this.w2.forEach((r,i)=>r.forEach((_,j)=>{this.w2[i][j]+=this.lr*od[j]*this.H[i]}));
    this.w1.forEach((r,i)=>r.forEach((_,j)=>{this.w1[i][j]+=this.lr*hd[j]*inp[i]}));
    this.b2=this.b2.map((b,i)=>b+this.lr*od[i]);
    this.b1=this.b1.map((b,i)=>b+this.lr*hd[i]);
    return Math.abs(oe[0]);
  }
  predict(inp){return this.forward(inp)[0]}
}

// ============ å ´æ™¯ ============
const SCENES=[
  {id:'restaurant',emoji:'ğŸ½ï¸',name:'é¸é¤å»³',
   desc:'æ ¹æ“šã€Œåƒ¹æ ¼ä¾¿å®œã€å’Œã€Œé›¢å®¶è¿‘ã€æ±ºå®šè¦ä¸è¦å»é€™å®¶é¤å»³',
   lblA:'ğŸ’° ä¾¿å®œå—',lblB:'ğŸ  é›¢å®¶è¿‘',out:'ğŸ‘ å»é€™å®¶',
   data:[{a:0,b:0,y:0,  lbl:'âŒ åˆè²´åˆé  â†’ ä¸å»ï¼'},
         {a:0,b:1,y:0.3,lbl:'ğŸ’¸ è²´ä½†è¿‘ â†’ å¶çˆ¾å§'},
         {a:1,b:0,y:0.3,lbl:'ğŸš— ä¾¿å®œä½†é  â†’ æ‡¶å¾—è·‘'},
         {a:1,b:1,y:1,  lbl:'âœ… åˆä¾¿å®œåˆè¿‘ â†’ å¤©å¤©å»ï¼'}]},
  {id:'outfit',emoji:'ğŸ‘•',name:'ç©¿çŸ­è¢–',
   desc:'æ ¹æ“šã€Œå¤©æ°£ç†±ã€å’Œã€Œè¦é‹å‹•ã€æ±ºå®šä»Šå¤©ç©¿ä¸ç©¿çŸ­è¢–',
   lblA:'ğŸŒ¡ï¸ å¤©æ°£ç†±',lblB:'ğŸƒ è¦é‹å‹•',out:'ğŸ‘” ç©¿çŸ­è¢–',
   data:[{a:0,b:0,y:0,  lbl:'â„ï¸ å†·+ä¸é‹å‹• â†’ ç©¿é•·è¢–ä¿æš–'},
         {a:0,b:1,y:0.6,lbl:'ğŸ‹ï¸ å†·ä½†é‹å‹• â†’ å¯ç©¿çŸ­è¢–'},
         {a:1,b:0,y:0.7,lbl:'â˜€ï¸ ç†±ä½†ä¸å‹• â†’ å¯ç©¿çŸ­è¢–'},
         {a:1,b:1,y:1,  lbl:'ğŸ”¥ åˆç†±åˆé‹å‹• â†’ ä¸€å®šçŸ­è¢–ï¼'}]},
  {id:'coffee',emoji:'â˜•',name:'å–å’–å•¡',
   desc:'æ ¹æ“šã€Œå¾ˆç´¯ã€å’Œã€Œç¾åœ¨æ˜¯æ™šä¸Šã€æ±ºå®šè¦ä¸è¦å–å’–å•¡',
   lblA:'ğŸ˜´ å¾ˆç´¯',lblB:'ğŸŒ™ æ™šä¸Šäº†',out:'â˜• å–å’–å•¡',
   data:[{a:0,b:0,y:0,  lbl:'ğŸ˜Š ä¸ç´¯+ç™½å¤© â†’ ä¸ç”¨å–'},
         {a:0,b:1,y:0,  lbl:'ğŸŒƒ ä¸ç´¯+æ™šä¸Š â†’ å–äº†ç¡ä¸è‘—'},
         {a:1,b:0,y:1,  lbl:'ğŸ’ª ç´¯+ç™½å¤© â†’ ä¾†ä¸€æ¯ï¼'},
         {a:1,b:1,y:0.2,lbl:'ğŸ˜° ç´¯+æ™šä¸Š â†’ å¿ä½åˆ¥å–'}]},
  {id:'movie',emoji:'ğŸ¬',name:'çœ‹é›»å½±',
   desc:'æ ¹æ“šã€Œè©•åˆ†é«˜ã€å’Œã€Œæœ‹å‹æ¨è–¦ã€æ±ºå®šè¦ä¸è¦å»çœ‹é›»å½±',
   lblA:'â­ è©•åˆ†é«˜',lblB:'ğŸ‘¥ æœ‹å‹æ¨',out:'ğŸŸï¸ å»çœ‹ï¼',
   data:[{a:0,b:0,y:0,  lbl:'ğŸ’© çˆ›ç‰‡æ²’äººæ¨ â†’ ä¸çœ‹'},
         {a:0,b:1,y:0.4,lbl:'ğŸ¤” çˆ›ç‰‡ä½†æœ‹å‹æ¨ â†’ è€ƒæ…®'},
         {a:1,b:0,y:0.6,lbl:'ğŸ­ å¥½ç‰‡æ²’äººæ â†’ å¯ä»¥çœ‹'},
         {a:1,b:1,y:1,  lbl:'ğŸŒŸ å¥½ç‰‡åˆæ¨è–¦ â†’ å¿…çœ‹ï¼'}]}
];

// ============ ç‹€æ…‹ ============
let nn=new NN(), sceneIdx=0, epoch=0, autoTimer=null, isAuto=false;
const cvs=document.getElementById('nn-canvas');
const cx=cvs.getContext('2d');

// ============ ç•«å¸ƒ ============
function resizeCanvas(){
  cvs.width=cvs.parentElement.clientWidth-28;
  cvs.height=Math.max(260,Math.round(cvs.width*0.52));
  redraw();
}

function redraw(){
  const a=+document.getElementById('sl-a').value/100;
  const b=+document.getElementById('sl-b').value/100;
  nn.forward([a,b]);
  drawNN([a,b],nn.H,nn.O);
}

function drawNN(inp,hid,out){
  const W=cvs.width, H=cvs.height;
  cx.clearRect(0,0,W,H);
  cx.fillStyle='#1a1a2e';
  cx.fillRect(0,0,W,H);

  const s=SCENES[sceneIdx];
  const layerX=[W*.1,W*.37,W*.63,W*.9];
  const sizes=[2,4,4,1];
  const clrs=['#43e97b','#4facfe','#f093fb','#f9ca24'];
  const vals=[inp,hid.slice(0,4),hid.slice(0,4),out];
  const topPad=H*.18, botPad=H*.16;
  const usable=H-topPad-botPad;

  function ny(li,ni){
    const n=sizes[li];
    const gap=usable/n;
    return topPad+gap*ni+gap/2;
  }

  const R=Math.max(8,Math.min(16,W*.028));
  const fs=Math.max(8,Math.min(11,W*.022));

  // é€£ç·š
  for(let li=0;li<3;li++){
    for(let i=0;i<sizes[li];i++){
      for(let j=0;j<sizes[li+1];j++){
        const v=vals[li][i]||0;
        cx.beginPath();
        cx.moveTo(layerX[li],ny(li,i));
        cx.lineTo(layerX[li+1],ny(li+1,j));
        cx.strokeStyle=`rgba(67,233,123,${.07+v*.4})`;
        cx.lineWidth=.5+v*1.8;
        cx.stroke();
      }
    }
  }

  // ç¯€é»
  for(let li=0;li<4;li++){
    for(let ni=0;ni<sizes[li];ni++){
      const x=layerX[li], y=ny(li,ni);
      const v=vals[li][ni]||0;
      const r=R+v*3;
      const g=cx.createRadialGradient(x,y,0,x,y,r);
      g.addColorStop(0,'white');
      g.addColorStop(.5,clrs[li]);
      g.addColorStop(1,'transparent');
      cx.beginPath(); cx.arc(x,y,r,0,Math.PI*2);
      cx.fillStyle=g;
      if(v>.5){cx.shadowBlur=12;cx.shadowColor=clrs[li]}
      cx.fill(); cx.shadowBlur=0;
      cx.strokeStyle=clrs[li]; cx.lineWidth=1.5; cx.stroke();
    }
  }

  // å±¤æ¨™ç±¤
  const layerNames=['è¼¸å…¥å±¤','éš±è—å±¤1','éš±è—å±¤2','è¼¸å‡ºå±¤'];
  cx.textAlign='center';
  layerNames.forEach((nm,li)=>{
    cx.font=`bold ${fs}px Arial`;
    cx.fillStyle=clrs[li];
    cx.fillText(nm,layerX[li],H*.09);
  });

  // ç¯€é»æ¨™ç±¤
  const nodeLabels=[[s.lblA,s.lblB],[],[],[s.out]];
  cx.font=`${fs-1}px Arial`;
  const maxW=Math.floor((layerX[1]-layerX[0])*.85);
  for(let li=0;li<4;li++){
    for(let ni=0;ni<sizes[li];ni++){
      const lbl=nodeLabels[li][ni];
      if(!lbl) continue;
      const x=layerX[li], y=ny(li,ni);
      const v=vals[li][ni]||0;
      const r=R+v*3;
      let txt=lbl.replace(/[\u{1F000}-\u{1FFFF}]/gu,'').replace(/^\s+/,'');
      cx.font=`${fs-1}px Arial`;
      while(cx.measureText(txt).width>maxW && txt.length>2) txt=txt.slice(0,-1);
      cx.fillStyle='rgba(255,255,255,.85)';
      cx.fillText(txt.trim(), x, y+r+fs+2);
    }
  }
}

// ============ å ´æ™¯ ============
function loadScene(idx){
  sceneIdx=idx;
  const s=SCENES[idx];
  document.querySelectorAll('.sbtn').forEach((b,i)=>b.classList.toggle('active',i===idx));
  document.getElementById('scene-title').textContent=s.emoji+' '+s.name+' â€” å­¸ç¿’æ¡ˆä¾‹';
  document.getElementById('scene-desc').textContent=s.desc;
  document.getElementById('lbl-a').textContent=s.lblA;
  document.getElementById('lbl-b').textContent=s.lblB;
  document.getElementById('train-list').innerHTML=s.data.map(d=>`
    <div class="train-row">
      <div class="top">
        <span class="io">${s.lblA.slice(0,2)}=${d.a?'æ˜¯':'å¦'}</span>
        <span class="io">${s.lblB.slice(0,2)}=${d.b?'æ˜¯':'å¦'}</span>
        <span class="arrow">â†’</span>
        <span class="io out">${(d.y*100).toFixed(0)}%</span>
      </div>
      <div class="lbl">${d.lbl}</div>
    </div>`).join('');
  document.getElementById('result-box').classList.remove('show');
  resetNN();
}

function buildBtns(){
  document.getElementById('scenes').innerHTML=SCENES.map((s,i)=>`
    <button class="sbtn ${i===0?'active':''}" onclick="loadScene(${i})">
      <span class="emo">${s.emoji}</span>${s.name}
    </button>`).join('');
}

// ============ è¨“ç·´ ============
function getData(){return SCENES[sceneIdx].data.map(d=>({inp:[d.a,d.b],tgt:[d.y]}))}

function updateStats(err){
  epoch++;
  document.getElementById('epoch-val').textContent=epoch;
  document.getElementById('acc-val').textContent=Math.max(0,(1-err)*100).toFixed(1)+'%';
}

function trainOnce(){
  const data=getData(); let err=0;
  data.forEach(d=>{err+=nn.train(d.inp,d.tgt)});
  updateStats(err/data.length);
  redraw();
}

function toggleAuto(){
  isAuto=!isAuto;
  const btn=document.getElementById('auto-btn');
  if(isAuto){
    btn.textContent='â¹ åœæ­¢';
    btn.classList.add('pulsing');
    autoTimer=setInterval(()=>{
      const data=getData(); let err=0;
      data.forEach(d=>{err+=nn.train(d.inp,d.tgt)});
      updateStats(err/data.length);
      redraw();
      if((1-err/data.length)*100>=95) toggleAuto();
    },25);
  } else {
    clearInterval(autoTimer);
    btn.textContent='ğŸš€ å¿«é€Ÿè¨“ç·´';
    btn.classList.remove('pulsing');
  }
}

function resetNN(){
  if(isAuto) toggleAuto();
  nn=new NN(); epoch=0;
  document.getElementById('epoch-val').textContent='0';
  document.getElementById('acc-val').textContent='0%';
  document.getElementById('result-box').classList.remove('show');
  redraw();
}

// ============ é æ¸¬ ============
function getAdvice(v){
  if(v<.2) return{bg:'#fff0f0',bc:'#ffb3b3',emo:'âŒ',text:'ä¸å»ºè­°',col:'#e53935',msg:'é€™å€‹æƒ…æ³ AI è¦ºå¾—ä¸å¤ªé©åˆï¼Œæ›å€‹æ¢ä»¶è©¦è©¦çœ‹ï¼Ÿ'};
  if(v<.4) return{bg:'#fff3e0',bc:'#ffcc80',emo:'ğŸ¤”',text:'ä¸å¤ªå»ºè­°',col:'#f57c00',msg:'æ¢ä»¶ä¸å¤ªå¤ ï¼Œå¯ä»¥å†æƒ³æƒ³çœ‹æ˜¯å¦å€¼å¾—'};
  if(v<.6) return{bg:'#fffde7',bc:'#fff176',emo:'ğŸ˜',text:'å¯ä»¥è€ƒæ…®',col:'#f9a825',msg:'æœ‰ä¸€å®šå¯èƒ½æ€§ï¼Œè¦–å€‹äººæƒ…æ³è€Œå®š'};
  if(v<.8) return{bg:'#f1f8e9',bc:'#aed581',emo:'ğŸ‘',text:'å»ºè­°å»ï¼',col:'#558b2f',msg:'æ¢ä»¶ä¸éŒ¯ï¼ŒAI è¦ºå¾—å€¼å¾—ä¸€è©¦ï¼'};
  return{bg:'#e8f5e9',bc:'#81c784',emo:'ğŸ’¯',text:'å¼·çƒˆæ¨è–¦ï¼',col:'#1b5e20',msg:'å®Œç¾æ¢ä»¶ï¼AI å¼·åŠ›å»ºè­°ï¼Œé¦¬ä¸Šè¡Œå‹•å§ï¼ğŸ‰'};
}

function predict(){
  const a=+document.getElementById('sl-a').value/100;
  const b=+document.getElementById('sl-b').value/100;
  const v=nn.predict([a,b]);
  const adv=getAdvice(v);
  const box=document.getElementById('result-box');
  box.style.background=adv.bg;
  box.style.borderColor=adv.bc;
  document.getElementById('r-emo').textContent=adv.emo;
  document.getElementById('r-text').style.color=adv.col;
  document.getElementById('r-text').textContent=adv.text;
  document.getElementById('r-pct').style.color=adv.col;
  document.getElementById('r-pct').textContent='ä¿¡å¿ƒåº¦ï¼š'+(v*100).toFixed(0)+'%';
  document.getElementById('r-advice').textContent='ğŸ’¬ '+adv.msg;
  box.classList.add('show');
  redraw();
}

// ============ æ»‘æ¡¿ ============
['a','b'].forEach(k=>{
  document.getElementById('sl-'+k).addEventListener('input',function(){
    document.getElementById('pct-'+k).textContent=this.value+'%';
    redraw();
  });
});

// ============ åˆå§‹åŒ– ============
window.addEventListener('load',()=>{ buildBtns(); loadScene(0); resizeCanvas(); });
window.addEventListener('resize',()=>{ resizeCanvas(); });
</script>
</body>
</html>