<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ç¤ºæ³¢å™¨ - éŸ³è¨Šåˆ†æå·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            color: #00ff88;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* å·¦å´èŠå¤©å€åŸŸ */
        .chat-panel {
            width: 35%;
            background: rgba(0, 0, 0, 0.8);
            border-right: 2px solid #00ff88;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(10px);
        }

        .chat-header {
            padding: 20px;
            background: linear-gradient(90deg, #00ff88, #00cc70);
            color: #000;
            font-weight: bold;
            font-size: 18px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 255, 136, 0.3);
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 85%;
            word-wrap: break-word;
            animation: fadeIn 0.3s ease;
        }

        .user-message {
            background: linear-gradient(135deg, #00ff88, #00cc70);
            color: #000;
            align-self: flex-end;
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.3);
        }

        .ai-message {
            background: rgba(255, 255, 255, 0.1);
            color: #00ff88;
            align-self: flex-start;
            border: 1px solid rgba(0, 255, 136, 0.3);
            backdrop-filter: blur(5px);
        }

        .chat-input {
            padding: 20px;
            background: rgba(0, 0, 0, 0.9);
            border-top: 1px solid #00ff88;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        .input-group input {
            flex: 1;
            padding: 12px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #00ff88;
            border-radius: 8px;
            color: #00ff88;
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            border-color: #00cc70;
        }

        .input-group button {
            padding: 12px 20px;
            background: linear-gradient(135deg, #00ff88, #00cc70);
            color: #000;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .input-group button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 255, 136, 0.4);
        }

        /* å³å´è¦–è¦ºåŒ–å€åŸŸ */
        .visualization-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            background: radial-gradient(circle at center, rgba(0, 255, 136, 0.05) 0%, transparent 70%);
        }

        .viz-header {
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #00ff88;
        }

        .viz-title {
            font-size: 20px;
            font-weight: bold;
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .control-button {
            padding: 8px 16px;
            background: rgba(0, 255, 136, 0.2);
            border: 1px solid #00ff88;
            border-radius: 6px;
            color: #00ff88;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .control-button:hover {
            background: rgba(0, 255, 136, 0.3);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
        }

        .control-button.active {
            background: #00ff88;
            color: #000;
        }

        .control-button.start {
            background: #f60606;
            color: #f4f2f2;
        }

        .canvas-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        canvas {
            width: 100%;
            height: 100%;
            background: transparent;
        }

        /* å‹•ç•«æ•ˆæœ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .recording {
            animation: pulse 1s infinite;
        }

        /* è‡ªè¨‚æ»¾å‹•æ¢ */
        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #00ff88;
            border-radius: 4px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #00cc70;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .chat-panel {
                width: 100%;
                height: 50%;
            }
            
            .visualization-panel {
                height: 50%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å·¦å´èŠå¤©å€åŸŸ -->
        <div class="chat-panel">
            <div class="chat-header">
                ğŸ¤– AI ç¤ºæ³¢å™¨åŠ©æ‰‹
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <div class="message ai-message">
                    ğŸ‘‹ ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ AI ç¤ºæ³¢å™¨åŠ©æ‰‹ã€‚æˆ‘å¯ä»¥å¹«ä½ ï¼š
                    <br>â€¢ åˆ†æéŸ³è¨Šæ³¢å½¢ç‰¹æ€§
                    <br>â€¢ èª¿æ•´é¡¯ç¤ºåƒæ•¸
                    <br>â€¢ è§£é‡‹é »è­œåˆ†æçµæœ
                    <br>â€¢ æä¾›éŸ³è¨Šè™•ç†å»ºè­°
                    <br><br>è«‹å…è¨±éº¥å…‹é¢¨æ¬Šé™é–‹å§‹åˆ†æï¼Œæˆ–å•æˆ‘ä»»ä½•å•é¡Œï¼
                </div>
            </div>
            
            <div class="chat-input">
                <div class="input-group">
                    <input type="text" id="messageInput" placeholder="è¼¸å…¥ä½ çš„å•é¡Œ...">
                    <button onclick="sendMessage()">ç™¼é€</button>
                </div>
            </div>
        </div>

        <!-- å³å´è¦–è¦ºåŒ–å€åŸŸ -->
        <div class="visualization-panel">
            <div class="viz-header">
                <div class="viz-title">ğŸŒŠ å³æ™‚éŸ³è¨Šåˆ†æ</div>
                <div class="controls">
                    <button class="control-button active" id="timeDomainBtn" onclick="setMode('time')">æ™‚åŸŸ</button>
                    <button class="control-button" id="frequencyBtn" onclick="setMode('frequency')">é »åŸŸ</button>
                    <button class="control-button" id="xyBtn" onclick="setMode('xy')">XYæ¨¡å¼</button>
                    <button class="control-button start" id="recordBtn" onclick="toggleRecording()">ğŸ¤ é–‹å§‹</button>
                </div>
            </div>
            
            <div class="canvas-container">
                <canvas id="oscilloscope"></canvas>
            </div>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let audioContext;
        let analyser;
        let microphone;
        let dataArray;
        let canvas;
        let ctx;
        let animationId;
        let isRecording = false;
        let currentMode = 'time'; // 'time', 'frequency', 'xy'
        let bufferLength;

        // AI å›æ‡‰åº«
        const aiResponses = {
            greeting: ['ä½ å¥½ï¼æœ‰ä»€éº¼æˆ‘å¯ä»¥å¹«åŠ©ä½ åˆ†æçš„å—ï¼Ÿ', 'å—¨ï¼æº–å‚™é–‹å§‹éŸ³è¨Šåˆ†æäº†å—ï¼Ÿ'],
            frequency: [
                'é »åŸŸåˆ†æå¯ä»¥é¡¯ç¤ºéŸ³è¨Šä¸­å„å€‹é »ç‡æˆåˆ†çš„å¼·åº¦ã€‚ä½é »åœ¨å·¦å´ï¼Œé«˜é »åœ¨å³å´ã€‚',
                'é€é FFT è½‰æ›ï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ°éŸ³è¨Šçš„é »è­œåˆ†å¸ƒã€‚å³°å€¼è¡¨ç¤ºä¸»è¦çš„é »ç‡æˆåˆ†ã€‚',
                'é »è­œåˆ†ææœ‰åŠ©æ–¼è­˜åˆ¥éŸ³èª¿ã€è«§æ³¢å’Œå™ªéŸ³ç‰¹å¾µã€‚'
            ],
            time: [
                'æ™‚åŸŸé¡¯ç¤ºéŸ³è¨Šä¿¡è™Ÿéš¨æ™‚é–“çš„è®ŠåŒ–ã€‚æŒ¯å¹…åæ˜ éŸ³é‡å¤§å°ã€‚',
                'æ³¢å½¢çš„å½¢ç‹€å‘Šè¨´æˆ‘å€‘éŸ³è¨Šçš„ç‰¹æ€§ï¼šæ­£å¼¦æ³¢è¡¨ç¤ºç´”éŸ³èª¿ï¼Œè¤‡é›œæ³¢å½¢è¡¨ç¤ºè±å¯Œçš„è«§æ³¢å…§å®¹ã€‚',
                'è§€å¯Ÿæ³¢å½¢å¯ä»¥å¹«åŠ©è­˜åˆ¥éŸ³è¨Šçš„å‹•æ…‹ç¯„åœå’Œå¤±çœŸæƒ…æ³ã€‚'
            ],
            xy: [
                'XY æ¨¡å¼å‰µé€ ç¾éº—çš„æè–©èŒ¹åœ–å½¢ï¼Œé¡¯ç¤ºå·¦å³è²é“çš„ç›¸ä½é—œä¿‚ã€‚',
                'åœ“å½¢åœ–æ¡ˆè¡¨ç¤ºå–®è²é“ä¿¡è™Ÿï¼Œè¤‡é›œåœ–å½¢è¡¨ç¤ºç«‹é«”è²æ•ˆæœã€‚',
                'XY æ¨¡å¼å¸¸ç”¨æ–¼åˆ†æç«‹é«”è²çš„å¯¬åº¦å’Œç›¸ä½ä¸€è‡´æ€§ã€‚'
            ],
            analysis: [
                'æˆ‘æ³¨æ„åˆ°ä½ çš„éŸ³è¨Šæœ‰æœ‰è¶£çš„ç‰¹å¾µï¼éœ€è¦æˆ‘è©³ç´°åˆ†æå—ï¼Ÿ',
                'é€™å€‹æ³¢å½¢é¡¯ç¤ºäº†è±å¯Œçš„é »ç‡å…§å®¹ã€‚ä½ æƒ³äº†è§£ç‰¹å®šçš„é »æ®µå—ï¼Ÿ',
                'éŸ³è¨Šä¿¡è™Ÿçœ‹èµ·ä¾†å¾ˆç©©å®šã€‚æœ‰ç‰¹å®šçš„åˆ†æéœ€æ±‚å—ï¼Ÿ'
            ]
        };

        // åˆå§‹åŒ–
        function init() {
            canvas = document.getElementById('oscilloscope');
            ctx = canvas.getContext('2d');
            
            // è¨­ç½® canvas å°ºå¯¸
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // éµç›¤äº‹ä»¶
            document.getElementById('messageInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // é–‹å§‹ç¹ªè£½èƒŒæ™¯å‹•ç•«
            drawBackground();
        }

        function resizeCanvas() {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * window.devicePixelRatio;
            canvas.height = rect.height * window.devicePixelRatio;
            ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
            canvas.style.width = rect.width + 'px';
            canvas.style.height = rect.height + 'px';
        }

        // éŸ³è¨Šè¨­ç½®
        async function setupAudio() {
            try {
                // æª¢æŸ¥ç€è¦½å™¨æ”¯æ´
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    addMessage('ai', 'âŒ ä½ çš„ç€è¦½å™¨ä¸æ”¯æ´éŸ³è¨ŠéŒ„è£½åŠŸèƒ½ã€‚è«‹ä½¿ç”¨è¼ƒæ–°ç‰ˆæœ¬çš„ Chromeã€Firefox æˆ– Safariã€‚');
                    return false;
                }

                // è«‹æ±‚éº¥å…‹é¢¨æ¬Šé™
                addMessage('ai', 'ğŸ¤ æ­£åœ¨è«‹æ±‚éº¥å…‹é¢¨æ¬Šé™ï¼Œè«‹é»æ“Šã€Œå…è¨±ã€...');
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        sampleRate: 44100
                    } 
                });
                
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // æª¢æŸ¥ AudioContext ç‹€æ…‹
                if (audioContext.state === 'suspended') {
                    await audioContext.resume();
                }
                
                analyser = audioContext.createAnalyser();
                microphone = audioContext.createMediaStreamSource(stream);
                
                analyser.fftSize = 2048;
                analyser.smoothingTimeConstant = 0.8;
                bufferLength = analyser.frequencyBinCount;
                dataArray = new Uint8Array(bufferLength);
                
                microphone.connect(analyser);
                
                addMessage('ai', 'âœ… éº¥å…‹é¢¨é€£æ¥æˆåŠŸï¼ç¾åœ¨å¯ä»¥çœ‹åˆ°ä½ çš„è²éŸ³æ³¢å½¢äº†ã€‚è©¦è‘—èªªè©±æˆ–æ’­æ”¾éŸ³æ¨‚å§ï¼');
                return true;
                
            } catch (err) {
                console.error('éŸ³è¨Šè¨­ç½®éŒ¯èª¤:', err);
                
                let errorMessage = 'âŒ ';
                
                switch(err.name) {
                    case 'NotAllowedError':
                        errorMessage += 'éº¥å…‹é¢¨æ¬Šé™è¢«æ‹’çµ•ã€‚è§£æ±ºæ–¹æ³•ï¼š\n';
                        errorMessage += 'â€¢ é»æ“Šåœ°å€æ¬„å·¦å´çš„ğŸ”’åœ–æ¨™\n';
                        errorMessage += 'â€¢ å°‡éº¥å…‹é¢¨è¨­ç‚ºã€Œå…è¨±ã€\n';
                        errorMessage += 'â€¢ é‡æ–°æ•´ç†é é¢å†è©¦ä¸€æ¬¡\n';
                        errorMessage += 'â€¢ æˆ–ä½¿ç”¨ Chrome/Firefox/Safari æœ€æ–°ç‰ˆæœ¬';
                        break;
                    case 'NotFoundError':
                        errorMessage += 'æ‰¾ä¸åˆ°éº¥å…‹é¢¨è¨­å‚™ã€‚è«‹ç¢ºä¿ï¼š\n';
                        errorMessage += 'â€¢ éº¥å…‹é¢¨å·²æ­£ç¢ºé€£æ¥\n';
                        errorMessage += 'â€¢ ç³»çµ±éŸ³è¨Šé©…å‹•ç¨‹å¼æ­£å¸¸\n';
                        errorMessage += 'â€¢ å˜—è©¦é‡æ–°æ’æ‹”éº¥å…‹é¢¨';
                        break;
                    case 'NotReadableError':
                        errorMessage += 'éº¥å…‹é¢¨è¢«å…¶ä»–æ‡‰ç”¨ç¨‹å¼å ç”¨ã€‚è«‹ï¼š\n';
                        errorMessage += 'â€¢ é—œé–‰å…¶ä»–ä½¿ç”¨éº¥å…‹é¢¨çš„ç¨‹å¼\n';
                        errorMessage += 'â€¢ é‡æ–°å•Ÿå‹•ç€è¦½å™¨';
                        break;
                    case 'OverconstrainedError':
                        errorMessage += 'éº¥å…‹é¢¨ä¸æ”¯æ´è¦æ±‚çš„è¨­å®šã€‚å˜—è©¦ä½¿ç”¨é è¨­è¨­å®š...';
                        // å˜—è©¦åŸºæœ¬è¨­å®š
                        return await setupBasicAudio();
                    default:
                        errorMessage += `éŸ³è¨Šè¨­ç½®å¤±æ•— (${err.name})ã€‚\n`;
                        errorMessage += 'è«‹ç¢ºä¿ç€è¦½å™¨æ”¯æ´éŸ³è¨ŠéŒ„è£½åŠŸèƒ½ã€‚';
                }
                
                addMessage('ai', errorMessage);
                
                // é¡¯ç¤ºç¤ºç¯„æ¨¡å¼é¸é …
                setTimeout(() => {
                    addMessage('ai', 'ğŸ’¡ ä½ ä¹Ÿå¯ä»¥è©¦è©¦ã€Œç¤ºç¯„æ¨¡å¼ã€ï¼Œæˆ‘æœƒç”Ÿæˆæ¨¡æ“¬éŸ³è¨Šä¿¡è™Ÿä¾†å±•ç¤ºå„ç¨®æ³¢å½¢ï¼');
                    showDemoOption();
                }, 2000);
                
                return false;
            }
        }

        // åŸºæœ¬éŸ³è¨Šè¨­ç½®ï¼ˆå‚™ç”¨æ–¹æ¡ˆï¼‰
        async function setupBasicAudio() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                microphone = audioContext.createMediaStreamSource(stream);
                
                analyser.fftSize = 1024; // é™ä½ FFT å¤§å°
                bufferLength = analyser.frequencyBinCount;
                dataArray = new Uint8Array(bufferLength);
                
                microphone.connect(analyser);
                
                addMessage('ai', 'âœ… éº¥å…‹é¢¨é€£æ¥æˆåŠŸï¼ˆåŸºæœ¬æ¨¡å¼ï¼‰ï¼');
                return true;
            } catch (err) {
                return false;
            }
        }

        // éŒ„è£½æ§åˆ¶
        async function toggleRecording() {
            const btn = document.getElementById('recordBtn');
            
            if (!isRecording) {
                const success = await setupAudio();
                if (success) {
                    isRecording = true;
                    btn.textContent = 'â¸ï¸ åœæ­¢';
                    btn.classList.add('recording');
                    startVisualization();
                    addMessage('ai', 'ğŸ™ï¸ é–‹å§‹éŒ„è£½ï¼ç¾åœ¨å¯ä»¥çœ‹åˆ°å³æ™‚éŸ³è¨Šåˆ†æäº†ã€‚');
                }
            } else {
                isRecording = false;
                btn.textContent = 'ğŸ¤ é–‹å§‹';
                btn.classList.remove('recording');
                if (animationId) {
                    cancelAnimationFrame(animationId);
                }
                if (audioContext) {
                    audioContext.close();
                }
                drawBackground();
                addMessage('ai', 'â¹ï¸ éŒ„è£½å·²åœæ­¢ã€‚');
            }
        }

        // æ¨¡å¼åˆ‡æ›
        function setMode(mode) {
            currentMode = mode;
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.control-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(mode === 'time' ? 'timeDomainBtn' : 
                                 mode === 'frequency' ? 'frequencyBtn' : 'xyBtn').classList.add('active');
            
            // AI å›æ‡‰
            if (aiResponses[mode]) {
                const response = aiResponses[mode][Math.floor(Math.random() * aiResponses[mode].length)];
                setTimeout(() => addMessage('ai', response), 500);
            }
        }

        // è¦–è¦ºåŒ–
        function startVisualization() {
            draw();
        }

        function draw() {
            if (!isRecording) return;
            
            animationId = requestAnimationFrame(draw);
            
            const rect = canvas.getBoundingClientRect();
            const width = rect.width;
            const height = rect.height;
            
            // æ¸…é™¤ç•«å¸ƒ
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, width, height);
            
            if (currentMode === 'time') {
                drawTimeDomain(width, height);
            } else if (currentMode === 'frequency') {
                drawFrequencyDomain(width, height);
            } else if (currentMode === 'xy') {
                drawXY(width, height);
            }
        }

        function drawTimeDomain(width, height) {
            analyser.getByteTimeDomainData(dataArray);
            
            ctx.strokeStyle = '#00ff88';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            const sliceWidth = width / bufferLength;
            let x = 0;
            
            for (let i = 0; i < bufferLength; i++) {
                const v = dataArray[i] / 128.0;
                const y = v * height / 2;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
                
                x += sliceWidth;
            }
            
            ctx.stroke();
            
            // æ·»åŠ ç¶²æ ¼
            drawGrid(width, height);
        }

        function drawFrequencyDomain(width, height) {
            analyser.getByteFrequencyData(dataArray);
            
            const barWidth = width / bufferLength * 2;
            let x = 0;
            
            // å‰µå»ºæ¼¸è®Š
            const gradient = ctx.createLinearGradient(0, height, 0, 0);
            gradient.addColorStop(0, '#00ff88');
            gradient.addColorStop(0.5, '#00cc70');
            gradient.addColorStop(1, '#ffffff');
            
            for (let i = 0; i < bufferLength / 2; i++) {
                const barHeight = (dataArray[i] / 255) * height;
                
                ctx.fillStyle = gradient;
                ctx.fillRect(x, height - barHeight, barWidth - 1, barHeight);
                
                x += barWidth;
            }
            
            // é »ç‡æ¨™ç±¤
            drawFrequencyLabels(width, height);
        }

        function drawXY(width, height) {
            analyser.getByteTimeDomainData(dataArray);
            
            ctx.strokeStyle = '#00ff88';
            ctx.lineWidth = 1;
            ctx.globalCompositeOperation = 'lighter';
            
            ctx.beginPath();
            
            for (let i = 0; i < bufferLength - 1; i += 2) {
                const x = (dataArray[i] / 255) * width;
                const y = (dataArray[i + 1] / 255) * height;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            
            ctx.stroke();
            ctx.globalCompositeOperation = 'source-over';
        }

        function drawBackground() {
            if (isRecording) return;
            
            const rect = canvas.getBoundingClientRect();
            const width = rect.width;
            const height = rect.height;
            
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            ctx.fillRect(0, 0, width, height);
            
            // ç¹ªè£½å¾…æ©Ÿå‹•ç•«
            const time = Date.now() * 0.002;
            ctx.strokeStyle = 'rgba(0, 255, 136, 0.3)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            for (let x = 0; x < width; x += 5) {
                const y = height / 2 + Math.sin((x + time * 100) * 0.02) * 30;
                if (x === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            
            ctx.stroke();
            
            if (!isRecording) {
                requestAnimationFrame(drawBackground);
            }
        }

        function drawGrid(width, height) {
            ctx.strokeStyle = 'rgba(0, 255, 136, 0.2)';
            ctx.lineWidth = 1;
            
            // æ°´å¹³ç·š
            for (let y = 0; y < height; y += height / 8) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            // å‚ç›´ç·š
            for (let x = 0; x < width; x += width / 10) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }
        }

        function drawFrequencyLabels(width, height) {
            ctx.fillStyle = '#00ff88';
            ctx.font = '12px Microsoft JhengHei';
            
            const labels = ['20Hz', '200Hz', '2kHz', '20kHz'];
            for (let i = 0; i < labels.length; i++) {
                const x = (i / (labels.length - 1)) * width;
                ctx.fillText(labels[i], x, height - 5);
            }
        }

        // èŠå¤©åŠŸèƒ½
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (message) {
                addMessage('user', message);
                input.value = '';
                
                // AI å›æ‡‰
                setTimeout(() => {
                    const response = generateAIResponse(message);
                    addMessage('ai', response);
                }, 1000);
            }
        }

        function addMessage(type, content) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message`;
            messageDiv.innerHTML = content;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function generateAIResponse(message) {
            const msg = message.toLowerCase();
            
            if (msg.includes('é »ç‡') || msg.includes('é »åŸŸ') || msg.includes('fft')) {
                return aiResponses.frequency[Math.floor(Math.random() * aiResponses.frequency.length)];
            } else if (msg.includes('æ™‚åŸŸ') || msg.includes('æ³¢å½¢') || msg.includes('æ™‚é–“')) {
                return aiResponses.time[Math.floor(Math.random() * aiResponses.time.length)];
            } else if (msg.includes('xy') || msg.includes('ç«‹é«”') || msg.includes('ç›¸ä½')) {
                return aiResponses.xy[Math.floor(Math.random() * aiResponses.xy.length)];
            } else if (msg.includes('åˆ†æ') || msg.includes('æ€éº¼')) {
                return aiResponses.analysis[Math.floor(Math.random() * aiResponses.analysis.length)];
            } else if (msg.includes('ä½ å¥½') || msg.includes('å—¨')) {
                return aiResponses.greeting[Math.floor(Math.random() * aiResponses.greeting.length)];
            } else {
                return 'é€™æ˜¯å€‹å¾ˆå¥½çš„å•é¡Œï¼' + (isRecording ? 
                    'æˆ‘å¯ä»¥çœ‹åˆ°ä½ çš„éŸ³è¨Šæ•¸æ“šï¼Œ' + (currentMode === 'time' ? 'æ™‚åŸŸæ³¢å½¢' : 
                    currentMode === 'frequency' ? 'é »è­œåˆ†æ' : 'XYæ¨¡å¼åœ–å½¢') + 'é¡¯ç¤ºäº†æœ‰è¶£çš„ç‰¹å¾µã€‚' :
                    'è«‹å…ˆé–‹å§‹éŒ„è£½ä»¥ä¾¿æˆ‘åˆ†æä½ çš„éŸ³è¨Šã€‚');
            }
        }

        // å•Ÿå‹•æ‡‰ç”¨
        window.addEventListener('load', init);
    </script>
</body>
</html>