<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>64卦時鐘式移動 — 每秒移一格，含暫停按鈕，太極圖轉動</title>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans TC", "Microsoft JhengHei", sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      flex-direction: column;
      gap: 12px;
    }
    canvas {
      background: #fff7e6;
      border-radius: 8px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
      max-width: 100%; /* 防止畫面溢出 */
      max-height: 100vh; /* 適應視窗高度 */
    }
    .info {
      font-size: 14px;
      color: #ddd;
    }
    .controls {
      margin-top: 10px;
    }
    button {
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
      background: #333;
      color: #eee;
      border: none;
      border-radius: 4px;
    }
    button:hover {
      background: #444;
    }
  </style>
</head>
<body>
  <canvas id="bagua" width="900" height="900"></canvas> <!-- 增加 Canvas 大小 -->
  <div class="info">
    <span id="count">已完成格數：0</span> ｜ 方向：<span id="dir">順時針</span>
  </div>
  <div class="controls">
    <button id="toggleBtn">暫停</button>
  </div>

  <script>
    /*
      64卦時鐘式移動
      - 每秒順時針移動一格（5.625°）使用 setInterval
      - 完成 64 格後反轉方向
      - 包含暫停/繼續按鈕
      - 卦名移至最外側，避免被蓋住
      - 中心太極圖每秒轉動一格，反轉時左右對調
    */

    // 取得 canvas 和按鈕
    const canvas = document.getElementById('bagua');
    const ctx = canvas.getContext('2d');
    const W = canvas.width, H = canvas.height;
    const cx = W / 2, cy = H / 2;
    const R = Math.min(W, H) * 0.4; // 64卦圓半徑
    const toggleBtn = document.getElementById('toggleBtn');

    // 控制參數
    let direction = 1; // 1 = 順時針, -1 = 逆時針
    let currentStep = 0; // 當前格數
    let completedSteps = 0; // 完成格數
    let nextFlipAt = 64; // 每 64 格反轉
    const countEl = document.getElementById('count');
    const dirEl = document.getElementById('dir');
    let isPlaying = true; // 動畫播放狀態
    let intervalId = null; // 儲存 setInterval ID

    // 64 卦數據
    const kingWenTable = [
      { short: "坤", bin: "\u4DC1" },
      { short: "復", bin: "\u4DD7" },
      { short: "師", bin: "\u4DC6" },
      { short: "臨", bin: "\u4DD2" },
      { short: "謙", bin: "\u4DCE" },
      { short: "明夷", bin: "\u4DE3" },
      { short: "升", bin: "\u4DED" },
      { short: "泰", bin: "\u4DCA" },
      { short: "豫", bin: "\u4DCF" },
      { short: "雷", bin: "\u4DF2" },
      { short: "解", bin: "\u4DE7" },
      { short: "歸妹", bin: "\u4DF5" },
      { short: "小過", bin: "\u4DFD" },
      { short: "豐", bin: "\u4DF6" },
      { short: "恆", bin: "\u4DDF" },
      { short: "大壯", bin: "\u4DE1" },
      { short: "比", bin: "\u4DC7" },
      { short: "屯", bin: "\u4DC2" },
      { short: "水", bin: "\u4DDC" },
      { short: "節", bin: "\u4DFB" },
      { short: "蹇", bin: "\u4DE6" },
      { short: "既濟", bin: "\u4DFE" },
      { short: "井", bin: "\u4DEF" },
      { short: "需", bin: "\u4DC4" },
      { short: "萃", bin: "\u4DEC" },
      { short: "隨", bin: "\u4DD0" },
      { short: "困", bin: "\u4DEE" },
      { short: "澤", bin: "\u4DF9" },
      { short: "咸", bin: "\u4DDE" },
      { short: "革", bin: "\u4DF0" },
      { short: "大過", bin: "\u4DDB" },
      { short: "夬", bin: "\u4DEA" },
      { short: "剝", bin: "\u4DD6" },
      { short: "頤", bin: "\u4DDA" },
      { short: "蒙", bin: "\u4DC3" },
      { short: "損", bin: "\u4DE8" },
      { short: "山", bin: "\u4DF3" },
      { short: "賁", bin: "\u4DD5" },
      { short: "蠱", bin: "\u4DD1" },
      { short: "大畜", bin: "\u4DD9" },
      { short: "晉", bin: "\u4DE2" },
      { short: "噬嗑", bin: "\u4DD4" },
      { short: "未濟", bin: "\u4DFF" },
      { short: "睽", bin: "\u4DE5" },
      { short: "旅", bin: "\u4DF7" },
      { short: "火", bin: "\u4DDD" },
      { short: "鼎", bin: "\u4DF1" },
      { short: "大有", bin: "\u4DCD" },
      { short: "觀", bin: "\u4DD3" },
      { short: "益", bin: "\u4DE9" },
      { short: "渙", bin: "\u4DFA" },
      { short: "中孚", bin: "\u4DFC" },
      { short: "漸", bin: "\u4DF4" },
      { short: "家人", bin: "\u4DE4" },
      { short: "風", bin: "\u4DF8" },
      { short: "小畜", bin: "\u4DC8" },
      { short: "否", bin: "\u4DCB" },
      { short: "無妄", bin: "\u4DD8" },
      { short: "訟", bin: "\u4DC5" },
      { short: "履", bin: "\u4DC9" },
      { short: "遯", bin: "\u4DE0" },
      { short: "同人", bin: "\u4DCC" },
      { short: "姤", bin: "\u4DEB" },
      { short: "乾", bin: "\u4DC0" }
    ];

    // 天干地支
    const heavenlyStems = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
    const earthlyBranches = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
    const stemsBranches = [];
    for (let i = 0; i < 12; i++) {
      stemsBranches.push(heavenlyStems[i % 10] + earthlyBranches[i]);
    }

    // 繪製函數
    function draw() {
      ctx.clearRect(0, 0, W, H);

      ctx.save();
      ctx.translate(cx, cy);

      // 畫64卦圓（靜止）
      ctx.beginPath();
      ctx.lineWidth = 5;
      ctx.strokeStyle = '#222';
      ctx.arc(0, 0, R, 0, Math.PI * 2);
      ctx.stroke();

      // 繪製64卦，根據 currentStep 偏移
      const angleStep = (2 * Math.PI) / 64;
      for (let i = 0; i < 64; i++) {
        const adjustedIndex = (i - currentStep + 64) % 64; // 模擬時鐘移動
        const angle = -Math.PI / 2 + adjustedIndex * angleStep;

        // 繪製 Unicode 卦象（內側）
        const txBin = Math.cos(angle) * (R + 40);
        const tyBin = Math.sin(angle) * (R + 40);
        ctx.font = '20px "Noto Sans CJK TC", "Microsoft JhengHei", sans-serif';
        ctx.fillStyle = '#111';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(kingWenTable[i].bin, txBin, tyBin);

        // 繪製卦名（最外側，避免被蓋住）
        const txShort = Math.cos(angle) * (R + 80);
        const tyShort = Math.sin(angle) * (R + 80);
        ctx.font = '14px "Microsoft JhengHei", sans-serif';
        ctx.fillStyle = '#888';
        ctx.fillText(kingWenTable[i].short, txShort, tyShort);
      }

      // 繪製天干地支（靜止）
      const branchStep = 2 * Math.PI / 12;
      for (let i = 0; i < 12; i++) {
        const angle = i * branchStep;
        const tx = Math.cos(angle) * (R + 120); // 移到更外側，避免與卦名重疊
        const ty = Math.sin(angle) * (R + 120);
        ctx.font = '12px "Microsoft JhengHei", sans-serif';
        ctx.fillStyle = '#666';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(stemsBranches[i], tx, ty);
      }

      ctx.restore();

      // 邊框圈（靜止）
      ctx.beginPath();
      ctx.lineWidth = 3;
      ctx.strokeStyle = '#444';
      ctx.arc(cx, cy, R * 1.05, 0, Math.PI * 2);
      ctx.stroke();
    }

    // 動畫更新
    function update() {
      if (isPlaying) {
        currentStep += direction;
        currentStep = (currentStep % 64 + 64) % 64; // 保持在 0-63 範圍
        completedSteps += direction;
        if (Math.abs(completedSteps) >= nextFlipAt) {
          direction *= -1;
          nextFlipAt += 64;
          dirEl.textContent = direction === 1 ? '順時針' : '逆時針';
        }
        countEl.textContent = '已完成格數：' + Math.abs(completedSteps);
        draw();
      }
    }

    // 暫停/繼續按鈕事件
    toggleBtn.addEventListener('click', () => {
      isPlaying = !isPlaying;
      toggleBtn.textContent = isPlaying ? '暫停' : '繼續';
      if (isPlaying) {
        intervalId = setInterval(update, 1000); // 每 1000ms 移動一格
      } else {
        clearInterval(intervalId); // 清除間隔
      }
    });

    // 啟動動畫
    intervalId = setInterval(update, 1000); // 初始啟動
    dirEl.textContent = '順時針';
    countEl.textContent = '已完成格數：0';
  </script>
</body>
</html>